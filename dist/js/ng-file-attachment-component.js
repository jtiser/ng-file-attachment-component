var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var components;
        (function (components) {
            var FileAttachmentComponentController = (function () {
                //#endregion
                //#region ctor
                /* @ngInject */
                FileAttachmentComponentController.$inject = ["$log", "toaster", "_", "fileAttachmentService", "fileAttachmentOriginEnum", "applicationOriginEnum"];
                function FileAttachmentComponentController($log, toaster, _, fileAttachmentService, fileAttachmentOriginEnum, applicationOriginEnum) {
                    var _this = this;
                    this.$log = $log;
                    this.toaster = toaster;
                    this._ = _;
                    this.fileAttachmentService = fileAttachmentService;
                    this.fileAttachmentOriginEnum = fileAttachmentOriginEnum;
                    this.applicationOriginEnum = applicationOriginEnum;
                    this.hasCurrentUserUploadRights = false;
                    //#endregion
                    //#region private fields
                    this.maxFileSize = 20000000; //in bytes = 20mb
                    /**
                     * TODO MGA: improve inline-form error handling & UI feedback ! not dynamic // fluid to use
                     * @param fileAttachment
                     */
                    this.onUpdatedCommentValidateInput = function (fileAttachment) {
                        if (!fileAttachment.updatedComment || fileAttachment.updatedComment.length < 1) {
                            fileAttachment.updatedCommentErrorMessage = 'comment must be non-empty';
                            return false;
                        }
                        else if (fileAttachment.updatedComment && fileAttachment.updatedComment.length >= 255) {
                            fileAttachment.updatedCommentErrorMessage = 'comment must be < 255 characters';
                            return false;
                        }
                        else {
                            fileAttachment.updatedCommentErrorMessage = null; //reset error message to flag comment as valid
                            return true;
                        }
                    };
                    /**
                     * Handler dedicated to prevent on keypress='enter' the submission of a form if this component is inside one.
                     * Instead, it pushes the new value
                     */
                    this.onCommentInputKeyPress = function ($event, fileAttachment) {
                        var keyCode = $event.keyCode || $event.which;
                        if (keyCode === 13) {
                            //prevent form submission
                            $event.preventDefault();
                            //call 
                            _this.updateFileAttachmentComment(fileAttachment);
                            return false; //TODO MGA: necessary ?
                        }
                        return true;
                    };
                    if (!this.elementIdBinding) {
                        this.$log.error('parameter {elementIdBinding} is mandatory.');
                        return;
                    }
                    if (!this.applicationOriginEnum[this.originBinding]) {
                        this.$log.error('parameter {originBinding} is mandatory.');
                        return;
                    }
                    this.httpPromises = new Array();
                    // get list of attached files for current element
                    this.getAttachedFiles();
                    // get flag to know if current user has upload rights for current item
                    this.getCurrentUserUploadRights();
                    // get supported mime types for file upload, based on srv info
                    this.getSupportedExtensions();
                    this.nbOfItemsPerPage = 10;
                    this.fileInvalidMessageArray = new Array();
                }
                //#endregion
                //#region vm / public methods
                FileAttachmentComponentController.prototype.downloadAttachedFile = function (fileAttachment) {
                    if (!fileAttachment || !fileAttachment.Id)
                        return;
                    var httpPromise = this.fileAttachmentService.downloadAttachedFile(fileAttachment, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin]).then(function () {
                        //TODO MGA ? or leave as is.
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.deleteAttachedFile = function (fileAttachment) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id)
                        return;
                    var httpPromise = this.fileAttachmentService.deleteAttachedFile(fileAttachment.Id, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin]).then(function () {
                        _this.toaster.success("File (" + fileAttachment.FileName + ") successfully deleted.");
                        _this.getAttachedFiles();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.updateFileAttachmentComment = function (fileAttachment) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id || !fileAttachment.updatedComment)
                        return;
                    if (!this.onUpdatedCommentValidateInput(fileAttachment))
                        return; // check validation rules are ok
                    var httpPromise = this.fileAttachmentService.editFileAttachmentComment(fileAttachment.Id, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin], fileAttachment.updatedComment).then(function () {
                        _this.clearEditCommentMode(fileAttachment); //TODO MGA: useless if we reload all data from srv
                        // retrieve update list of files with updated file comment from srv : TODO MGA improve reload (costly)
                        _this.getAttachedFiles();
                        // TODO MGA : highlight updated comment ?
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.cancelEditComment = function (fileAttachment) {
                    fileAttachment.editCommentMode = false;
                    //fileAttachment.updatedComment = ""; // TODO MGA: decide behavior ? better to keep last entry ? but then we must also keep error message
                    //fileAttachment.updatedCommentErrorMessage = null;
                };
                //TODO MGA: handle multiple files & clean up view bindings
                FileAttachmentComponentController.prototype.onFileSelected = function (files, file, newFiles, duplicateFiles, invalidFiles, event) {
                    var _this = this;
                    if (!files && !file)
                        return;
                    this.fileInvalidMessageArray = []; //reset error array
                    if (files) {
                        this.selectedFiles = files;
                    }
                    if (file) {
                        this.selectedFile = file;
                    }
                    if (files && files.length > 1) {
                        this.fileInvalidMessageArray.push('Cannot upload multiple files at ounce. Please select only one file.');
                        return;
                    }
                    //var fileExtension = file.name.substr(file.name.lastIndexOf('.') + 1);
                    var fileFormatSupported = _(this.supportedExtensions).any(function (supportedExtension) { return _this.selectedFile.getFileExtension() === supportedExtension; });
                    //var fileFormatSupported = file.type && //If file.type is null / empty, that means current OS doesn't know about the file format => delegate to server to validate if format is valid, we can't know client-side.
                    //    _(this.supportedExtensions).any((supportedMimeType) => file.type === supportedMimeType);
                    if (!fileFormatSupported)
                        this.fileInvalidMessageArray.push("Unsupported file format: '" + this.selectedFile.type + "' with extension: '" + this.selectedFile.getFileExtension() + "'");
                    if (!this.selectedFile.size)
                        this.fileInvalidMessageArray.push('Selected file is empty.');
                    else if (this.selectedFile.size >= this.maxFileSize)
                        this.fileInvalidMessageArray.push("Selected file is bigger (" + this.convertBytesToMegaBytes(this.selectedFile.size) + "mb) than authorized file size: " + this.convertBytesToMegaBytes(this.maxFileSize) + "mb");
                };
                FileAttachmentComponentController.prototype.importSelectedFile = function () {
                    var _this = this;
                    if (!this.selectedFile || _(this.fileInvalidMessageArray).any())
                        return; //TODO MGA $log
                    var httpPromise = this.fileAttachmentService.attachFile(this.elementIdBinding, this.originBinding, this.selectedFile).then(function () {
                        _this.toaster.success("File (" + _this.selectedFile.name + ") successfully uploaded.");
                        _this.getAttachedFiles(); //TODO MGA : highlight new entry ?
                    }).finally(function () {
                        //clean up selected file
                        _this.clearSelectedFiles();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.clearSelectedFiles = function () {
                    this.selectedFiles = null;
                    this.selectedFile = null;
                    this.fileInvalidMessageArray = []; // clear error messages
                    //this.fileSelectedIsValid = true;
                };
                FileAttachmentComponentController.prototype.convertBytesToMegaBytes = function (bytes) {
                    return +(bytes / 1000000).toFixed(2); //converts back to number 2-digits string representation of original conversion.
                };
                //#endregion
                //#region private methods
                FileAttachmentComponentController.prototype.getAttachedFiles = function () {
                    var _this = this;
                    var httpPromise = this.fileAttachmentService.getAttachedFiles(this.elementIdBinding, this.originBinding).then(function (fileAttachmentList) {
                        _this.attachedFileList = fileAttachmentList;
                        _this.attachedFileListSource = fileAttachmentList; //TODO MGA : duplicate ? to prevent update to source list if collection modified ?
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.getSupportedExtensions = function () {
                    var _this = this;
                    var httpPromise = this.fileAttachmentService.getSupportedExtensions().then(function (supportedExtensions) {
                        _this.supportedExtensions = _(supportedExtensions).uniq();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.clearEditCommentMode = function (fileAttachment) {
                    fileAttachment.editCommentMode = false;
                    fileAttachment.updatedComment = null;
                    fileAttachment.updatedCommentErrorMessage = null;
                };
                FileAttachmentComponentController.prototype.getCurrentUserUploadRights = function () {
                    var _this = this;
                    this.fileAttachmentService
                        .getCurrentUserUploadRights(this.elementIdBinding, this.originBinding)
                        .then(function (booleanResponse) {
                        _this.hasCurrentUserUploadRights = booleanResponse;
                    });
                };
                return FileAttachmentComponentController;
            }());
            components.FileAttachmentComponentController = FileAttachmentComponentController;
            var FileAttachmentComponent = (function () {
                function FileAttachmentComponent() {
                    this.bindings = {
                        elementIdBinding: '=',
                        originBinding: '='
                    };
                    this.controller = FileAttachmentComponentController;
                    this.controllerAs = 'vm';
                    this.templateUrl = 'component/file-attachment.tpl.html';
                }
                return FileAttachmentComponent;
            }());
            components.FileAttachmentComponent = FileAttachmentComponent;
            angular.module('bluesky.core.components.fileAttachment', [
                'cgBusy',
                'smart-table',
                'toaster',
                'file-attachment-component-tpl',
                'bluesky.core.services.fileAttachment',
                'bluesky.core.models.fileAttachmentOriginEnum',
                'bluesky.core.models.applicationOriginEnum'
            ])
                .value('cgBusyDefaults', { templateUrl: 'templates/angular-busy/angular-busy-custom.tpl.html' })
                .constant('_', window['_'])
                .constant('moment', window['moment'])
                .component('fileAttachmentComponent', new FileAttachmentComponent());
        })(components = core.components || (core.components = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : decide on practice to share enums with srv etc
             */
            (function (ApplicationOriginEnum) {
                ApplicationOriginEnum[ApplicationOriginEnum["QuoteWizard"] = 0] = "QuoteWizard";
                ApplicationOriginEnum[ApplicationOriginEnum["OrderEntry"] = 1] = "OrderEntry";
                ApplicationOriginEnum[ApplicationOriginEnum["OrderTracking"] = 2] = "OrderTracking";
            })(models.ApplicationOriginEnum || (models.ApplicationOriginEnum = {}));
            var ApplicationOriginEnum = models.ApplicationOriginEnum;
            /**
             * declared as angular module to be injected at runtime inside controllers/services to use it as a dictionnary.
             * Otherwise, we are not sure the reference to this object will ve known at runtime due to order of evaluation of imports inside generated js.
             */
            angular.module('bluesky.core.models.applicationOriginEnum', [])
                .constant('applicationOriginEnum', ApplicationOriginEnum);
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : decide on practice to share enums with srv etc
             */
            (function (FileAttachmentOriginEnum) {
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["QuoteWizardFileAttachment"] = 0] = "QuoteWizardFileAttachment";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderEntryCustomDetails"] = 1] = "OrderEntryCustomDetails";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderEntryAudioCustomDetail"] = 2] = "OrderEntryAudioCustomDetail";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderTrackingFileAttachment"] = 3] = "OrderTrackingFileAttachment";
            })(models.FileAttachmentOriginEnum || (models.FileAttachmentOriginEnum = {}));
            var FileAttachmentOriginEnum = models.FileAttachmentOriginEnum;
            /**
             * declared as angular module to be injected at runtime inside controllers/services to use it as a dictionnary.
             * Otherwise, we are not sure the reference to this object will ve known at runtime due to order of evaluation of imports inside generated js.
             */
            angular.module('bluesky.core.models.fileAttachmentOriginEnum', [])
                .constant('fileAttachmentOriginEnum', FileAttachmentOriginEnum);
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : export an interface too ?
             */
            var FileAttachment = (function () {
                function FileAttachment(
                    //srv-side properties
                    Id, FileName, Comment, UploaderInformation, CreationDate, FileOrigin, CanCurrentUserDownloadFile, CanCurrentUserDeleteFile, CanCurrentUserEditComment, 
                    //client-side properties
                    editCommentMode, updatedComment, updatedCommentErrorMessage) {
                    this.Id = Id;
                    this.FileName = FileName;
                    this.Comment = Comment;
                    this.UploaderInformation = UploaderInformation;
                    this.CreationDate = CreationDate;
                    this.FileOrigin = FileOrigin;
                    this.CanCurrentUserDownloadFile = CanCurrentUserDownloadFile;
                    this.CanCurrentUserDeleteFile = CanCurrentUserDeleteFile;
                    this.CanCurrentUserEditComment = CanCurrentUserEditComment;
                    this.editCommentMode = editCommentMode;
                    this.updatedComment = updatedComment;
                    this.updatedCommentErrorMessage = updatedCommentErrorMessage;
                }
                return FileAttachment;
            }());
            models.FileAttachment = FileAttachment;
            var UserInformation = (function () {
                function UserInformation(FirstName, LastName, DisplayName, userIdentifier, Email, PhoneNumber) {
                    this.FirstName = FirstName;
                    this.LastName = LastName;
                    this.DisplayName = DisplayName;
                    this.userIdentifier = userIdentifier;
                    this.Email = Email;
                    this.PhoneNumber = PhoneNumber;
                }
                return UserInformation;
            }());
            models.UserInformation = UserInformation;
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            var JsonBooleanResponse = (function () {
                function JsonBooleanResponse(booleanResponse) {
                    this.booleanResponse = booleanResponse;
                }
                return JsonBooleanResponse;
            }());
            models.JsonBooleanResponse = JsonBooleanResponse;
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var services;
        (function (services) {
            var FileAttachmentService = (function () {
                /* @ngInject */
                FileAttachmentService.$inject = ["httpWrapperService", "$log", "$timeout", "Upload", "Blob", "FileSaver", "fileAttachmentOriginEnum", "applicationOriginEnum"];
                function FileAttachmentService(httpWrapperService, $log, $timeout, Upload, Blob, //TODO MGA: typings ?
                    FileSaver, //TODO MGA: typings ?
                    fileAttachmentOriginEnum, applicationOriginEnum) {
                    this.httpWrapperService = httpWrapperService;
                    this.$log = $log;
                    this.$timeout = $timeout;
                    this.Upload = Upload;
                    this.Blob = Blob;
                    this.FileSaver = FileSaver;
                    this.fileAttachmentOriginEnum = fileAttachmentOriginEnum;
                    this.applicationOriginEnum = applicationOriginEnum;
                }
                FileAttachmentService.prototype.getAttachedFiles = function (elementId, applicationOrigin) {
                    //TODO MGA : cleaner params handling to pass to http call
                    return this.httpWrapperService.get('file-attachment/search', {
                        params: { 'elementId': elementId, 'applicationOrigin': this.applicationOriginEnum[applicationOrigin] },
                        apiEndpoint: true
                    });
                };
                FileAttachmentService.prototype.attachFile = function (elementId, applicationOrigin, fileToUpload) {
                    var _this = this;
                    if (!fileToUpload) {
                        this.$log.warn('[fileAttachmentService.attachFile] file is empty, aborting upload.');
                        return null;
                    }
                    //TODO MGA: we should rely on a stronger http-wrapper to handle upload this way
                    return this.Upload.base64DataUrl(fileToUpload).then(function (fileBase64Url) {
                        return _this.httpWrapperService.post('file-attachment/put', 
                        //TODO MGA : create model for AttachFileDto & FileUploadBaseDto
                        {
                            'ElementId': elementId,
                            'ApplicationOrigin': _this.applicationOriginEnum[applicationOrigin],
                            'FileUploadBaseDto': {
                                'FileName': fileToUpload.name,
                                'FileBase64Url': fileBase64Url.slice(fileBase64Url.indexOf('base64,') + 'base64,'.length),
                                'ContentType': fileToUpload.type
                            }
                        }, {
                            apiEndpoint: true,
                            uploadInBase64Json: true
                        });
                    });
                };
                FileAttachmentService.prototype.downloadAttachedFile = function (fileAttachment, fileOrigin) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id || !fileAttachment.FileName) {
                        this.$log.error('[fileAttachment] mandatory.');
                        return null;
                    }
                    return this.httpWrapperService.getFile('file-attachment/download', {
                        params: { 'fileAttachmentId': fileAttachment.Id, 'fileOrigin': this.fileAttachmentOriginEnum[fileOrigin] },
                        apiEndpoint: true
                    }).then(function (file) {
                        //TODO MGA: extract file download as a separate service
                        //var filewithBOM = '\uFEFF'+ file; //Add BOM UTF-8 before ? for now delayed to FileSaver.saveAs() flag autoBOM parameter.
                        var blob = new Blob([file.content], { type: file.type });
                        //var blob = new Blob([file], { type: 'application/octet-stream;utf-8' });
                        //var blob = new Blob([file], { type: 'image/png;charset=windows-1252' });
                        //var blob = new Blob([file], { type: 'image/png;charset=ISO-8859-1' });
                        _this.FileSaver.saveAs(blob, file.name || fileAttachment.FileName || 'unknown.bin'); // autoBOM enabled by default
                        return;
                    });
                };
                FileAttachmentService.prototype.deleteAttachedFile = function (fileAttachmentId, fileOrigin) {
                    return this.httpWrapperService.delete('file-attachment/delete', {
                        params: { 'fileAttachmentId': fileAttachmentId, 'fileOrigin': this.fileAttachmentOriginEnum[fileOrigin] },
                        apiEndpoint: true
                    });
                };
                FileAttachmentService.prototype.editFileAttachmentComment = function (fileAttachmentId, fileOrigin, updatedComment) {
                    return this.httpWrapperService.post('file-attachment/update-comment', 
                    //TODO MGA : create Dto client-side or update endpoint srv-side to support part-params url + comment as payload (cleaner SOC).
                    {
                        'FileAttachmentId': fileAttachmentId,
                        'FileOrigin': this.fileAttachmentOriginEnum[fileOrigin],
                        'Comment': updatedComment
                    }, { apiEndpoint: true });
                };
                FileAttachmentService.prototype.getSupportedExtensions = function () {
                    return this.httpWrapperService.get('file-attachment/authorized-file-extensions', { apiEndpoint: true });
                };
                FileAttachmentService.prototype.getSupportedMimeTypes = function () {
                    return this.httpWrapperService.get('file-attachment/authorized-mime-types', { apiEndpoint: true });
                };
                FileAttachmentService.prototype.getCurrentUserUploadRights = function (elementId, applicationOrigin) {
                    return this.httpWrapperService.get('file-attachment/get-current-user-upload-rights', {
                        params: { 'elementId': elementId, 'applicationOrigin': this.applicationOriginEnum[applicationOrigin] },
                        apiEndpoint: true
                    })
                        .then(function (response) { return response.booleanResponse; });
                };
                return FileAttachmentService;
            }());
            services.FileAttachmentService = FileAttachmentService;
            angular.module('bluesky.core.services.fileAttachment', [
                'ng.httpWrapper',
                'ngFileUpload',
                'ngFileSaver',
                'bluesky.core.models.fileAttachmentOriginEnum',
                'bluesky.core.models.applicationOriginEnum'
            ]).service('fileAttachmentService', FileAttachmentService);
        })(services = core.services || (core.services = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

//TODO MGA: very important to not use delegate here, otherwise this is badly captured. it MUST be an anonymous function.
File.prototype.getFileExtension = function () {
    return this.name.substr(this.name.lastIndexOf('.') + 1);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudC9maWxlLWF0dGFjaG1lbnQuY29tcG9uZW50LnRzIiwibW9kZWxzL2FwcGxpY2F0aW9uLW9yaWdpbi5lbnVtLnRzIiwibW9kZWxzL2ZpbGUtYXR0YWNobWVudC1vcmlnaW4uZW51bS50cyIsIm1vZGVscy9maWxlLWF0dGFjaG1lbnQubW9kZWwudHMiLCJtb2RlbHMvanNvbi1ib29sZWFuLXJlc3BvbnNlLnRzIiwic2VydmljZS9maWxlLWF0dGFjaG1lbnQuc2VydmljZS50cyIsInNlcnZpY2UvZmlsZS5leHRlbnNpb25zLnRzIiwibmctZmlsZS1hdHRhY2htZW50LWNvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFVO0FBQVYsQ0FBQSxVQUFVLFNBQU87SUFBQyxJQUFBO0lBQUEsQ0FBQSxVQUFBLE1BQUk7UUFBQyxJQUFBO1FBQUEsQ0FBQSxVQUFBLFlBQVc7WUFpRDlCLElBQUEscUNBQUEsWUFBQTs7Ozs7Z0JBZ0NJLFNBQUEsa0NBQ1ksTUFDQSxTQUNBLEdBQ0EsdUJBQ0EsMEJBQ0EsdUJBQTRDO29CQXRDNUQsSUFBQSxRQUFBO29CQWlDZ0IsS0FBQSxPQUFBO29CQUNBLEtBQUEsVUFBQTtvQkFDQSxLQUFBLElBQUE7b0JBQ0EsS0FBQSx3QkFBQTtvQkFDQSxLQUFBLDJCQUFBO29CQUNBLEtBQUEsd0JBQUE7b0JBekJaLEtBQUEsNkJBQTZCOzs7b0JBWTdCLEtBQUEsY0FBYzs7Ozs7b0JBcUZQLEtBQUEsZ0NBQWdDLFVBQUMsZ0JBQThCO3dCQUNsRSxJQUFJLENBQUMsZUFBZSxrQkFBa0IsZUFBZSxlQUFlLFNBQVMsR0FBRzs0QkFDNUUsZUFBZSw2QkFBNkI7NEJBQzVDLE9BQU87OzZCQUNKLElBQUksZUFBZSxrQkFBa0IsZUFBZSxlQUFlLFVBQVUsS0FBSzs0QkFDckYsZUFBZSw2QkFBNkI7NEJBQzVDLE9BQU87OzZCQUNKOzRCQUNILGVBQWUsNkJBQTZCOzRCQUM1QyxPQUFPOzs7Ozs7O29CQVFSLEtB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NEJBQUEsVUFBMEIsa0JBQTBCLFlBQXNDLGdCQUFzQjtvQkFDNUcsT0FBTyxLQUFLLG1CQUFtQixLQUFXOztvQkFFdEM7d0JBQ0ksb0JBQW9CO3dCQUNwQixjQUFjLEtBQUsseUJBQXlCO3dCQUM1QyxXQUFXO3VCQUNaLEVBQUUsYUFBYTs7Z0JBRzFCLHNCQUFBLFVBQUEseUJBQUEsWUFBQTtvQkFDSSxPQUFPLEtBQUssbUJBQW1CLElBQW1CLDhDQUE4QyxFQUFFLGFBQWE7O2dCQUduSCxzQkFBQSxVQUFBLHdCQUFBLFlBQUE7b0JBQ0ksT0FBTyxLQUFLLG1CQUFtQixJQUFtQix5Q0FBeUMsRUFBRSxhQUFhOztnQkFHOUcsc0JBQUEsVUFBQSw2QkFBQSxVQUEyQixXQUFtQixtQkFBd0M7b0JBQ2xGLE9BQU8sS0FBSyxtQkFBbUIsSUFBeUIsa0RBQ3BEO3dCQUNJLFFBQVEsRUFBRSxhQUFhLFdBQVcscUJBQXFCLEtBQUssc0JBQXNCO3dCQUNsRixhQUFhOzt5QkFFaEIsS0FBSyxVQUFDLFVBQVEsRUFBSyxPQUFBLFNBQVM7O2dCQUd6QyxPQUFBOztZQTVHYSxTQUFBLHdCQUFxQjtZQThHbEMsUUFBUSxPQUFPLHdDQUF3QztnQkFDbkQ7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7ZUFDRCxRQUFRLHlCQUF5QjtXQS9JakIsV0FBQSxLQUFBLGFBQUEsS0FBQSxXQUFRO09BQWIsT0FBQSxRQUFBLFNBQUEsUUFBQSxPQUFJO0dBQVosWUFBQSxVQUFPOzs7QUNRakIsS0FBSyxVQUFVLG1CQUFtQixZQUFBO0lBQzlCLE9BQU8sS0FBSyxLQUFLLE9BQU8sS0FBSyxLQUFLLFlBQVksT0FBTzs7QUMrYnpEIiwiZmlsZSI6Im5nLWZpbGUtYXR0YWNobWVudC1jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJuYW1lc3BhY2UgYmx1ZXNreS5jb3JlLmNvbXBvbmVudHMge1xyXG5cclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudCA9IGJsdWVza3kuY29yZS5tb2RlbHMuRmlsZUF0dGFjaG1lbnQ7XHJcbiAgICBpbXBvcnQgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudE9yaWdpbkVudW07XHJcbiAgICBpbXBvcnQgSUZpbGVBdHRhY2htZW50U2VydmljZSA9IGJsdWVza3kuY29yZS5zZXJ2aWNlcy5JRmlsZUF0dGFjaG1lbnRTZXJ2aWNlO1xyXG4gICAgaW1wb3J0IEFwcGxpY2F0aW9uT3JpZ2luRW51bSA9IGJsdWVza3kuY29yZS5tb2RlbHMuQXBwbGljYXRpb25PcmlnaW5FbnVtO1xyXG5cclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUZpbGVBdHRhY2htZW50Q29tcG9uZW50QmluZGluZ3Mge1xyXG4gICAgICAgIGVsZW1lbnRJZEJpbmRpbmc/OiBudW1iZXI7XHJcbiAgICAgICAgb3JpZ2luQmluZGluZz86IEFwcGxpY2F0aW9uT3JpZ2luRW51bTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIgZXh0ZW5kcyBJRmlsZUF0dGFjaG1lbnRDb21wb25lbnRCaW5kaW5ncyB7XHJcbiAgICAgICAgYXR0YWNoZWRGaWxlTGlzdDogQXJyYXk8RmlsZUF0dGFjaG1lbnQ+O1xyXG4gICAgICAgIGF0dGFjaGVkRmlsZUxpc3RTb3VyY2U6IEFycmF5PEZpbGVBdHRhY2htZW50PjtcclxuXHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZDtcclxuICAgICAgICBkZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZDtcclxuXHJcbiAgICAgICAgaGFzQ3VycmVudFVzZXJVcGxvYWRSaWdodHM6IGJvb2xlYW47XHJcblxyXG4gICAgICAgIHNlbGVjdGVkRmlsZXM6IEFycmF5PEZpbGU+O1xyXG4gICAgICAgIHNlbGVjdGVkRmlsZTogRmlsZTtcclxuICAgICAgICBmaWxlSW52YWxpZE1lc3NhZ2VBcnJheTogQXJyYXk8c3RyaW5nPjtcclxuICAgICAgICBvbkZpbGVTZWxlY3RlZDogKGZpbGVzOiBBcnJheTxGaWxlPiwgZmlsZTogRmlsZSwgbmV3RmlsZXM6IEFycmF5PEZpbGU+LCBkdXBsaWNhdGVGaWxlczogQXJyYXk8RmlsZT4sIGludmFsaWRGaWxlczogQXJyYXk8RmlsZT4sIGV2ZW50OiBKUXVlcnlFdmVudE9iamVjdCkgPT4gdm9pZDtcclxuICAgICAgICBpbXBvcnRTZWxlY3RlZEZpbGUoKTogdm9pZDtcclxuICAgICAgICBjbGVhclNlbGVjdGVkRmlsZXMoKTogdm9pZDtcclxuXHJcbiAgICAgICAgLy9UT0RPIE1HQTogb25seSBKcXVlcnkgZXZlbnQgaGFzIG5lY2Vzc2FyeSBwcm9wZXJ0aWVzIHRvIGtub3cgc291cmNlIGV2ZW50LCBjaGVjayB3aHkgYW5ndWxhciB0eXBpbmdzIGRvZXNuJ3QgY29udGFpbiBuZWNlc3NhcnkgcGFyYW1zXHJcbiAgICAgICAgb25Db21tZW50SW5wdXRLZXlQcmVzczogKCRldmVudDogSlF1ZXJ5RXZlbnRPYmplY3QsIGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCkgPT4gYm9vbGVhbjtcclxuXHJcbiAgICAgICAgdXBkYXRlRmlsZUF0dGFjaG1lbnRDb21tZW50KGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IHZvaWQ7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ2hlY2sgbmV3IGNvbW1lbnQgaW5wdXQgYWdhaW5zdCB2YWxpZGF0aW9uIHJ1bGVzLCB1cGRhdGUgVk0gdG8gaW5mb3JtIHRoZSB2aWV3IG9mIHBvdGVudGlhbCBlcnJvcnMuXHJcbiAgICAgICAgICogQHBhcmFtIGZpbGVBdHRhY2htZW50IFxyXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIGlucHV0IGlzIGludmFsaWQsIG90aGVyd2lzZSBmYWxzZS4gXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb25VcGRhdGVkQ29tbWVudFZhbGlkYXRlSW5wdXQoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogYm9vbGVhbjtcclxuICAgICAgICBjYW5jZWxFZGl0Q29tbWVudChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkO1xyXG5cclxuICAgICAgICBjb252ZXJ0Qnl0ZXNUb01lZ2FCeXRlcyhieXRlczogbnVtYmVyKTogbnVtYmVyO1xyXG5cclxuICAgICAgICBuYk9mSXRlbXNQZXJQYWdlOiBudW1iZXI7XHJcblxyXG4gICAgICAgIHN1cHBvcnRlZEV4dGVuc2lvbnM6IEFycmF5PHN0cmluZz47XHJcblxyXG4gICAgICAgIGh0dHBQcm9taXNlczogQXJyYXk8bmcuSVByb21pc2U8YW55Pj47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciBpbXBsZW1lbnRzIElGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIge1xyXG5cclxuICAgICAgICAvLyNyZWdpb24gYmluZGluZyBwcm9wXHJcblxyXG4gICAgICAgIGVsZW1lbnRJZEJpbmRpbmc6IG51bWJlcjtcclxuICAgICAgICBvcmlnaW5CaW5kaW5nOiBBcHBsaWNhdGlvbk9yaWdpbkVudW07XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gdm0gcHJvcFxyXG5cclxuICAgICAgICBhdHRhY2hlZEZpbGVMaXN0OiBBcnJheTxGaWxlQXR0YWNobWVudD47XHJcbiAgICAgICAgYXR0YWNoZWRGaWxlTGlzdFNvdXJjZTogQXJyYXk8RmlsZUF0dGFjaG1lbnQ+O1xyXG4gICAgICAgIGhhc0N1cnJlbnRVc2VyVXBsb2FkUmlnaHRzID0gZmFsc2U7XHJcbiAgICAgICAgc2VsZWN0ZWRGaWxlczogQXJyYXk8RmlsZT47XHJcbiAgICAgICAgc2VsZWN0ZWRGaWxlOiBGaWxlO1xyXG4gICAgICAgIGZpbGVJbnZhbGlkTWVzc2FnZUFycmF5OiBBcnJheTxzdHJpbmc+O1xyXG4gICAgICAgIG5iT2ZJdGVtc1BlclBhZ2U6IG51bWJlcjtcclxuICAgICAgICBodHRwUHJvbWlzZXM6IEFycmF5PG5nLklQcm9taXNlPGFueT4+O1xyXG4gICAgICAgIHN1cHBvcnRlZEV4dGVuc2lvbnM6IEFycmF5PHN0cmluZz47XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gcHJpdmF0ZSBmaWVsZHNcclxuXHJcbiAgICAgICAgbWF4RmlsZVNpemUgPSAyMDAwMDAwMDsgLy9pbiBieXRlcyA9IDIwbWJcclxuXHJcbiAgICAgICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgICAgIC8vI3JlZ2lvbiBjdG9yXHJcblxyXG4gICAgICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgICAgICBwcml2YXRlICRsb2c6IG5nLklMb2dTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIHRvYXN0ZXI6IG5ndG9hc3Rlci5JVG9hc3RlclNlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgXzogVW5kZXJzY29yZVN0YXRpYyxcclxuICAgICAgICAgICAgcHJpdmF0ZSBmaWxlQXR0YWNobWVudFNlcnZpY2U6IElGaWxlQXR0YWNobWVudFNlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sXHJcbiAgICAgICAgICAgIHByaXZhdGUgYXBwbGljYXRpb25PcmlnaW5FbnVtOiBBcHBsaWNhdGlvbk9yaWdpbkVudW1cclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmVsZW1lbnRJZEJpbmRpbmcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcigncGFyYW1ldGVyIHtlbGVtZW50SWRCaW5kaW5nfSBpcyBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5hcHBsaWNhdGlvbk9yaWdpbkVudW1bdGhpcy5vcmlnaW5CaW5kaW5nXSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdwYXJhbWV0ZXIge29yaWdpbkJpbmRpbmd9IGlzIG1hbmRhdG9yeS4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMgPSBuZXcgQXJyYXk8bmcuSVByb21pc2U8YW55Pj4oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGdldCBsaXN0IG9mIGF0dGFjaGVkIGZpbGVzIGZvciBjdXJyZW50IGVsZW1lbnRcclxuICAgICAgICAgICAgdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBnZXQgZmxhZyB0byBrbm93IGlmIGN1cnJlbnQgdXNlciBoYXMgdXBsb2FkIHJpZ2h0cyBmb3IgY3VycmVudCBpdGVtXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHMoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGdldCBzdXBwb3J0ZWQgbWltZSB0eXBlcyBmb3IgZmlsZSB1cGxvYWQsIGJhc2VkIG9uIHNydiBpbmZvXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0U3VwcG9ydGVkRXh0ZW5zaW9ucygpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5uYk9mSXRlbXNQZXJQYWdlID0gMTA7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5ID0gbmV3IEFycmF5PHN0cmluZz4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gdm0gLyBwdWJsaWMgbWV0aG9kc1xyXG5cclxuICAgICAgICBwdWJsaWMgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5kb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA/IG9yIGxlYXZlIGFzIGlzLlxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50b2FzdGVyLnN1Y2Nlc3MoYEZpbGUgKCR7ZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWV9KSBzdWNjZXNzZnVsbHkgZGVsZXRlZC5gKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHVwZGF0ZUZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQgfHwgIWZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50KSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMub25VcGRhdGVkQ29tbWVudFZhbGlkYXRlSW5wdXQoZmlsZUF0dGFjaG1lbnQpKSByZXR1cm47IC8vIGNoZWNrIHZhbGlkYXRpb24gcnVsZXMgYXJlIG9rXHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5lZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50KGZpbGVBdHRhY2htZW50LklkLCB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlQXR0YWNobWVudC5GaWxlT3JpZ2luXSwgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckVkaXRDb21tZW50TW9kZShmaWxlQXR0YWNobWVudCk7IC8vVE9ETyBNR0E6IHVzZWxlc3MgaWYgd2UgcmVsb2FkIGFsbCBkYXRhIGZyb20gc3J2XHJcbiAgICAgICAgICAgICAgICAvLyByZXRyaWV2ZSB1cGRhdGUgbGlzdCBvZiBmaWxlcyB3aXRoIHVwZGF0ZWQgZmlsZSBjb21tZW50IGZyb20gc3J2IDogVE9ETyBNR0EgaW1wcm92ZSByZWxvYWQgKGNvc3RseSlcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xyXG4gICAgICAgICAgICAgICAgLy8gVE9ETyBNR0EgOiBoaWdobGlnaHQgdXBkYXRlZCBjb21tZW50ID9cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRPRE8gTUdBOiBpbXByb3ZlIGlubGluZS1mb3JtIGVycm9yIGhhbmRsaW5nICYgVUkgZmVlZGJhY2sgISBub3QgZHluYW1pYyAvLyBmbHVpZCB0byB1c2VcclxuICAgICAgICAgKiBAcGFyYW0gZmlsZUF0dGFjaG1lbnRcclxuICAgICAgICAgKi9cclxuICAgICAgICBwdWJsaWMgb25VcGRhdGVkQ29tbWVudFZhbGlkYXRlSW5wdXQgPSAoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogYm9vbGVhbiA9PiB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgfHwgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSAnY29tbWVudCBtdXN0IGJlIG5vbi1lbXB0eSc7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgJiYgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQubGVuZ3RoID49IDI1NSkge1xyXG4gICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSAnY29tbWVudCBtdXN0IGJlIDwgMjU1IGNoYXJhY3RlcnMnO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBudWxsOyAvL3Jlc2V0IGVycm9yIG1lc3NhZ2UgdG8gZmxhZyBjb21tZW50IGFzIHZhbGlkXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSGFuZGxlciBkZWRpY2F0ZWQgdG8gcHJldmVudCBvbiBrZXlwcmVzcz0nZW50ZXInIHRoZSBzdWJtaXNzaW9uIG9mIGEgZm9ybSBpZiB0aGlzIGNvbXBvbmVudCBpcyBpbnNpZGUgb25lLlxyXG4gICAgICAgICAqIEluc3RlYWQsIGl0IHB1c2hlcyB0aGUgbmV3IHZhbHVlIFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHB1YmxpYyBvbkNvbW1lbnRJbnB1dEtleVByZXNzID0gKCRldmVudDogSlF1ZXJ5RXZlbnRPYmplY3QsIGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IGJvb2xlYW4gPT4ge1xyXG5cclxuICAgICAgICAgICAgdmFyIGtleUNvZGUgPSAkZXZlbnQua2V5Q29kZSB8fCAkZXZlbnQud2hpY2g7XHJcblxyXG4gICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gMTMpIHsgLy8gJ0VudGVyJyBrZXkgcHJlc3NlZFxyXG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IGZvcm0gc3VibWlzc2lvblxyXG4gICAgICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAvL2NhbGwgXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvL1RPRE8gTUdBOiBuZWNlc3NhcnkgP1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBjYW5jZWxFZGl0Q29tbWVudChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQuZWRpdENvbW1lbnRNb2RlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgPSBcIlwiOyAvLyBUT0RPIE1HQTogZGVjaWRlIGJlaGF2aW9yID8gYmV0dGVyIHRvIGtlZXAgbGFzdCBlbnRyeSA/IGJ1dCB0aGVuIHdlIG11c3QgYWxzbyBrZWVwIGVycm9yIG1lc3NhZ2VcclxuICAgICAgICAgICAgLy9maWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL1RPRE8gTUdBOiBoYW5kbGUgbXVsdGlwbGUgZmlsZXMgJiBjbGVhbiB1cCB2aWV3IGJpbmRpbmdzXHJcbiAgICAgICAgcHVibGljIG9uRmlsZVNlbGVjdGVkKGZpbGVzOiBBcnJheTxGaWxlPiwgZmlsZTogRmlsZSwgbmV3RmlsZXM6IEFycmF5PEZpbGU+LCBkdXBsaWNhdGVGaWxlczogQXJyYXk8RmlsZT4sIGludmFsaWRGaWxlczogQXJyYXk8RmlsZT4sIGV2ZW50OiBKUXVlcnlFdmVudE9iamVjdCk6IHZvaWQge1xyXG4gICAgICAgICAgICBpZiAoIWZpbGVzICYmICFmaWxlKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5ID0gW107IC8vcmVzZXQgZXJyb3IgYXJyYXlcclxuXHJcbiAgICAgICAgICAgIGlmIChmaWxlcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbGVzID0gZmlsZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlID0gZmlsZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkucHVzaCgnQ2Fubm90IHVwbG9hZCBtdWx0aXBsZSBmaWxlcyBhdCBvdW5jZS4gUGxlYXNlIHNlbGVjdCBvbmx5IG9uZSBmaWxlLicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL3ZhciBmaWxlRXh0ZW5zaW9uID0gZmlsZS5uYW1lLnN1YnN0cihmaWxlLm5hbWUubGFzdEluZGV4T2YoJy4nKSArIDEpO1xyXG4gICAgICAgICAgICB2YXIgZmlsZUZvcm1hdFN1cHBvcnRlZCA9IF8odGhpcy5zdXBwb3J0ZWRFeHRlbnNpb25zKS5hbnkoc3VwcG9ydGVkRXh0ZW5zaW9uID0+IHRoaXMuc2VsZWN0ZWRGaWxlLmdldEZpbGVFeHRlbnNpb24oKSA9PT0gc3VwcG9ydGVkRXh0ZW5zaW9uKTtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyIGZpbGVGb3JtYXRTdXBwb3J0ZWQgPSBmaWxlLnR5cGUgJiYgLy9JZiBmaWxlLnR5cGUgaXMgbnVsbCAvIGVtcHR5LCB0aGF0IG1lYW5zIGN1cnJlbnQgT1MgZG9lc24ndCBrbm93IGFib3V0IHRoZSBmaWxlIGZvcm1hdCA9PiBkZWxlZ2F0ZSB0byBzZXJ2ZXIgdG8gdmFsaWRhdGUgaWYgZm9ybWF0IGlzIHZhbGlkLCB3ZSBjYW4ndCBrbm93IGNsaWVudC1zaWRlLlxyXG4gICAgICAgICAgICAvLyAgICBfKHRoaXMuc3VwcG9ydGVkRXh0ZW5zaW9ucykuYW55KChzdXBwb3J0ZWRNaW1lVHlwZSkgPT4gZmlsZS50eXBlID09PSBzdXBwb3J0ZWRNaW1lVHlwZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWZpbGVGb3JtYXRTdXBwb3J0ZWQpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5LnB1c2goYFVuc3VwcG9ydGVkIGZpbGUgZm9ybWF0OiAnJHt0aGlzLnNlbGVjdGVkRmlsZS50eXBlfScgd2l0aCBleHRlbnNpb246ICcke3RoaXMuc2VsZWN0ZWRGaWxlLmdldEZpbGVFeHRlbnNpb24oKX0nYCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWRGaWxlLnNpemUpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5LnB1c2goJ1NlbGVjdGVkIGZpbGUgaXMgZW1wdHkuJyk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc2VsZWN0ZWRGaWxlLnNpemUgPj0gdGhpcy5tYXhGaWxlU2l6ZSlcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkucHVzaChgU2VsZWN0ZWQgZmlsZSBpcyBiaWdnZXIgKCR7dGhpcy5jb252ZXJ0Qnl0ZXNUb01lZ2FCeXRlcyh0aGlzLnNlbGVjdGVkRmlsZS5zaXplKX1tYikgdGhhbiBhdXRob3JpemVkIGZpbGUgc2l6ZTogJHt0aGlzLmNvbnZlcnRCeXRlc1RvTWVnYUJ5dGVzKHRoaXMubWF4RmlsZVNpemUpfW1iYCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW1wb3J0U2VsZWN0ZWRGaWxlKCk6IHZvaWQge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWRGaWxlIHx8IF8odGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheSkuYW55KCkpIHJldHVybjsgLy9UT0RPIE1HQSAkbG9nXHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5hdHRhY2hGaWxlKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nLCB0aGlzLnNlbGVjdGVkRmlsZSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvYXN0ZXIuc3VjY2VzcyhgRmlsZSAoJHt0aGlzLnNlbGVjdGVkRmlsZS5uYW1lfSkgc3VjY2Vzc2Z1bGx5IHVwbG9hZGVkLmApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7IC8vVE9ETyBNR0EgOiBoaWdobGlnaHQgbmV3IGVudHJ5ID9cclxuICAgICAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvL2NsZWFuIHVwIHNlbGVjdGVkIGZpbGVcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWxlY3RlZEZpbGVzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgY2xlYXJTZWxlY3RlZEZpbGVzKCk6IHZvaWQge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZXMgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkgPSBbXTsgLy8gY2xlYXIgZXJyb3IgbWVzc2FnZXNcclxuICAgICAgICAgICAgLy90aGlzLmZpbGVTZWxlY3RlZElzVmFsaWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGNvbnZlcnRCeXRlc1RvTWVnYUJ5dGVzKGJ5dGVzOiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgICAgICAgICByZXR1cm4gKyhieXRlcyAvIDEwMDAwMDApLnRvRml4ZWQoMik7IC8vY29udmVydHMgYmFjayB0byBudW1iZXIgMi1kaWdpdHMgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIG9yaWdpbmFsIGNvbnZlcnNpb24uXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAgICAgLy8jcmVnaW9uIHByaXZhdGUgbWV0aG9kc1xyXG5cclxuICAgICAgICBwcml2YXRlIGdldEF0dGFjaGVkRmlsZXMoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmdldEF0dGFjaGVkRmlsZXModGhpcy5lbGVtZW50SWRCaW5kaW5nLCB0aGlzLm9yaWdpbkJpbmRpbmcpLnRoZW4oKGZpbGVBdHRhY2htZW50TGlzdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2hlZEZpbGVMaXN0ID0gZmlsZUF0dGFjaG1lbnRMaXN0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2hlZEZpbGVMaXN0U291cmNlID0gZmlsZUF0dGFjaG1lbnRMaXN0OyAvL1RPRE8gTUdBIDogZHVwbGljYXRlID8gdG8gcHJldmVudCB1cGRhdGUgdG8gc291cmNlIGxpc3QgaWYgY29sbGVjdGlvbiBtb2RpZmllZCA/XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldFN1cHBvcnRlZEV4dGVuc2lvbnMoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmdldFN1cHBvcnRlZEV4dGVuc2lvbnMoKS50aGVuKChzdXBwb3J0ZWRFeHRlbnNpb25zKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1cHBvcnRlZEV4dGVuc2lvbnMgPSBfKHN1cHBvcnRlZEV4dGVuc2lvbnMpLnVuaXEoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgY2xlYXJFZGl0Q29tbWVudE1vZGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KSB7XHJcbiAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LmVkaXRDb21tZW50TW9kZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHMoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHModGhpcy5lbGVtZW50SWRCaW5kaW5nLCB0aGlzLm9yaWdpbkJpbmRpbmcpXHJcbiAgICAgICAgICAgICAgICAudGhlbihib29sZWFuUmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzQ3VycmVudFVzZXJVcGxvYWRSaWdodHMgPSBib29sZWFuUmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBGaWxlQXR0YWNobWVudENvbXBvbmVudCBpbXBsZW1lbnRzIG5nLklDb21wb25lbnRPcHRpb25zIHtcclxuXHJcbiAgICAgICAgcHVibGljIGJpbmRpbmdzOiBhbnk7XHJcbiAgICAgICAgcHVibGljIGNvbnRyb2xsZXI6IGFueTtcclxuICAgICAgICBwdWJsaWMgY29udHJvbGxlckFzOiBzdHJpbmc7XHJcbiAgICAgICAgcHVibGljIHRlbXBsYXRlVXJsOiBzdHJpbmc7XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnRJZEJpbmRpbmc6ICc9JyxcclxuICAgICAgICAgICAgICAgIG9yaWdpbkJpbmRpbmc6ICc9J1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyID0gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXJBcyA9ICd2bSc7XHJcbiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVVcmwgPSAnY29tcG9uZW50L2ZpbGUtYXR0YWNobWVudC50cGwuaHRtbCc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUuY29tcG9uZW50cy5maWxlQXR0YWNobWVudCcsIFtcclxuICAgICAgICAnY2dCdXN5JyxcclxuICAgICAgICAnc21hcnQtdGFibGUnLFxyXG4gICAgICAgICd0b2FzdGVyJyxcclxuICAgICAgICAnZmlsZS1hdHRhY2htZW50LWNvbXBvbmVudC10cGwnLFxyXG4gICAgICAgICdibHVlc2t5LmNvcmUuc2VydmljZXMuZmlsZUF0dGFjaG1lbnQnLFxyXG4gICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsXHJcbiAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuYXBwbGljYXRpb25PcmlnaW5FbnVtJ1xyXG4gICAgXSlcclxuICAgICAgICAvL1RPRE8gTUdBOiBtYWtlIHRoaXMgdW5pZm9ybSBmb3IgZWFjaCBkaXJlY3RpdmVzIC8vIHNoYXJlIGJlaGF2aW9yXHJcbiAgICAgICAgLnZhbHVlKCdjZ0J1c3lEZWZhdWx0cycsIHsgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvYW5ndWxhci1idXN5L2FuZ3VsYXItYnVzeS1jdXN0b20udHBsLmh0bWwnIH0pXHJcbiAgICAgICAgLmNvbnN0YW50KCdfJywgd2luZG93WydfJ10pXHJcbiAgICAgICAgLmNvbnN0YW50KCdtb21lbnQnLCB3aW5kb3dbJ21vbWVudCddKVxyXG4gICAgICAgIC5jb21wb25lbnQoJ2ZpbGVBdHRhY2htZW50Q29tcG9uZW50JywgbmV3IEZpbGVBdHRhY2htZW50Q29tcG9uZW50KCkpO1xyXG5cclxufSIsIm5hbWVzcGFjZSBibHVlc2t5LmNvcmUubW9kZWxzIHtcclxuICAgIC8qKlxyXG4gICAgICogVE9ETyBNR0EgOiBkZWNpZGUgb24gcHJhY3RpY2UgdG8gc2hhcmUgZW51bXMgd2l0aCBzcnYgZXRjXHJcbiAgICAgKi9cclxuICAgIGV4cG9ydCBlbnVtIEFwcGxpY2F0aW9uT3JpZ2luRW51bSB7XHJcbiAgICAgICAgUXVvdGVXaXphcmQsXHJcbiAgICAgICAgT3JkZXJFbnRyeSxcclxuICAgICAgICBPcmRlclRyYWNraW5nXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBkZWNsYXJlZCBhcyBhbmd1bGFyIG1vZHVsZSB0byBiZSBpbmplY3RlZCBhdCBydW50aW1lIGluc2lkZSBjb250cm9sbGVycy9zZXJ2aWNlcyB0byB1c2UgaXQgYXMgYSBkaWN0aW9ubmFyeS5cclxuICAgICAqIE90aGVyd2lzZSwgd2UgYXJlIG5vdCBzdXJlIHRoZSByZWZlcmVuY2UgdG8gdGhpcyBvYmplY3Qgd2lsbCB2ZSBrbm93biBhdCBydW50aW1lIGR1ZSB0byBvcmRlciBvZiBldmFsdWF0aW9uIG9mIGltcG9ydHMgaW5zaWRlIGdlbmVyYXRlZCBqcy5cclxuICAgICAqL1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5tb2RlbHMuYXBwbGljYXRpb25PcmlnaW5FbnVtJywgW10pXHJcbiAgICAgICAgLmNvbnN0YW50KCdhcHBsaWNhdGlvbk9yaWdpbkVudW0nLCBBcHBsaWNhdGlvbk9yaWdpbkVudW0pO1xyXG59IiwibmFtZXNwYWNlIGJsdWVza3kuY29yZS5tb2RlbHMge1xyXG4gICAgLyoqXHJcbiAgICAgKiBUT0RPIE1HQSA6IGRlY2lkZSBvbiBwcmFjdGljZSB0byBzaGFyZSBlbnVtcyB3aXRoIHNydiBldGNcclxuICAgICAqL1xyXG4gICAgZXhwb3J0IGVudW0gRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtIHtcclxuICAgICAgICBRdW90ZVdpemFyZEZpbGVBdHRhY2htZW50LFxyXG4gICAgICAgIE9yZGVyRW50cnlDdXN0b21EZXRhaWxzLFxyXG4gICAgICAgIE9yZGVyRW50cnlBdWRpb0N1c3RvbURldGFpbCxcclxuICAgICAgICBPcmRlclRyYWNraW5nRmlsZUF0dGFjaG1lbnRcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGRlY2xhcmVkIGFzIGFuZ3VsYXIgbW9kdWxlIHRvIGJlIGluamVjdGVkIGF0IHJ1bnRpbWUgaW5zaWRlIGNvbnRyb2xsZXJzL3NlcnZpY2VzIHRvIHVzZSBpdCBhcyBhIGRpY3Rpb25uYXJ5LlxyXG4gICAgICogT3RoZXJ3aXNlLCB3ZSBhcmUgbm90IHN1cmUgdGhlIHJlZmVyZW5jZSB0byB0aGlzIG9iamVjdCB3aWxsIHZlIGtub3duIGF0IHJ1bnRpbWUgZHVlIHRvIG9yZGVyIG9mIGV2YWx1YXRpb24gb2YgaW1wb3J0cyBpbnNpZGUgZ2VuZXJhdGVkIGpzLlxyXG4gICAgICovXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5jb3JlLm1vZGVscy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0nLCBbXSlcclxuICAgICAgICAgICAuY29uc3RhbnQoJ2ZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSk7XHJcbn0iLCJuYW1lc3BhY2UgYmx1ZXNreS5jb3JlLm1vZGVscyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUT0RPIE1HQSA6IGV4cG9ydCBhbiBpbnRlcmZhY2UgdG9vID9cclxuICAgICAqL1xyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50IHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgLy9zcnYtc2lkZSBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICAgIHB1YmxpYyBJZDogbnVtYmVyLFxyXG4gICAgICAgICAgICBwdWJsaWMgRmlsZU5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIENvbW1lbnQ6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIFVwbG9hZGVySW5mb3JtYXRpb246IFVzZXJJbmZvcm1hdGlvbixcclxuICAgICAgICAgICAgcHVibGljIENyZWF0aW9uRGF0ZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgRmlsZU9yaWdpbjogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgQ2FuQ3VycmVudFVzZXJEb3dubG9hZEZpbGU6IGJvb2xlYW4sXHJcbiAgICAgICAgICAgIHB1YmxpYyBDYW5DdXJyZW50VXNlckRlbGV0ZUZpbGU6IGJvb2xlYW4sXHJcbiAgICAgICAgICAgIHB1YmxpYyBDYW5DdXJyZW50VXNlckVkaXRDb21tZW50OiBib29sZWFuLFxyXG5cclxuICAgICAgICAgICAgLy9jbGllbnQtc2lkZSBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICAgIHB1YmxpYyBlZGl0Q29tbWVudE1vZGU6IGJvb2xlYW4sXHJcbiAgICAgICAgICAgIHB1YmxpYyB1cGRhdGVkQ29tbWVudDogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgdXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2U6IHN0cmluZ1xyXG4gICAgICAgICkgeyB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIFVzZXJJbmZvcm1hdGlvbiB7XHJcbiAgICAgICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgICAgIHB1YmxpYyBGaXJzdE5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIExhc3ROYW1lOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpYyBEaXNwbGF5TmFtZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgdXNlcklkZW50aWZpZXI6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIEVtYWlsOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpYyBQaG9uZU51bWJlcjogc3RyaW5nXHJcbiAgICAgICAgKSB7IH1cclxuICAgIH1cclxufSIsIm5hbWVzcGFjZSBibHVlc2t5LmNvcmUubW9kZWxzIHtcclxuXHJcbiAgICBleHBvcnQgY2xhc3MgSnNvbkJvb2xlYW5SZXNwb25zZSB7XHJcbiAgICAgICAgY29uc3RydWN0b3IocHVibGljIGJvb2xlYW5SZXNwb25zZTogYm9vbGVhbikgeyB9XHJcbiAgICB9XHJcbn0iLCJuYW1lc3BhY2UgYmx1ZXNreS5jb3JlLnNlcnZpY2VzIHtcclxuXHJcbiAgICBpbXBvcnQgRmlsZUF0dGFjaG1lbnQgPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50O1xyXG4gICAgaW1wb3J0IEZpbGVDb250ZW50ID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQ29udGVudDtcclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcclxuICAgIGltcG9ydCBBcHBsaWNhdGlvbk9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkFwcGxpY2F0aW9uT3JpZ2luRW51bTtcclxuICAgIGltcG9ydCBKc29uQm9vbGVhblJlc3BvbnNlID0gYmx1ZXNreS5jb3JlLm1vZGVscy5Kc29uQm9vbGVhblJlc3BvbnNlO1xyXG5cclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUZpbGVBdHRhY2htZW50U2VydmljZSB7XHJcblxyXG4gICAgICAgIGdldEF0dGFjaGVkRmlsZXMoZWxlbWVudElkOiBudW1iZXIsIGFwcGxpY2F0aW9uT3JpZ2luOiBBcHBsaWNhdGlvbk9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTxBcnJheTxGaWxlQXR0YWNobWVudD4+O1xyXG5cclxuICAgICAgICBhdHRhY2hGaWxlKGVsZW1lbnRJZDogbnVtYmVyLCBhcHBsaWNhdGlvbk9yaWdpbjogQXBwbGljYXRpb25PcmlnaW5FbnVtLCBmaWxlVG9VcGxvYWQ6IEZpbGUpOiBuZy5JUHJvbWlzZTxhbnk+O1xyXG5cclxuICAgICAgICBkb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQsIGZpbGVPcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSk6IG5nLklQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAgICAgICBkZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnRJZDogbnVtYmVyLCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgICAgICAgZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudElkOiBudW1iZXIsIGZpbGVPcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSwgdXBkYXRlZENvbW1lbnQ6IHN0cmluZyk6IG5nLklQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAgICAgICBnZXRTdXBwb3J0ZWRFeHRlbnNpb25zKCk6IG5nLklQcm9taXNlPEFycmF5PHN0cmluZz4+O1xyXG5cclxuICAgICAgICBnZXRTdXBwb3J0ZWRNaW1lVHlwZXMoKTogbmcuSVByb21pc2U8QXJyYXk8c3RyaW5nPj47XHJcblxyXG4gICAgICAgIGdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzKGVsZW1lbnRJZDogbnVtYmVyLCBhcHBsaWNhdGlvbk9yaWdpbjogQXBwbGljYXRpb25PcmlnaW5FbnVtKTogbmcuSVByb21pc2U8Ym9vbGVhbj47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50U2VydmljZSBpbXBsZW1lbnRzIElGaWxlQXR0YWNobWVudFNlcnZpY2Uge1xyXG5cclxuICAgICAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgcHJpdmF0ZSBodHRwV3JhcHBlclNlcnZpY2U6IElIdHRwV3JhcHBlclNlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgJGxvZzogbmcuSUxvZ1NlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgJHRpbWVvdXQ6IG5nLklUaW1lb3V0U2VydmljZSxcclxuICAgICAgICAgICAgcHJpdmF0ZSBVcGxvYWQ6IG5nLmFuZ3VsYXJGaWxlVXBsb2FkLklVcGxvYWRTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIEJsb2I6IGFueSwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XHJcbiAgICAgICAgICAgIHByaXZhdGUgRmlsZVNhdmVyOiBhbnksIC8vVE9ETyBNR0E6IHR5cGluZ3MgP1xyXG4gICAgICAgICAgICBwcml2YXRlIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bTogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLFxyXG4gICAgICAgICAgICBwcml2YXRlIGFwcGxpY2F0aW9uT3JpZ2luRW51bTogQXBwbGljYXRpb25PcmlnaW5FbnVtXHJcbiAgICAgICAgKSB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0QXR0YWNoZWRGaWxlcyhlbGVtZW50SWQ6IG51bWJlciwgYXBwbGljYXRpb25PcmlnaW46IEFwcGxpY2F0aW9uT3JpZ2luRW51bSk6IG5nLklQcm9taXNlPEFycmF5PEZpbGVBdHRhY2htZW50Pj4ge1xyXG4gICAgICAgICAgICAvL1RPRE8gTUdBIDogY2xlYW5lciBwYXJhbXMgaGFuZGxpbmcgdG8gcGFzcyB0byBodHRwIGNhbGxcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldDxBcnJheTxGaWxlQXR0YWNobWVudD4+KCdmaWxlLWF0dGFjaG1lbnQvc2VhcmNoJywge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdlbGVtZW50SWQnOiBlbGVtZW50SWQsICdhcHBsaWNhdGlvbk9yaWdpbic6IHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtW2FwcGxpY2F0aW9uT3JpZ2luXSB9LFxyXG4gICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhdHRhY2hGaWxlKGVsZW1lbnRJZDogbnVtYmVyLCBhcHBsaWNhdGlvbk9yaWdpbjogQXBwbGljYXRpb25PcmlnaW5FbnVtLCBmaWxlVG9VcGxvYWQ6IEZpbGUpOiBuZy5JUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlVG9VcGxvYWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy53YXJuKCdbZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmF0dGFjaEZpbGVdIGZpbGUgaXMgZW1wdHksIGFib3J0aW5nIHVwbG9hZC4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL1RPRE8gTUdBOiB3ZSBzaG91bGQgcmVseSBvbiBhIHN0cm9uZ2VyIGh0dHAtd3JhcHBlciB0byBoYW5kbGUgdXBsb2FkIHRoaXMgd2F5XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLlVwbG9hZC5iYXNlNjREYXRhVXJsKGZpbGVUb1VwbG9hZCkudGhlbigoZmlsZUJhc2U2NFVybCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLnBvc3Q8YW55PignZmlsZS1hdHRhY2htZW50L3B1dCcsXHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBtb2RlbCBmb3IgQXR0YWNoRmlsZUR0byAmIEZpbGVVcGxvYWRCYXNlRHRvXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnRWxlbWVudElkJzogZWxlbWVudElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnQXBwbGljYXRpb25PcmlnaW4nOiB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlVXBsb2FkQmFzZUR0byc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlTmFtZSc6IGZpbGVUb1VwbG9hZC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVCYXNlNjRVcmwnOiBmaWxlQmFzZTY0VXJsLnNsaWNlKGZpbGVCYXNlNjRVcmwuaW5kZXhPZignYmFzZTY0LCcpICsgJ2Jhc2U2NCwnLmxlbmd0aCksIC8vc3RyaXAgdGhlIGRhdGFVcmkgcGFydCBvZiB0aGUgYmFzZTY0IGVuY29kaW5nIHRvIG9ubHkga2VlcCBiYXNlNjQgcmF3IGRhdGEuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudFR5cGUnOiBmaWxlVG9VcGxvYWQudHlwZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkSW5CYXNlNjRKc29uOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50LCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkIHx8ICFmaWxlQXR0YWNobWVudC5GaWxlTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdbZmlsZUF0dGFjaG1lbnRdIG1hbmRhdG9yeS4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0RmlsZSgnZmlsZS1hdHRhY2htZW50L2Rvd25sb2FkJywge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdmaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnQuSWQsICdmaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0gfSxcclxuICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXHJcbiAgICAgICAgICAgIH0pLnRoZW48dm9pZD4oKGZpbGU6IEZpbGVDb250ZW50KSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9UT0RPIE1HQTogZXh0cmFjdCBmaWxlIGRvd25sb2FkIGFzIGEgc2VwYXJhdGUgc2VydmljZVxyXG5cclxuICAgICAgICAgICAgICAgIC8vdmFyIGZpbGV3aXRoQk9NID0gJ1xcdUZFRkYnKyBmaWxlOyAvL0FkZCBCT00gVVRGLTggYmVmb3JlID8gZm9yIG5vdyBkZWxheWVkIHRvIEZpbGVTYXZlci5zYXZlQXMoKSBmbGFnIGF1dG9CT00gcGFyYW1ldGVyLlxyXG4gICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZS5jb250ZW50XSwgeyB0eXBlOiBmaWxlLnR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07dXRmLTgnIH0pO1xyXG4gICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnaW1hZ2UvcG5nO2NoYXJzZXQ9d2luZG93cy0xMjUyJyB9KTtcclxuICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PUlTTy04ODU5LTEnIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuRmlsZVNhdmVyLnNhdmVBcyhibG9iLCBmaWxlLm5hbWUgfHwgZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWUgfHwgJ3Vua25vd24uYmluJyk7IC8vIGF1dG9CT00gZW5hYmxlZCBieSBkZWZhdWx0XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudElkOiBudW1iZXIsIGZpbGVPcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSk6IG5nLklQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmRlbGV0ZTx2b2lkPignZmlsZS1hdHRhY2htZW50L2RlbGV0ZScsIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50SWQsICdmaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0gfSxcclxuICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudElkOiBudW1iZXIsIGZpbGVPcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSwgdXBkYXRlZENvbW1lbnQ6IHN0cmluZyk6IG5nLklQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLnBvc3Q8dm9pZD4oJ2ZpbGUtYXR0YWNobWVudC91cGRhdGUtY29tbWVudCcsXHJcbiAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY3JlYXRlIER0byBjbGllbnQtc2lkZSBvciB1cGRhdGUgZW5kcG9pbnQgc3J2LXNpZGUgdG8gc3VwcG9ydCBwYXJ0LXBhcmFtcyB1cmwgKyBjb21tZW50IGFzIHBheWxvYWQgKGNsZWFuZXIgU09DKS5cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAnRmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgJ0ZpbGVPcmlnaW4nOiB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlT3JpZ2luXSxcclxuICAgICAgICAgICAgICAgICAgICAnQ29tbWVudCc6IHVwZGF0ZWRDb21tZW50XHJcbiAgICAgICAgICAgICAgICB9LCB7IGFwaUVuZHBvaW50OiB0cnVlIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0U3VwcG9ydGVkRXh0ZW5zaW9ucygpOiBuZy5JUHJvbWlzZTxBcnJheTxzdHJpbmc+PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQ8QXJyYXk8c3RyaW5nPj4oJ2ZpbGUtYXR0YWNobWVudC9hdXRob3JpemVkLWZpbGUtZXh0ZW5zaW9ucycsIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBnZXRTdXBwb3J0ZWRNaW1lVHlwZXMoKTogbmcuSVByb21pc2U8QXJyYXk8c3RyaW5nPj4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0PEFycmF5PHN0cmluZz4+KCdmaWxlLWF0dGFjaG1lbnQvYXV0aG9yaXplZC1taW1lLXR5cGVzJywgeyBhcGlFbmRwb2ludDogdHJ1ZSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzKGVsZW1lbnRJZDogbnVtYmVyLCBhcHBsaWNhdGlvbk9yaWdpbjogQXBwbGljYXRpb25PcmlnaW5FbnVtKTogbmcuSVByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0PEpzb25Cb29sZWFuUmVzcG9uc2U+KCdmaWxlLWF0dGFjaG1lbnQvZ2V0LWN1cnJlbnQtdXNlci11cGxvYWQtcmlnaHRzJyxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgJ2VsZW1lbnRJZCc6IGVsZW1lbnRJZCwgJ2FwcGxpY2F0aW9uT3JpZ2luJzogdGhpcy5hcHBsaWNhdGlvbk9yaWdpbkVudW1bYXBwbGljYXRpb25PcmlnaW5dIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc3BvbnNlLmJvb2xlYW5SZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5jb3JlLnNlcnZpY2VzLmZpbGVBdHRhY2htZW50JywgW1xyXG4gICAgICAgICduZy5odHRwV3JhcHBlcicsXHJcbiAgICAgICAgJ25nRmlsZVVwbG9hZCcsXHJcbiAgICAgICAgJ25nRmlsZVNhdmVyJyxcclxuICAgICAgICAnYmx1ZXNreS5jb3JlLm1vZGVscy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0nLFxyXG4gICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmFwcGxpY2F0aW9uT3JpZ2luRW51bSdcclxuICAgIF0pLnNlcnZpY2UoJ2ZpbGVBdHRhY2htZW50U2VydmljZScsIEZpbGVBdHRhY2htZW50U2VydmljZSk7XHJcbn0iLCIvKipcclxuICogRXh0ZW5kcyB0aGUgRmlsZSBuYXRpdmUgdHlwZSB3aXRoIGEgbmV3IG1ldGhvZCAnZ2V0RmlsZUV4dGVuc2lvbidcclxuICovXHJcbmludGVyZmFjZSBGaWxlIHtcclxuICAgIGdldEZpbGVFeHRlbnNpb24oKTogc3RyaW5nO1xyXG59XHJcblxyXG4vL1RPRE8gTUdBOiB2ZXJ5IGltcG9ydGFudCB0byBub3QgdXNlIGRlbGVnYXRlIGhlcmUsIG90aGVyd2lzZSB0aGlzIGlzIGJhZGx5IGNhcHR1cmVkLiBpdCBNVVNUIGJlIGFuIGFub255bW91cyBmdW5jdGlvbi5cclxuRmlsZS5wcm90b3R5cGUuZ2V0RmlsZUV4dGVuc2lvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLm5hbWUuc3Vic3RyKHRoaXMubmFtZS5sYXN0SW5kZXhPZignLicpICsgMSk7XHJcbn1cclxuIiwidmFyIGJsdWVza3k7XG4oZnVuY3Rpb24gKGJsdWVza3kpIHtcbiAgICB2YXIgY29yZTtcbiAgICAoZnVuY3Rpb24gKGNvcmUpIHtcbiAgICAgICAgdmFyIGNvbXBvbmVudHM7XG4gICAgICAgIChmdW5jdGlvbiAoY29tcG9uZW50cykge1xuICAgICAgICAgICAgdmFyIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8jZW5kcmVnaW9uXG4gICAgICAgICAgICAgICAgLy8jcmVnaW9uIGN0b3JcbiAgICAgICAgICAgICAgICAvKiBAbmdJbmplY3QgKi9cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIoJGxvZywgdG9hc3RlciwgXywgZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLCBmaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIGFwcGxpY2F0aW9uT3JpZ2luRW51bSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cgPSAkbG9nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvYXN0ZXIgPSB0b2FzdGVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl8gPSBfO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZSA9IGZpbGVBdHRhY2htZW50U2VydmljZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBmaWxlQXR0YWNobWVudE9yaWdpbkVudW07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtID0gYXBwbGljYXRpb25PcmlnaW5FbnVtO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc0N1cnJlbnRVc2VyVXBsb2FkUmlnaHRzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvblxuICAgICAgICAgICAgICAgICAgICAvLyNyZWdpb24gcHJpdmF0ZSBmaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXhGaWxlU2l6ZSA9IDIwMDAwMDAwOyAvL2luIGJ5dGVzID0gMjBtYlxuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogVE9ETyBNR0E6IGltcHJvdmUgaW5saW5lLWZvcm0gZXJyb3IgaGFuZGxpbmcgJiBVSSBmZWVkYmFjayAhIG5vdCBkeW5hbWljIC8vIGZsdWlkIHRvIHVzZVxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0gZmlsZUF0dGFjaG1lbnRcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25VcGRhdGVkQ29tbWVudFZhbGlkYXRlSW5wdXQgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgfHwgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gJ2NvbW1lbnQgbXVzdCBiZSBub24tZW1wdHknO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50ICYmIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50Lmxlbmd0aCA+PSAyNTUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSA9ICdjb21tZW50IG11c3QgYmUgPCAyNTUgY2hhcmFjdGVycyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBudWxsOyAvL3Jlc2V0IGVycm9yIG1lc3NhZ2UgdG8gZmxhZyBjb21tZW50IGFzIHZhbGlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBIYW5kbGVyIGRlZGljYXRlZCB0byBwcmV2ZW50IG9uIGtleXByZXNzPSdlbnRlcicgdGhlIHN1Ym1pc3Npb24gb2YgYSBmb3JtIGlmIHRoaXMgY29tcG9uZW50IGlzIGluc2lkZSBvbmUuXG4gICAgICAgICAgICAgICAgICAgICAqIEluc3RlYWQsIGl0IHB1c2hlcyB0aGUgbmV3IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQ29tbWVudElucHV0S2V5UHJlc3MgPSBmdW5jdGlvbiAoJGV2ZW50LCBmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleUNvZGUgPSAkZXZlbnQua2V5Q29kZSB8fCAkZXZlbnQud2hpY2g7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3ByZXZlbnQgZm9ybSBzdWJtaXNzaW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jYWxsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvL1RPRE8gTUdBOiBuZWNlc3NhcnkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbGVtZW50SWRCaW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ3BhcmFtZXRlciB7ZWxlbWVudElkQmluZGluZ30gaXMgbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5hcHBsaWNhdGlvbk9yaWdpbkVudW1bdGhpcy5vcmlnaW5CaW5kaW5nXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdwYXJhbWV0ZXIge29yaWdpbkJpbmRpbmd9IGlzIG1hbmRhdG9yeS4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcyA9IG5ldyBBcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgbGlzdCBvZiBhdHRhY2hlZCBmaWxlcyBmb3IgY3VycmVudCBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgZmxhZyB0byBrbm93IGlmIGN1cnJlbnQgdXNlciBoYXMgdXBsb2FkIHJpZ2h0cyBmb3IgY3VycmVudCBpdGVtXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHMoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHN1cHBvcnRlZCBtaW1lIHR5cGVzIGZvciBmaWxlIHVwbG9hZCwgYmFzZWQgb24gc3J2IGluZm9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRTdXBwb3J0ZWRFeHRlbnNpb25zKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmJPZkl0ZW1zUGVyUGFnZSA9IDEwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5ID0gbmV3IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvblxuICAgICAgICAgICAgICAgIC8vI3JlZ2lvbiB2bSAvIHB1YmxpYyBtZXRob2RzXG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5kb3dubG9hZEF0dGFjaGVkRmlsZSA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50IHx8ICFmaWxlQXR0YWNobWVudC5JZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQsIHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW2ZpbGVBdHRhY2htZW50LkZpbGVPcmlnaW5dKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgPyBvciBsZWF2ZSBhcyBpcy5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5kZWxldGVBdHRhY2hlZEZpbGUgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9hc3Rlci5zdWNjZXNzKFwiRmlsZSAoXCIgKyBmaWxlQXR0YWNobWVudC5GaWxlTmFtZSArIFwiKSBzdWNjZXNzZnVsbHkgZGVsZXRlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlRmlsZUF0dGFjaG1lbnRDb21tZW50ID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkIHx8ICFmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9uVXBkYXRlZENvbW1lbnRWYWxpZGF0ZUlucHV0KGZpbGVBdHRhY2htZW50KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gY2hlY2sgdmFsaWRhdGlvbiBydWxlcyBhcmUgb2tcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0sIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNsZWFyRWRpdENvbW1lbnRNb2RlKGZpbGVBdHRhY2htZW50KTsgLy9UT0RPIE1HQTogdXNlbGVzcyBpZiB3ZSByZWxvYWQgYWxsIGRhdGEgZnJvbSBzcnZcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHJpZXZlIHVwZGF0ZSBsaXN0IG9mIGZpbGVzIHdpdGggdXBkYXRlZCBmaWxlIGNvbW1lbnQgZnJvbSBzcnYgOiBUT0RPIE1HQSBpbXByb3ZlIHJlbG9hZCAoY29zdGx5KVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBNR0EgOiBoaWdobGlnaHQgdXBkYXRlZCBjb21tZW50ID9cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jYW5jZWxFZGl0Q29tbWVudCA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC5lZGl0Q29tbWVudE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgLy9maWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCA9IFwiXCI7IC8vIFRPRE8gTUdBOiBkZWNpZGUgYmVoYXZpb3IgPyBiZXR0ZXIgdG8ga2VlcCBsYXN0IGVudHJ5ID8gYnV0IHRoZW4gd2UgbXVzdCBhbHNvIGtlZXAgZXJyb3IgbWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICAvL2ZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIC8vVE9ETyBNR0E6IGhhbmRsZSBtdWx0aXBsZSBmaWxlcyAmIGNsZWFuIHVwIHZpZXcgYmluZGluZ3NcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm9uRmlsZVNlbGVjdGVkID0gZnVuY3Rpb24gKGZpbGVzLCBmaWxlLCBuZXdGaWxlcywgZHVwbGljYXRlRmlsZXMsIGludmFsaWRGaWxlcywgZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlcyAmJiAhZmlsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheSA9IFtdOyAvL3Jlc2V0IGVycm9yIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbGVzID0gZmlsZXM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlID0gZmlsZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheS5wdXNoKCdDYW5ub3QgdXBsb2FkIG11bHRpcGxlIGZpbGVzIGF0IG91bmNlLiBQbGVhc2Ugc2VsZWN0IG9ubHkgb25lIGZpbGUuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy92YXIgZmlsZUV4dGVuc2lvbiA9IGZpbGUubmFtZS5zdWJzdHIoZmlsZS5uYW1lLmxhc3RJbmRleE9mKCcuJykgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVGb3JtYXRTdXBwb3J0ZWQgPSBfKHRoaXMuc3VwcG9ydGVkRXh0ZW5zaW9ucykuYW55KGZ1bmN0aW9uIChzdXBwb3J0ZWRFeHRlbnNpb24pIHsgcmV0dXJuIF90aGlzLnNlbGVjdGVkRmlsZS5nZXRGaWxlRXh0ZW5zaW9uKCkgPT09IHN1cHBvcnRlZEV4dGVuc2lvbjsgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbGVGb3JtYXRTdXBwb3J0ZWQgPSBmaWxlLnR5cGUgJiYgLy9JZiBmaWxlLnR5cGUgaXMgbnVsbCAvIGVtcHR5LCB0aGF0IG1lYW5zIGN1cnJlbnQgT1MgZG9lc24ndCBrbm93IGFib3V0IHRoZSBmaWxlIGZvcm1hdCA9PiBkZWxlZ2F0ZSB0byBzZXJ2ZXIgdG8gdmFsaWRhdGUgaWYgZm9ybWF0IGlzIHZhbGlkLCB3ZSBjYW4ndCBrbm93IGNsaWVudC1zaWRlLlxuICAgICAgICAgICAgICAgICAgICAvLyAgICBfKHRoaXMuc3VwcG9ydGVkRXh0ZW5zaW9ucykuYW55KChzdXBwb3J0ZWRNaW1lVHlwZSkgPT4gZmlsZS50eXBlID09PSBzdXBwb3J0ZWRNaW1lVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUZvcm1hdFN1cHBvcnRlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkucHVzaChcIlVuc3VwcG9ydGVkIGZpbGUgZm9ybWF0OiAnXCIgKyB0aGlzLnNlbGVjdGVkRmlsZS50eXBlICsgXCInIHdpdGggZXh0ZW5zaW9uOiAnXCIgKyB0aGlzLnNlbGVjdGVkRmlsZS5nZXRGaWxlRXh0ZW5zaW9uKCkgKyBcIidcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZWxlY3RlZEZpbGUuc2l6ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkucHVzaCgnU2VsZWN0ZWQgZmlsZSBpcyBlbXB0eS4nKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zZWxlY3RlZEZpbGUuc2l6ZSA+PSB0aGlzLm1heEZpbGVTaXplKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheS5wdXNoKFwiU2VsZWN0ZWQgZmlsZSBpcyBiaWdnZXIgKFwiICsgdGhpcy5jb252ZXJ0Qnl0ZXNUb01lZ2FCeXRlcyh0aGlzLnNlbGVjdGVkRmlsZS5zaXplKSArIFwibWIpIHRoYW4gYXV0aG9yaXplZCBmaWxlIHNpemU6IFwiICsgdGhpcy5jb252ZXJ0Qnl0ZXNUb01lZ2FCeXRlcyh0aGlzLm1heEZpbGVTaXplKSArIFwibWJcIik7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmltcG9ydFNlbGVjdGVkRmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRmlsZSB8fCBfKHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkpLmFueSgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvL1RPRE8gTUdBICRsb2dcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZSh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZywgdGhpcy5zZWxlY3RlZEZpbGUpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9hc3Rlci5zdWNjZXNzKFwiRmlsZSAoXCIgKyBfdGhpcy5zZWxlY3RlZEZpbGUubmFtZSArIFwiKSBzdWNjZXNzZnVsbHkgdXBsb2FkZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2V0QXR0YWNoZWRGaWxlcygpOyAvL1RPRE8gTUdBIDogaGlnaGxpZ2h0IG5ldyBlbnRyeSA/XG4gICAgICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jbGVhbiB1cCBzZWxlY3RlZCBmaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGVhclNlbGVjdGVkRmlsZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jbGVhclNlbGVjdGVkRmlsZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRGaWxlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheSA9IFtdOyAvLyBjbGVhciBlcnJvciBtZXNzYWdlc1xuICAgICAgICAgICAgICAgICAgICAvL3RoaXMuZmlsZVNlbGVjdGVkSXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNvbnZlcnRCeXRlc1RvTWVnYUJ5dGVzID0gZnVuY3Rpb24gKGJ5dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiArKGJ5dGVzIC8gMTAwMDAwMCkudG9GaXhlZCgyKTsgLy9jb252ZXJ0cyBiYWNrIHRvIG51bWJlciAyLWRpZ2l0cyBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2Ygb3JpZ2luYWwgY29udmVyc2lvbi5cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvblxuICAgICAgICAgICAgICAgIC8vI3JlZ2lvbiBwcml2YXRlIG1ldGhvZHNcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmdldEF0dGFjaGVkRmlsZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmdldEF0dGFjaGVkRmlsZXModGhpcy5lbGVtZW50SWRCaW5kaW5nLCB0aGlzLm9yaWdpbkJpbmRpbmcpLnRoZW4oZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50TGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0YWNoZWRGaWxlTGlzdCA9IGZpbGVBdHRhY2htZW50TGlzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dGFjaGVkRmlsZUxpc3RTb3VyY2UgPSBmaWxlQXR0YWNobWVudExpc3Q7IC8vVE9ETyBNR0EgOiBkdXBsaWNhdGUgPyB0byBwcmV2ZW50IHVwZGF0ZSB0byBzb3VyY2UgbGlzdCBpZiBjb2xsZWN0aW9uIG1vZGlmaWVkID9cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5nZXRTdXBwb3J0ZWRFeHRlbnNpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5nZXRTdXBwb3J0ZWRFeHRlbnNpb25zKCkudGhlbihmdW5jdGlvbiAoc3VwcG9ydGVkRXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3VwcG9ydGVkRXh0ZW5zaW9ucyA9IF8oc3VwcG9ydGVkRXh0ZW5zaW9ucykudW5pcSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNsZWFyRWRpdENvbW1lbnRNb2RlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LmVkaXRDb21tZW50TW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHModGhpcy5lbGVtZW50SWRCaW5kaW5nLCB0aGlzLm9yaWdpbkJpbmRpbmcpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoYm9vbGVhblJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYXNDdXJyZW50VXNlclVwbG9hZFJpZ2h0cyA9IGJvb2xlYW5SZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyO1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIGNvbXBvbmVudHMuRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyID0gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyO1xuICAgICAgICAgICAgdmFyIEZpbGVBdHRhY2htZW50Q29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBGaWxlQXR0YWNobWVudENvbXBvbmVudCgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRJZEJpbmRpbmc6ICc9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbkJpbmRpbmc6ICc9J1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlckFzID0gJ3ZtJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZVVybCA9ICdjb21wb25lbnQvZmlsZS1hdHRhY2htZW50LnRwbC5odG1sJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIEZpbGVBdHRhY2htZW50Q29tcG9uZW50O1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIGNvbXBvbmVudHMuRmlsZUF0dGFjaG1lbnRDb21wb25lbnQgPSBGaWxlQXR0YWNobWVudENvbXBvbmVudDtcbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUuY29tcG9uZW50cy5maWxlQXR0YWNobWVudCcsIFtcbiAgICAgICAgICAgICAgICAnY2dCdXN5JyxcbiAgICAgICAgICAgICAgICAnc21hcnQtdGFibGUnLFxuICAgICAgICAgICAgICAgICd0b2FzdGVyJyxcbiAgICAgICAgICAgICAgICAnZmlsZS1hdHRhY2htZW50LWNvbXBvbmVudC10cGwnLFxuICAgICAgICAgICAgICAgICdibHVlc2t5LmNvcmUuc2VydmljZXMuZmlsZUF0dGFjaG1lbnQnLFxuICAgICAgICAgICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsXG4gICAgICAgICAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuYXBwbGljYXRpb25PcmlnaW5FbnVtJ1xuICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAudmFsdWUoJ2NnQnVzeURlZmF1bHRzJywgeyB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9hbmd1bGFyLWJ1c3kvYW5ndWxhci1idXN5LWN1c3RvbS50cGwuaHRtbCcgfSlcbiAgICAgICAgICAgICAgICAuY29uc3RhbnQoJ18nLCB3aW5kb3dbJ18nXSlcbiAgICAgICAgICAgICAgICAuY29uc3RhbnQoJ21vbWVudCcsIHdpbmRvd1snbW9tZW50J10pXG4gICAgICAgICAgICAgICAgLmNvbXBvbmVudCgnZmlsZUF0dGFjaG1lbnRDb21wb25lbnQnLCBuZXcgRmlsZUF0dGFjaG1lbnRDb21wb25lbnQoKSk7XG4gICAgICAgIH0pKGNvbXBvbmVudHMgPSBjb3JlLmNvbXBvbmVudHMgfHwgKGNvcmUuY29tcG9uZW50cyA9IHt9KSk7XG4gICAgfSkoY29yZSA9IGJsdWVza3kuY29yZSB8fCAoYmx1ZXNreS5jb3JlID0ge30pKTtcbn0pKGJsdWVza3kgfHwgKGJsdWVza3kgPSB7fSkpO1xuXG52YXIgYmx1ZXNreTtcbihmdW5jdGlvbiAoYmx1ZXNreSkge1xuICAgIHZhciBjb3JlO1xuICAgIChmdW5jdGlvbiAoY29yZSkge1xuICAgICAgICB2YXIgbW9kZWxzO1xuICAgICAgICAoZnVuY3Rpb24gKG1vZGVscykge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUT0RPIE1HQSA6IGRlY2lkZSBvbiBwcmFjdGljZSB0byBzaGFyZSBlbnVtcyB3aXRoIHNydiBldGNcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgKGZ1bmN0aW9uIChBcHBsaWNhdGlvbk9yaWdpbkVudW0pIHtcbiAgICAgICAgICAgICAgICBBcHBsaWNhdGlvbk9yaWdpbkVudW1bQXBwbGljYXRpb25PcmlnaW5FbnVtW1wiUXVvdGVXaXphcmRcIl0gPSAwXSA9IFwiUXVvdGVXaXphcmRcIjtcbiAgICAgICAgICAgICAgICBBcHBsaWNhdGlvbk9yaWdpbkVudW1bQXBwbGljYXRpb25PcmlnaW5FbnVtW1wiT3JkZXJFbnRyeVwiXSA9IDFdID0gXCJPcmRlckVudHJ5XCI7XG4gICAgICAgICAgICAgICAgQXBwbGljYXRpb25PcmlnaW5FbnVtW0FwcGxpY2F0aW9uT3JpZ2luRW51bVtcIk9yZGVyVHJhY2tpbmdcIl0gPSAyXSA9IFwiT3JkZXJUcmFja2luZ1wiO1xuICAgICAgICAgICAgfSkobW9kZWxzLkFwcGxpY2F0aW9uT3JpZ2luRW51bSB8fCAobW9kZWxzLkFwcGxpY2F0aW9uT3JpZ2luRW51bSA9IHt9KSk7XG4gICAgICAgICAgICB2YXIgQXBwbGljYXRpb25PcmlnaW5FbnVtID0gbW9kZWxzLkFwcGxpY2F0aW9uT3JpZ2luRW51bTtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogZGVjbGFyZWQgYXMgYW5ndWxhciBtb2R1bGUgdG8gYmUgaW5qZWN0ZWQgYXQgcnVudGltZSBpbnNpZGUgY29udHJvbGxlcnMvc2VydmljZXMgdG8gdXNlIGl0IGFzIGEgZGljdGlvbm5hcnkuXG4gICAgICAgICAgICAgKiBPdGhlcndpc2UsIHdlIGFyZSBub3Qgc3VyZSB0aGUgcmVmZXJlbmNlIHRvIHRoaXMgb2JqZWN0IHdpbGwgdmUga25vd24gYXQgcnVudGltZSBkdWUgdG8gb3JkZXIgb2YgZXZhbHVhdGlvbiBvZiBpbXBvcnRzIGluc2lkZSBnZW5lcmF0ZWQganMuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUubW9kZWxzLmFwcGxpY2F0aW9uT3JpZ2luRW51bScsIFtdKVxuICAgICAgICAgICAgICAgIC5jb25zdGFudCgnYXBwbGljYXRpb25PcmlnaW5FbnVtJywgQXBwbGljYXRpb25PcmlnaW5FbnVtKTtcbiAgICAgICAgfSkobW9kZWxzID0gY29yZS5tb2RlbHMgfHwgKGNvcmUubW9kZWxzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBtb2RlbHM7XG4gICAgICAgIChmdW5jdGlvbiAobW9kZWxzKSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRPRE8gTUdBIDogZGVjaWRlIG9uIHByYWN0aWNlIHRvIHNoYXJlIGVudW1zIHdpdGggc3J2IGV0Y1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAoZnVuY3Rpb24gKEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSkge1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bXCJRdW90ZVdpemFyZEZpbGVBdHRhY2htZW50XCJdID0gMF0gPSBcIlF1b3RlV2l6YXJkRmlsZUF0dGFjaG1lbnRcIjtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiT3JkZXJFbnRyeUN1c3RvbURldGFpbHNcIl0gPSAxXSA9IFwiT3JkZXJFbnRyeUN1c3RvbURldGFpbHNcIjtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiT3JkZXJFbnRyeUF1ZGlvQ3VzdG9tRGV0YWlsXCJdID0gMl0gPSBcIk9yZGVyRW50cnlBdWRpb0N1c3RvbURldGFpbFwiO1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bXCJPcmRlclRyYWNraW5nRmlsZUF0dGFjaG1lbnRcIl0gPSAzXSA9IFwiT3JkZXJUcmFja2luZ0ZpbGVBdHRhY2htZW50XCI7XG4gICAgICAgICAgICB9KShtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtIHx8IChtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0ge30pKTtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtO1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBkZWNsYXJlZCBhcyBhbmd1bGFyIG1vZHVsZSB0byBiZSBpbmplY3RlZCBhdCBydW50aW1lIGluc2lkZSBjb250cm9sbGVycy9zZXJ2aWNlcyB0byB1c2UgaXQgYXMgYSBkaWN0aW9ubmFyeS5cbiAgICAgICAgICAgICAqIE90aGVyd2lzZSwgd2UgYXJlIG5vdCBzdXJlIHRoZSByZWZlcmVuY2UgdG8gdGhpcyBvYmplY3Qgd2lsbCB2ZSBrbm93biBhdCBydW50aW1lIGR1ZSB0byBvcmRlciBvZiBldmFsdWF0aW9uIG9mIGltcG9ydHMgaW5zaWRlIGdlbmVyYXRlZCBqcy5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJywgW10pXG4gICAgICAgICAgICAgICAgLmNvbnN0YW50KCdmaWxlQXR0YWNobWVudE9yaWdpbkVudW0nLCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pO1xuICAgICAgICB9KShtb2RlbHMgPSBjb3JlLm1vZGVscyB8fCAoY29yZS5tb2RlbHMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcblxudmFyIGJsdWVza3k7XG4oZnVuY3Rpb24gKGJsdWVza3kpIHtcbiAgICB2YXIgY29yZTtcbiAgICAoZnVuY3Rpb24gKGNvcmUpIHtcbiAgICAgICAgdmFyIG1vZGVscztcbiAgICAgICAgKGZ1bmN0aW9uIChtb2RlbHMpIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVE9ETyBNR0EgOiBleHBvcnQgYW4gaW50ZXJmYWNlIHRvbyA/XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnQoXG4gICAgICAgICAgICAgICAgICAgIC8vc3J2LXNpZGUgcHJvcGVydGllc1xuICAgICAgICAgICAgICAgICAgICBJZCwgRmlsZU5hbWUsIENvbW1lbnQsIFVwbG9hZGVySW5mb3JtYXRpb24sIENyZWF0aW9uRGF0ZSwgRmlsZU9yaWdpbiwgQ2FuQ3VycmVudFVzZXJEb3dubG9hZEZpbGUsIENhbkN1cnJlbnRVc2VyRGVsZXRlRmlsZSwgQ2FuQ3VycmVudFVzZXJFZGl0Q29tbWVudCwgXG4gICAgICAgICAgICAgICAgICAgIC8vY2xpZW50LXNpZGUgcHJvcGVydGllc1xuICAgICAgICAgICAgICAgICAgICBlZGl0Q29tbWVudE1vZGUsIHVwZGF0ZWRDb21tZW50LCB1cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gSWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRmlsZU5hbWUgPSBGaWxlTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Db21tZW50ID0gQ29tbWVudDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5VcGxvYWRlckluZm9ybWF0aW9uID0gVXBsb2FkZXJJbmZvcm1hdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5DcmVhdGlvbkRhdGUgPSBDcmVhdGlvbkRhdGU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRmlsZU9yaWdpbiA9IEZpbGVPcmlnaW47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ2FuQ3VycmVudFVzZXJEb3dubG9hZEZpbGUgPSBDYW5DdXJyZW50VXNlckRvd25sb2FkRmlsZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5DYW5DdXJyZW50VXNlckRlbGV0ZUZpbGUgPSBDYW5DdXJyZW50VXNlckRlbGV0ZUZpbGU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ2FuQ3VycmVudFVzZXJFZGl0Q29tbWVudCA9IENhbkN1cnJlbnRVc2VyRWRpdENvbW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdENvbW1lbnRNb2RlID0gZWRpdENvbW1lbnRNb2RlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZWRDb21tZW50ID0gdXBkYXRlZENvbW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSB1cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIEZpbGVBdHRhY2htZW50O1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIG1vZGVscy5GaWxlQXR0YWNobWVudCA9IEZpbGVBdHRhY2htZW50O1xuICAgICAgICAgICAgdmFyIFVzZXJJbmZvcm1hdGlvbiA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gVXNlckluZm9ybWF0aW9uKEZpcnN0TmFtZSwgTGFzdE5hbWUsIERpc3BsYXlOYW1lLCB1c2VySWRlbnRpZmllciwgRW1haWwsIFBob25lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRmlyc3ROYW1lID0gRmlyc3ROYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkxhc3ROYW1lID0gTGFzdE5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRGlzcGxheU5hbWUgPSBEaXNwbGF5TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VySWRlbnRpZmllciA9IHVzZXJJZGVudGlmaWVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkVtYWlsID0gRW1haWw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuUGhvbmVOdW1iZXIgPSBQaG9uZU51bWJlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFVzZXJJbmZvcm1hdGlvbjtcbiAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICBtb2RlbHMuVXNlckluZm9ybWF0aW9uID0gVXNlckluZm9ybWF0aW9uO1xuICAgICAgICB9KShtb2RlbHMgPSBjb3JlLm1vZGVscyB8fCAoY29yZS5tb2RlbHMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcblxudmFyIGJsdWVza3k7XG4oZnVuY3Rpb24gKGJsdWVza3kpIHtcbiAgICB2YXIgY29yZTtcbiAgICAoZnVuY3Rpb24gKGNvcmUpIHtcbiAgICAgICAgdmFyIG1vZGVscztcbiAgICAgICAgKGZ1bmN0aW9uIChtb2RlbHMpIHtcbiAgICAgICAgICAgIHZhciBKc29uQm9vbGVhblJlc3BvbnNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBKc29uQm9vbGVhblJlc3BvbnNlKGJvb2xlYW5SZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvb2xlYW5SZXNwb25zZSA9IGJvb2xlYW5SZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpzb25Cb29sZWFuUmVzcG9uc2U7XG4gICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgbW9kZWxzLkpzb25Cb29sZWFuUmVzcG9uc2UgPSBKc29uQm9vbGVhblJlc3BvbnNlO1xuICAgICAgICB9KShtb2RlbHMgPSBjb3JlLm1vZGVscyB8fCAoY29yZS5tb2RlbHMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcblxudmFyIGJsdWVza3k7XG4oZnVuY3Rpb24gKGJsdWVza3kpIHtcbiAgICB2YXIgY29yZTtcbiAgICAoZnVuY3Rpb24gKGNvcmUpIHtcbiAgICAgICAgdmFyIHNlcnZpY2VzO1xuICAgICAgICAoZnVuY3Rpb24gKHNlcnZpY2VzKSB7XG4gICAgICAgICAgICB2YXIgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvKiBAbmdJbmplY3QgKi9cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBGaWxlQXR0YWNobWVudFNlcnZpY2UoaHR0cFdyYXBwZXJTZXJ2aWNlLCAkbG9nLCAkdGltZW91dCwgVXBsb2FkLCBCbG9iLCAvL1RPRE8gTUdBOiB0eXBpbmdzID9cbiAgICAgICAgICAgICAgICAgICAgRmlsZVNhdmVyLCAvL1RPRE8gTUdBOiB0eXBpbmdzID9cbiAgICAgICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCBhcHBsaWNhdGlvbk9yaWdpbkVudW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwV3JhcHBlclNlcnZpY2UgPSBodHRwV3JhcHBlclNlcnZpY2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvZyA9ICRsb2c7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRpbWVvdXQgPSAkdGltZW91dDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5VcGxvYWQgPSBVcGxvYWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQmxvYiA9IEJsb2I7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRmlsZVNhdmVyID0gRmlsZVNhdmVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bSA9IGZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBsaWNhdGlvbk9yaWdpbkVudW0gPSBhcHBsaWNhdGlvbk9yaWdpbkVudW07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZ2V0QXR0YWNoZWRGaWxlcyA9IGZ1bmN0aW9uIChlbGVtZW50SWQsIGFwcGxpY2F0aW9uT3JpZ2luKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgOiBjbGVhbmVyIHBhcmFtcyBoYW5kbGluZyB0byBwYXNzIHRvIGh0dHAgY2FsbFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0KCdmaWxlLWF0dGFjaG1lbnQvc2VhcmNoJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdlbGVtZW50SWQnOiBlbGVtZW50SWQsICdhcHBsaWNhdGlvbk9yaWdpbic6IHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtW2FwcGxpY2F0aW9uT3JpZ2luXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmF0dGFjaEZpbGUgPSBmdW5jdGlvbiAoZWxlbWVudElkLCBhcHBsaWNhdGlvbk9yaWdpbiwgZmlsZVRvVXBsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZVRvVXBsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cud2FybignW2ZpbGVBdHRhY2htZW50U2VydmljZS5hdHRhY2hGaWxlXSBmaWxlIGlzIGVtcHR5LCBhYm9ydGluZyB1cGxvYWQuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBOiB3ZSBzaG91bGQgcmVseSBvbiBhIHN0cm9uZ2VyIGh0dHAtd3JhcHBlciB0byBoYW5kbGUgdXBsb2FkIHRoaXMgd2F5XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlVwbG9hZC5iYXNlNjREYXRhVXJsKGZpbGVUb1VwbG9hZCkudGhlbihmdW5jdGlvbiAoZmlsZUJhc2U2NFVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmh0dHBXcmFwcGVyU2VydmljZS5wb3N0KCdmaWxlLWF0dGFjaG1lbnQvcHV0JywgXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY3JlYXRlIG1vZGVsIGZvciBBdHRhY2hGaWxlRHRvICYgRmlsZVVwbG9hZEJhc2VEdG9cbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRWxlbWVudElkJzogZWxlbWVudElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBcHBsaWNhdGlvbk9yaWdpbic6IF90aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVVcGxvYWRCYXNlRHRvJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRmlsZU5hbWUnOiBmaWxlVG9VcGxvYWQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVCYXNlNjRVcmwnOiBmaWxlQmFzZTY0VXJsLnNsaWNlKGZpbGVCYXNlNjRVcmwuaW5kZXhPZignYmFzZTY0LCcpICsgJ2Jhc2U2NCwnLmxlbmd0aCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50VHlwZSc6IGZpbGVUb1VwbG9hZC50eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZEluQmFzZTY0SnNvbjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5kb3dubG9hZEF0dGFjaGVkRmlsZSA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCwgZmlsZU9yaWdpbikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50IHx8ICFmaWxlQXR0YWNobWVudC5JZCB8fCAhZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcignW2ZpbGVBdHRhY2htZW50XSBtYW5kYXRvcnkuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0RmlsZSgnZmlsZS1hdHRhY2htZW50L2Rvd25sb2FkJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdmaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnQuSWQsICdmaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETyBNR0E6IGV4dHJhY3QgZmlsZSBkb3dubG9hZCBhcyBhIHNlcGFyYXRlIHNlcnZpY2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbGV3aXRoQk9NID0gJ1xcdUZFRkYnKyBmaWxlOyAvL0FkZCBCT00gVVRGLTggYmVmb3JlID8gZm9yIG5vdyBkZWxheWVkIHRvIEZpbGVTYXZlci5zYXZlQXMoKSBmbGFnIGF1dG9CT00gcGFyYW1ldGVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZS5jb250ZW50XSwgeyB0eXBlOiBmaWxlLnR5cGUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07dXRmLTgnIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnaW1hZ2UvcG5nO2NoYXJzZXQ9d2luZG93cy0xMjUyJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PUlTTy04ODU5LTEnIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuRmlsZVNhdmVyLnNhdmVBcyhibG9iLCBmaWxlLm5hbWUgfHwgZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWUgfHwgJ3Vua25vd24uYmluJyk7IC8vIGF1dG9CT00gZW5hYmxlZCBieSBkZWZhdWx0XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5kZWxldGVBdHRhY2hlZEZpbGUgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnRJZCwgZmlsZU9yaWdpbikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZGVsZXRlKCdmaWxlLWF0dGFjaG1lbnQvZGVsZXRlJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdmaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnRJZCwgJ2ZpbGVPcmlnaW4nOiB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlT3JpZ2luXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmVkaXRGaWxlQXR0YWNobWVudENvbW1lbnQgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnRJZCwgZmlsZU9yaWdpbiwgdXBkYXRlZENvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLnBvc3QoJ2ZpbGUtYXR0YWNobWVudC91cGRhdGUtY29tbWVudCcsIFxuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY3JlYXRlIER0byBjbGllbnQtc2lkZSBvciB1cGRhdGUgZW5kcG9pbnQgc3J2LXNpZGUgdG8gc3VwcG9ydCBwYXJ0LXBhcmFtcyB1cmwgKyBjb21tZW50IGFzIHBheWxvYWQgKGNsZWFuZXIgU09DKS5cbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVPcmlnaW4nOiB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlT3JpZ2luXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdDb21tZW50JzogdXBkYXRlZENvbW1lbnRcbiAgICAgICAgICAgICAgICAgICAgfSwgeyBhcGlFbmRwb2ludDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZ2V0U3VwcG9ydGVkRXh0ZW5zaW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L2F1dGhvcml6ZWQtZmlsZS1leHRlbnNpb25zJywgeyBhcGlFbmRwb2ludDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZ2V0U3VwcG9ydGVkTWltZVR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0KCdmaWxlLWF0dGFjaG1lbnQvYXV0aG9yaXplZC1taW1lLXR5cGVzJywgeyBhcGlFbmRwb2ludDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHMgPSBmdW5jdGlvbiAoZWxlbWVudElkLCBhcHBsaWNhdGlvbk9yaWdpbikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0KCdmaWxlLWF0dGFjaG1lbnQvZ2V0LWN1cnJlbnQtdXNlci11cGxvYWQtcmlnaHRzJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdlbGVtZW50SWQnOiBlbGVtZW50SWQsICdhcHBsaWNhdGlvbk9yaWdpbic6IHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtW2FwcGxpY2F0aW9uT3JpZ2luXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgeyByZXR1cm4gcmVzcG9uc2UuYm9vbGVhblJlc3BvbnNlOyB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBGaWxlQXR0YWNobWVudFNlcnZpY2U7XG4gICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgc2VydmljZXMuRmlsZUF0dGFjaG1lbnRTZXJ2aWNlID0gRmlsZUF0dGFjaG1lbnRTZXJ2aWNlO1xuICAgICAgICAgICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5zZXJ2aWNlcy5maWxlQXR0YWNobWVudCcsIFtcbiAgICAgICAgICAgICAgICAnbmcuaHR0cFdyYXBwZXInLFxuICAgICAgICAgICAgICAgICduZ0ZpbGVVcGxvYWQnLFxuICAgICAgICAgICAgICAgICduZ0ZpbGVTYXZlcicsXG4gICAgICAgICAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJyxcbiAgICAgICAgICAgICAgICAnYmx1ZXNreS5jb3JlLm1vZGVscy5hcHBsaWNhdGlvbk9yaWdpbkVudW0nXG4gICAgICAgICAgICBdKS5zZXJ2aWNlKCdmaWxlQXR0YWNobWVudFNlcnZpY2UnLCBGaWxlQXR0YWNobWVudFNlcnZpY2UpO1xuICAgICAgICB9KShzZXJ2aWNlcyA9IGNvcmUuc2VydmljZXMgfHwgKGNvcmUuc2VydmljZXMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcblxuLy9UT0RPIE1HQTogdmVyeSBpbXBvcnRhbnQgdG8gbm90IHVzZSBkZWxlZ2F0ZSBoZXJlLCBvdGhlcndpc2UgdGhpcyBpcyBiYWRseSBjYXB0dXJlZC4gaXQgTVVTVCBiZSBhbiBhbm9ueW1vdXMgZnVuY3Rpb24uXG5GaWxlLnByb3RvdHlwZS5nZXRGaWxlRXh0ZW5zaW9uID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLm5hbWUuc3Vic3RyKHRoaXMubmFtZS5sYXN0SW5kZXhPZignLicpICsgMSk7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
