var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var components;
        (function (components) {
            var FileAttachmentComponentController = (function () {
                //#endregion
                //#region ctor
                /* @ngInject */
                FileAttachmentComponentController.$inject = ["$log", "toaster", "fileAttachmentService", "fileAttachmentOriginEnum"];
                function FileAttachmentComponentController($log, toaster, fileAttachmentService, fileAttachmentOriginEnum) {
                    this.$log = $log;
                    this.toaster = toaster;
                    this.fileAttachmentService = fileAttachmentService;
                    this.fileAttachmentOriginEnum = fileAttachmentOriginEnum;
                    this.fileAttachmentDownloadLinkElementId = 'file-attachment-download-link'; //TODO MGA : to const ?
                    if (!this.elementIdBinding) {
                        this.$log.error('parameter {elementIdBinding} is mandatory.');
                        return;
                    }
                    if (!this.fileAttachmentOriginEnum[this.originBinding]) {
                        this.$log.error('parameter {originBinding} is mandatory.');
                        return;
                    }
                    this.httpPromises = new Array();
                    // call srv to get list of files
                    this.getAttachedFiles();
                    this.nbOfItemsPerPage = 10;
                }
                //#endregion
                //#region vm methods
                FileAttachmentComponentController.prototype.getAttachedFiles = function () {
                    var _this = this;
                    var httpPromise = this.fileAttachmentService.getAttachedFiles(this.elementIdBinding, this.originBinding).then(function (fileAttachmentList) {
                        _this.attachedFileList = fileAttachmentList;
                        _this.attachedFileListSource = fileAttachmentList; //TODO MGA : duplicate ? to prevent update to source list if collection modified ?
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.downloadAttachedFile = function (fileAttachment) {
                    if (!fileAttachment || !fileAttachment.Id)
                        return;
                    var jQueryAnchorElement = $('#' + this.fileAttachmentDownloadLinkElementId); //add id selector
                    var httpPromise = this.fileAttachmentService.downloadAttachedFile(fileAttachment, this.originBinding, jQueryAnchorElement).then(function () {
                        //TODO MGA ? or leave as is.
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.deleteAttachedFile = function (fileAttachment) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id)
                        return;
                    var httpPromise = this.fileAttachmentService.deleteAttachedFile(fileAttachment.Id, this.originBinding).then(function () {
                        _this.toaster.success("File (" + fileAttachment.FileName + ") successfully deleted.");
                        _this.getAttachedFiles();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.updateFileAttachmentComment = function (fileAttachment, updatedComment) {
                    if (!fileAttachment || !fileAttachment.Id || !updatedComment)
                        return;
                    var httpPromise = this.fileAttachmentService.editFileAttachmentComment(fileAttachment.Id, this.originBinding, updatedComment).then(function () {
                        //TODO MGA : highlight updated comment ? + get out of edit mode
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.fileSelected = function (file, event) {
                    var _this = this;
                    if (!file)
                        return;
                    var httpPromise = this.fileAttachmentService.attachFile(this.elementIdBinding, this.originBinding, file).then(function () {
                        _this.toaster.success("File (" + file.name + ") successfully uploaded.");
                        _this.getAttachedFiles(); //TODO MGA : highlight new entry ?
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.openSelectFileDialog = function () {
                    //TODO MGA : simulate user direct click to input file field (hidden but used for AT tests)
                    $('#input-file-select-field').click();
                };
                //TODO MGA
                FileAttachmentComponentController.prototype.isSelectFileBtnDisabled = function () { return false; };
                return FileAttachmentComponentController;
            }());
            components.FileAttachmentComponentController = FileAttachmentComponentController;
            var FileAttachmentComponent = (function () {
                function FileAttachmentComponent() {
                    this.bindings = {
                        elementIdBinding: '=',
                        originBinding: '='
                    };
                    this.controller = FileAttachmentComponentController;
                    this.controllerAs = 'vm';
                    this.templateUrl = 'component/file-attachment.tpl.html';
                }
                return FileAttachmentComponent;
            }());
            components.FileAttachmentComponent = FileAttachmentComponent;
            angular.module('bluesky.core.components.fileAttachment', [
                'cgBusy',
                'smart-table',
                'toaster',
                'file-attachment-component-tpl',
                'bluesky.core.services.fileAttachment',
                'bluesky.core.models.fileAttachmentOriginEnum'
            ])
                .value('cgBusyDefaults', { templateUrl: 'templates/angular-busy/angular-busy-custom.tpl.html' })
                .component('fileAttachmentComponent', new FileAttachmentComponent());
        })(components = core.components || (core.components = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : decide on practice to share enums with srv etc
             */
            (function (FileAttachmentOriginEnum) {
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["QuoteWizardFileAttachment"] = 0] = "QuoteWizardFileAttachment";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderEntryCustomDetails"] = 1] = "OrderEntryCustomDetails";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderEntryAudioCustomDetail"] = 2] = "OrderEntryAudioCustomDetail";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderTrackingFileAttachment"] = 3] = "OrderTrackingFileAttachment";
            })(models.FileAttachmentOriginEnum || (models.FileAttachmentOriginEnum = {}));
            var FileAttachmentOriginEnum = models.FileAttachmentOriginEnum;
            /**
             * declared as angular module to be injected at runtime inside controllers/services to use it as a dictionnary
             */
            angular.module('bluesky.core.models.fileAttachmentOriginEnum', [])
                .constant('fileAttachmentOriginEnum', FileAttachmentOriginEnum);
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : export an interface too ?
             */
            var FileAttachment = (function () {
                function FileAttachment(Id, FileName, Comment, UploadedBy, CreationDate, Origin) {
                    this.Id = Id;
                    this.FileName = FileName;
                    this.Comment = Comment;
                    this.UploadedBy = UploadedBy;
                    this.CreationDate = CreationDate;
                    this.Origin = Origin;
                }
                return FileAttachment;
            }());
            models.FileAttachment = FileAttachment;
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var services;
        (function (services) {
            var FileAttachmentService = (function () {
                /* @ngInject */
                FileAttachmentService.$inject = ["httpWrapperService", "$log", "$timeout", "Upload", "Blob", "FileSaver", "fileAttachmentOriginEnum"];
                function FileAttachmentService(httpWrapperService, $log, $timeout, Upload, Blob, //TODO MGA: typings ?
                    FileSaver, //TODO MGA: typings ?
                    fileAttachmentOriginEnum) {
                    this.httpWrapperService = httpWrapperService;
                    this.$log = $log;
                    this.$timeout = $timeout;
                    this.Upload = Upload;
                    this.Blob = Blob;
                    this.FileSaver = FileSaver;
                    this.fileAttachmentOriginEnum = fileAttachmentOriginEnum;
                }
                FileAttachmentService.prototype.getAttachedFiles = function (elementId, origin) {
                    //TODO MGA : cleaner params handling to pass to http call
                    return this.httpWrapperService.get('file-attachment/search', {
                        params: { 'elementId': elementId, 'origin': this.fileAttachmentOriginEnum[origin] },
                        apiEndpoint: true
                    });
                };
                FileAttachmentService.prototype.downloadAttachedFile = function (fileAttachment, origin, anchorElement) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id || !fileAttachment.FileName) {
                        this.$log.error('[fileAttachment] mandatory.');
                        return null;
                    }
                    if (!anchorElement) {
                        this.$log.error('[anchorElement] mandatory.');
                        return null;
                    }
                    return this.httpWrapperService.get('file-attachment/download', {
                        params: { 'fileAttachmentId': fileAttachment.Id, 'origin': this.fileAttachmentOriginEnum[origin] },
                        apiEndpoint: true
                    }).then(function (file) {
                        //var filewithBOM = '\uFEFF'+ file;
                        var blob = new Blob([file], { type: 'application/octet-stream;utf-8' }); //TODO MGA: type ??? how to retrieve content-type from blob
                        //var blob = new Blob([file], { type: 'image/png;charset=windows-1252' }); //TODO MGA: type ??? how to retrieve content-type from blob
                        //var blob = new Blob([file], { type: 'image/png;charset=ISO-8859-1' }); //TODO MGA: type ??? how to retrieve content-type from blob
                        //var blob = new Blob([file], { type: 'image/png' }); //TODO MGA: type ??? how to retrieve content-type from blob
                        _this.FileSaver.saveAs(blob, fileAttachment.FileName || 'unknown.bin');
                        //var url = window.URL.createObjectURL(blob);
                        ////TODO MGA: delay to to be outside of current digest cycle : how to fix ?
                        //this.$timeout(() => {
                        //    anchorElement
                        //        .attr({
                        //            "href": url,
                        //            "download": 'unknown.png'
                        //            //"download": fileAttachmentName || 'unknown.bin'
                        //        })
                        //        //.html($("a").attr("download"))
                        //        .get(0).click();
                        //    window.URL.revokeObjectURL(url);
                        //    // TODO MGA : hack to trigger download of file from JS, to refactor in a directive + see Jquery limitations of click event : http://stackoverflow.com/questions/17311645/download-image-with-javascript 
                        //    //anchorElement.prop('href', url);
                        //    //anchorElement.prop('download', fileAttachmentName || 'unknown.bin'); //TODO MGA ???
                        //    //anchorElement.get(0).click();
                        //}, 0);
                        //anchorElement.click();
                        //setTimeout(function () {
                        // Added a small delay because file was removed to quickly in firefox and the download was even not initialized
                        // Remove temp element from browser cache : TODO MGA find a way to do this in a finally() clause in the service method ?
                        //window.URL.revokeObjectURL(url);
                        //}, 100);
                        return;
                    });
                };
                FileAttachmentService.prototype.deleteAttachedFile = function (fileAttachmentId, origin) {
                    return this.httpWrapperService.delete('file-attachment/delete', {
                        params: { 'fileAttachmentId': fileAttachmentId, 'origin': this.fileAttachmentOriginEnum[origin] },
                        apiEndpoint: true
                    });
                };
                FileAttachmentService.prototype.attachFile = function (elementId, origin, fileToUpload) {
                    var _this = this;
                    if (!fileToUpload) {
                        this.$log.warn('[fileAttachmentService.attachFile] file is empty, aborting upload.');
                        return null;
                    }
                    //TODO MGA: we should rely on a stronger http-wrapper to handle upload this way
                    return this.Upload.base64DataUrl(fileToUpload).then(function (fileBase64Url) {
                        return _this.httpWrapperService.post('file-attachment/put', 
                        //TODO MGA : create model for AttachFileDto & FileUploadBaseDto
                        {
                            'ElementId': elementId,
                            'Origin': _this.fileAttachmentOriginEnum[origin],
                            'FileUploadBaseDto': {
                                'FileName': fileToUpload.name,
                                'FileBase64Url': fileBase64Url.slice(fileBase64Url.indexOf('base64,') + 'base64,'.length),
                                'ContentType': fileToUpload.type
                            }
                        }, {
                            apiEndpoint: true,
                            uploadInBase64Json: true
                        });
                    });
                };
                FileAttachmentService.prototype.editFileAttachmentComment = function (fileAttachmentId, origin, updatedComment) {
                    return this.httpWrapperService.post('file-attachment/update-comment', 
                    //TODO MGA : create Dto client-side or update endpoint srv-side to support part-params url + comment as payload (cleaner SOC).
                    {
                        'FileAttachmentId': fileAttachmentId,
                        'Origin': this.fileAttachmentOriginEnum[origin],
                        'Comment': updatedComment
                    }, { apiEndpoint: true });
                };
                return FileAttachmentService;
            }());
            services.FileAttachmentService = FileAttachmentService;
            angular.module('bluesky.core.services.fileAttachment', [
                'ng.httpWrapper',
                'ngFileUpload',
                'ngFileSaver',
                'bluesky.core.models.fileAttachmentOriginEnum'
            ]).service('fileAttachmentService', FileAttachmentService);
        })(services = core.services || (core.services = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudC9maWxlLWF0dGFjaG1lbnQuY29tcG9uZW50LnRzIiwibW9kZWxzL2ZpbGUtYXR0YWNobWVudC1vcmlnaW4uZW51bS50cyIsIm1vZGVscy9maWxlLWF0dGFjaG1lbnQubW9kZWwudHMiLCJzZXJ2aWNlL2ZpbGUtYXR0YWNobWVudC5zZXJ2aWNlLnRzIiwibmctZmlsZS1hdHRhY2htZW50LWNvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFVO0FBQVYsQ0FBQSxVQUFVLFNBQU87SUFBQyxJQUFBO0lBQUEsQ0FBQSxVQUFBLE1BQUk7UUFBQyxJQUFBO1FBQUEsQ0FBQSxVQUFBLFlBQVc7WUFpQzlCLElBQUEscUNBQUEsWUFBQTs7Ozs7Z0JBdUJJLFNBQUEsa0NBQ1ksTUFDQSxTQUNBLHVCQUNBLDBCQUFrRDtvQkFIbEQsS0FBQSxPQUFBO29CQUNBLEtBQUEsVUFBQTtvQkFDQSxLQUFBLHdCQUFBO29CQUNBLEtBQUEsMkJBQUE7b0JBZFosS0FBQSxzQ0FBc0M7b0JBZ0JsQyxJQUFJLENBQUMsS0FBSyxrQkFBa0I7d0JBQ3hCLEtBQUssS0FBSyxNQUFNO3dCQUNoQjs7b0JBR0osSUFBSSxDQUFDLEtBQUsseUJBQXlCLEtBQUssZ0JBQWdCO3dCQUNwRCxLQUFLLEtBQUssTUFBTTt3QkFDaEI7O29CQUdKLEtBQUssZUFBZSxJQUFJOztvQkFHeEIsS0FBSztvQkFFTCxLQUFLLG1CQUFtQjs7OztnQkFRNUIsa0NBQUEsVUFBQSxtQkFBQSxZQUFBO29CQUFBLElBQUEsUUFBQTtvQkFDSSxJQUFJLGNBQWMsS0FBSyxzQkFBc0IsaUJBQWlCLEtBQUssa0JBQWtCLEtBQUssZUFBZSxLQUFLLFVBQUMsb0JBQWtCO3dCQUM3SCxNQUFLLG1CQUFtQjt3QkFDeEIsTUFBSyx5QkFBeUI7O29CQUdsQyxLQUFLLGFBQWEsS0FBSzs7Z0JBRzNCLGtDQUFBLFVBQUEsdUJBQUEsVUFBcUIsZ0JBQThCO29CQUMvQyxJQUFJLENBQUMsa0JB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O1lBMkhsQyxRQUFRLE9BQU8sd0NBQXdDO2dCQUNuRDtnQkFDQTtnQkFDQTtnQkFDQTtlQUNELFFBQVEseUJBQXlCO1dBbEpqQixXQUFBLEtBQUEsYUFBQSxLQUFBLFdBQVE7T0FBYixPQUFBLFFBQUEsU0FBQSxRQUFBLE9BQUk7R0FBWixZQUFBLFVBQU87QUM2UmpCIiwiZmlsZSI6Im5nLWZpbGUtYXR0YWNobWVudC1jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJuYW1lc3BhY2UgYmx1ZXNreS5jb3JlLmNvbXBvbmVudHMge1xyXG5cclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudCA9IGJsdWVza3kuY29yZS5tb2RlbHMuRmlsZUF0dGFjaG1lbnQ7XHJcbiAgICBpbXBvcnQgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudE9yaWdpbkVudW07XHJcbiAgICBpbXBvcnQgSUZpbGVBdHRhY2htZW50U2VydmljZSA9IGJsdWVza3kuY29yZS5zZXJ2aWNlcy5JRmlsZUF0dGFjaG1lbnRTZXJ2aWNlO1xyXG5cclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUZpbGVBdHRhY2htZW50Q29tcG9uZW50QmluZGluZ3Mge1xyXG4gICAgICAgIGVsZW1lbnRJZEJpbmRpbmc/OiBudW1iZXI7XHJcbiAgICAgICAgb3JpZ2luQmluZGluZz86IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIgZXh0ZW5kcyBJRmlsZUF0dGFjaG1lbnRDb21wb25lbnRCaW5kaW5ncyB7XHJcbiAgICAgICAgYXR0YWNoZWRGaWxlTGlzdDogQXJyYXk8RmlsZUF0dGFjaG1lbnQ+O1xyXG4gICAgICAgIGF0dGFjaGVkRmlsZUxpc3RTb3VyY2U6IEFycmF5PEZpbGVBdHRhY2htZW50PjtcclxuXHJcbiAgICAgICAgZmlsZUF0dGFjaG1lbnREb3dubG9hZExpbmtFbGVtZW50SWQ6IHN0cmluZztcclxuXHJcbiAgICAgICAgZ2V0QXR0YWNoZWRGaWxlcygpOiB2b2lkO1xyXG4gICAgICAgIGRvd25sb2FkQXR0YWNoZWRGaWxlOiAoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KSA9PiB2b2lkO1xyXG4gICAgICAgIGRlbGV0ZUF0dGFjaGVkRmlsZTogKGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCkgPT4gdm9pZDtcclxuXHJcbiAgICAgICAgZmlsZVRvVXBsb2FkOiBzdHJpbmc7XHJcblxyXG4gICAgICAgIGZpbGVTZWxlY3RlZDogKGZpbGU6IEZpbGUsIGV2ZW50OiBuZy5hbmd1bGFyRmlsZVVwbG9hZC5JRmlsZVByb2dyZXNzRXZlbnQpID0+IHZvaWQ7XHJcblxyXG4gICAgICAgIG9wZW5TZWxlY3RGaWxlRGlhbG9nOiAoKSA9PiB2b2lkO1xyXG4gICAgICAgIGlzU2VsZWN0RmlsZUJ0bkRpc2FibGVkOiAoKSA9PiBib29sZWFuO1xyXG5cclxuICAgICAgICBuYk9mSXRlbXNQZXJQYWdlOiBudW1iZXI7XHJcblxyXG4gICAgICAgIGh0dHBQcm9taXNlczogQXJyYXk8bmcuSVByb21pc2U8YW55Pj47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciBpbXBsZW1lbnRzIElGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIge1xyXG5cclxuICAgICAgICAvLyNyZWdpb24gYmluZGluZyBwcm9wXHJcblxyXG4gICAgICAgIGVsZW1lbnRJZEJpbmRpbmc6IG51bWJlcjtcclxuICAgICAgICBvcmlnaW5CaW5kaW5nOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW07XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gdm0gcHJvcFxyXG5cclxuICAgICAgICBhdHRhY2hlZEZpbGVMaXN0OiBBcnJheTxGaWxlQXR0YWNobWVudD47XHJcbiAgICAgICAgYXR0YWNoZWRGaWxlTGlzdFNvdXJjZTogQXJyYXk8RmlsZUF0dGFjaG1lbnQ+O1xyXG4gICAgICAgIGZpbGVBdHRhY2htZW50RG93bmxvYWRMaW5rRWxlbWVudElkID0gJ2ZpbGUtYXR0YWNobWVudC1kb3dubG9hZC1saW5rJzsgLy9UT0RPIE1HQSA6IHRvIGNvbnN0ID9cclxuICAgICAgICBmaWxlVG9VcGxvYWQ6IHN0cmluZztcclxuICAgICAgICBuYk9mSXRlbXNQZXJQYWdlOiBudW1iZXI7XHJcbiAgICAgICAgaHR0cFByb21pc2VzOiBBcnJheTxuZy5JUHJvbWlzZTxhbnk+PjtcclxuXHJcbiAgICAgICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgICAgIC8vI3JlZ2lvbiBjdG9yXHJcblxyXG4gICAgICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgICAgICBwcml2YXRlICRsb2c6IG5nLklMb2dTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIHRvYXN0ZXI6IG5ndG9hc3Rlci5JVG9hc3RlclNlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgZmlsZUF0dGFjaG1lbnRTZXJ2aWNlOiBJRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bTogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5lbGVtZW50SWRCaW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ3BhcmFtZXRlciB7ZWxlbWVudElkQmluZGluZ30gaXMgbWFuZGF0b3J5LicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW3RoaXMub3JpZ2luQmluZGluZ10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcigncGFyYW1ldGVyIHtvcmlnaW5CaW5kaW5nfSBpcyBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzID0gbmV3IEFycmF5PG5nLklQcm9taXNlPGFueT4+KCk7XHJcblxyXG4gICAgICAgICAgICAvLyBjYWxsIHNydiB0byBnZXQgbGlzdCBvZiBmaWxlc1xyXG4gICAgICAgICAgICB0aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubmJPZkl0ZW1zUGVyUGFnZSA9IDEwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8jZW5kcmVnaW9uXHJcblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gdm0gbWV0aG9kc1xyXG5cclxuICAgICAgICBnZXRBdHRhY2hlZEZpbGVzKCk6IHZvaWQge1xyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5nZXRBdHRhY2hlZEZpbGVzKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nKS50aGVuKChmaWxlQXR0YWNobWVudExpc3QpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNoZWRGaWxlTGlzdCA9IGZpbGVBdHRhY2htZW50TGlzdDtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNoZWRGaWxlTGlzdFNvdXJjZSA9IGZpbGVBdHRhY2htZW50TGlzdDsgLy9UT0RPIE1HQSA6IGR1cGxpY2F0ZSA/IHRvIHByZXZlbnQgdXBkYXRlIHRvIHNvdXJjZSBsaXN0IGlmIGNvbGxlY3Rpb24gbW9kaWZpZWQgP1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgalF1ZXJ5QW5jaG9yRWxlbWVudCA9ICQoJyMnICsgdGhpcy5maWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZCk7IC8vYWRkIGlkIHNlbGVjdG9yXHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5kb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudCwgdGhpcy5vcmlnaW5CaW5kaW5nLCBqUXVlcnlBbmNob3JFbGVtZW50KS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgPyBvciBsZWF2ZSBhcyBpcy5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5vcmlnaW5CaW5kaW5nKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9hc3Rlci5zdWNjZXNzKGBGaWxlICgke2ZpbGVBdHRhY2htZW50LkZpbGVOYW1lfSkgc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQuYCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHVwZGF0ZUZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQsIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQgfHwgIXVwZGF0ZWRDb21tZW50KSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5lZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50KGZpbGVBdHRhY2htZW50LklkLCB0aGlzLm9yaWdpbkJpbmRpbmcsIHVwZGF0ZWRDb21tZW50KS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgOiBoaWdobGlnaHQgdXBkYXRlZCBjb21tZW50ID8gKyBnZXQgb3V0IG9mIGVkaXQgbW9kZVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmlsZVNlbGVjdGVkKGZpbGU6IEZpbGUsIGV2ZW50OiBuZy5hbmd1bGFyRmlsZVVwbG9hZC5JRmlsZVByb2dyZXNzRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5hdHRhY2hGaWxlKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nLCBmaWxlKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9hc3Rlci5zdWNjZXNzKGBGaWxlICgke2ZpbGUubmFtZX0pIHN1Y2Nlc3NmdWxseSB1cGxvYWRlZC5gKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpOyAvL1RPRE8gTUdBIDogaGlnaGxpZ2h0IG5ldyBlbnRyeSA/XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvcGVuU2VsZWN0RmlsZURpYWxvZygpOiB2b2lkIHtcclxuICAgICAgICAgICAgLy9UT0RPIE1HQSA6IHNpbXVsYXRlIHVzZXIgZGlyZWN0IGNsaWNrIHRvIGlucHV0IGZpbGUgZmllbGQgKGhpZGRlbiBidXQgdXNlZCBmb3IgQVQgdGVzdHMpXHJcbiAgICAgICAgICAgICQoJyNpbnB1dC1maWxlLXNlbGVjdC1maWVsZCcpLmNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL1RPRE8gTUdBXHJcbiAgICAgICAgaXNTZWxlY3RGaWxlQnRuRGlzYWJsZWQoKTogYm9vbGVhbiB7IHJldHVybiBmYWxzZTsgfVxyXG5cclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgRmlsZUF0dGFjaG1lbnRDb21wb25lbnQgaW1wbGVtZW50cyBuZy5JQ29tcG9uZW50T3B0aW9ucyB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBiaW5kaW5nczogYW55O1xyXG4gICAgICAgIHB1YmxpYyBjb250cm9sbGVyOiBhbnk7XHJcbiAgICAgICAgcHVibGljIGNvbnRyb2xsZXJBczogc3RyaW5nO1xyXG4gICAgICAgIHB1YmxpYyB0ZW1wbGF0ZVVybDogc3RyaW5nO1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYmluZGluZ3MgPSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50SWRCaW5kaW5nOiAnPScsXHJcbiAgICAgICAgICAgICAgICBvcmlnaW5CaW5kaW5nOiAnPSdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlciA9IEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlcjtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyQXMgPSAndm0nO1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlVXJsID0gJ2NvbXBvbmVudC9maWxlLWF0dGFjaG1lbnQudHBsLmh0bWwnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5jb3JlLmNvbXBvbmVudHMuZmlsZUF0dGFjaG1lbnQnLCBbXHJcbiAgICAgICAgJ2NnQnVzeScsXHJcbiAgICAgICAgJ3NtYXJ0LXRhYmxlJyxcclxuICAgICAgICAndG9hc3RlcicsXHJcbiAgICAgICAgJ2ZpbGUtYXR0YWNobWVudC1jb21wb25lbnQtdHBsJyxcclxuICAgICAgICAnYmx1ZXNreS5jb3JlLnNlcnZpY2VzLmZpbGVBdHRhY2htZW50JyxcclxuICAgICAgICAnYmx1ZXNreS5jb3JlLm1vZGVscy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0nXHJcbiAgICBdKVxyXG4gICAgLy9UT0RPIE1HQTogbWFrZSB0aGlzIHVuaWZvcm0gZm9yIGVhY2ggZGlyZWN0aXZlcyAvLyBzaGFyZSBiZWhhdmlvclxyXG4gICAgLnZhbHVlKCdjZ0J1c3lEZWZhdWx0cycsIHsgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvYW5ndWxhci1idXN5L2FuZ3VsYXItYnVzeS1jdXN0b20udHBsLmh0bWwnIH0pXHJcbiAgICAuY29tcG9uZW50KCdmaWxlQXR0YWNobWVudENvbXBvbmVudCcsIG5ldyBGaWxlQXR0YWNobWVudENvbXBvbmVudCgpKTtcclxuXHJcbn0iLCJuYW1lc3BhY2UgYmx1ZXNreS5jb3JlLm1vZGVscyB7XHJcbiAgICAvKipcclxuICAgICAqIFRPRE8gTUdBIDogZGVjaWRlIG9uIHByYWN0aWNlIHRvIHNoYXJlIGVudW1zIHdpdGggc3J2IGV0Y1xyXG4gICAgICovXHJcbiAgICBleHBvcnQgZW51bSBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0ge1xyXG4gICAgICAgIFF1b3RlV2l6YXJkRmlsZUF0dGFjaG1lbnQsXHJcbiAgICAgICAgT3JkZXJFbnRyeUN1c3RvbURldGFpbHMsXHJcbiAgICAgICAgT3JkZXJFbnRyeUF1ZGlvQ3VzdG9tRGV0YWlsLFxyXG4gICAgICAgIE9yZGVyVHJhY2tpbmdGaWxlQXR0YWNobWVudFxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogZGVjbGFyZWQgYXMgYW5ndWxhciBtb2R1bGUgdG8gYmUgaW5qZWN0ZWQgYXQgcnVudGltZSBpbnNpZGUgY29udHJvbGxlcnMvc2VydmljZXMgdG8gdXNlIGl0IGFzIGEgZGljdGlvbm5hcnlcclxuICAgICAqL1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJywgW10pXHJcbiAgICAgICAgICAgLmNvbnN0YW50KCdmaWxlQXR0YWNobWVudE9yaWdpbkVudW0nLCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pO1xyXG59IiwibmFtZXNwYWNlIGJsdWVza3kuY29yZS5tb2RlbHMge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVE9ETyBNR0EgOiBleHBvcnQgYW4gaW50ZXJmYWNlIHRvbyA/XHJcbiAgICAgKi9cclxuICAgIGV4cG9ydCBjbGFzcyBGaWxlQXR0YWNobWVudCB7XHJcbiAgICAgICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgICAgIHB1YmxpYyBJZDogbnVtYmVyLFxyXG4gICAgICAgICAgICBwdWJsaWMgRmlsZU5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIENvbW1lbnQ6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIFVwbG9hZGVkQnk6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIENyZWF0aW9uRGF0ZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgT3JpZ2luOiBzdHJpbmdcclxuICAgICAgICApIHsgfVxyXG4gICAgfVxyXG59IiwibmFtZXNwYWNlIGJsdWVza3kuY29yZS5zZXJ2aWNlcyB7XHJcblxyXG4gICAgaW1wb3J0IEZpbGVBdHRhY2htZW50ID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudDtcclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWxlQXR0YWNobWVudFNlcnZpY2Uge1xyXG5cclxuICAgICAgICBnZXRBdHRhY2hlZEZpbGVzKGVsZW1lbnRJZDogbnVtYmVyLCBvcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSk6IG5nLklQcm9taXNlPEFycmF5PEZpbGVBdHRhY2htZW50Pj47XHJcblxyXG4gICAgICAgIGF0dGFjaEZpbGUoZWxlbWVudElkOiBudW1iZXIsIG9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCBmaWxlVG9VcGxvYWQ6IEZpbGUpOiBuZy5JUHJvbWlzZTxhbnk+O1xyXG5cclxuICAgICAgICBkb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQsIG9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCBhbmNob3JFbGVtZW50OiBKUXVlcnkpOiBuZy5JUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgICAgICAgZGVsZXRlQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50SWQ6IG51bWJlciwgb3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgICAgICAgZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudElkOiBudW1iZXIsIG9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCB1cGRhdGVkQ29tbWVudDogc3RyaW5nKTogbmcuSVByb21pc2U8dm9pZD47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50U2VydmljZSBpbXBsZW1lbnRzIElGaWxlQXR0YWNobWVudFNlcnZpY2Uge1xyXG5cclxuICAgICAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgcHJpdmF0ZSBodHRwV3JhcHBlclNlcnZpY2U6IElIdHRwV3JhcHBlclNlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgJGxvZzogbmcuSUxvZ1NlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgJHRpbWVvdXQ6IG5nLklUaW1lb3V0U2VydmljZSxcclxuICAgICAgICAgICAgcHJpdmF0ZSBVcGxvYWQ6IG5nLmFuZ3VsYXJGaWxlVXBsb2FkLklVcGxvYWRTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIEJsb2I6IGFueSwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XHJcbiAgICAgICAgICAgIHByaXZhdGUgRmlsZVNhdmVyOiBhbnksIC8vVE9ETyBNR0E6IHR5cGluZ3MgP1xyXG4gICAgICAgICAgICBwcml2YXRlIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bTogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtXHJcbiAgICAgICAgKSB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0QXR0YWNoZWRGaWxlcyhlbGVtZW50SWQ6IG51bWJlciwgb3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTxBcnJheTxGaWxlQXR0YWNobWVudD4+IHtcclxuICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNsZWFuZXIgcGFyYW1zIGhhbmRsaW5nIHRvIHBhc3MgdG8gaHR0cCBjYWxsXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQ8QXJyYXk8RmlsZUF0dGFjaG1lbnQ+PignZmlsZS1hdHRhY2htZW50L3NlYXJjaCcsIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnb3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bb3JpZ2luXSB9LFxyXG4gICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQsIG9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCBhbmNob3JFbGVtZW50OiBKUXVlcnkpOiBuZy5JUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkIHx8ICFmaWxlQXR0YWNobWVudC5GaWxlTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdbZmlsZUF0dGFjaG1lbnRdIG1hbmRhdG9yeS4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIWFuY2hvckVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcignW2FuY2hvckVsZW1lbnRdIG1hbmRhdG9yeS4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0PEZpbGU+KCdmaWxlLWF0dGFjaG1lbnQvZG93bmxvYWQnLCB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgJ2ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudC5JZCwgJ29yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0gfSxcclxuICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXHJcbiAgICAgICAgICAgIH0pLnRoZW48dm9pZD4oKGZpbGU6IEZpbGUpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vdmFyIGZpbGV3aXRoQk9NID0gJ1xcdUZFRkYnKyBmaWxlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTt1dGYtOCcgfSk7IC8vVE9ETyBNR0E6IHR5cGUgPz8/IGhvdyB0byByZXRyaWV2ZSBjb250ZW50LXR5cGUgZnJvbSBibG9iXHJcbiAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdpbWFnZS9wbmc7Y2hhcnNldD13aW5kb3dzLTEyNTInIH0pOyAvL1RPRE8gTUdBOiB0eXBlID8/PyBob3cgdG8gcmV0cmlldmUgY29udGVudC10eXBlIGZyb20gYmxvYlxyXG4gICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnaW1hZ2UvcG5nO2NoYXJzZXQ9SVNPLTg4NTktMScgfSk7IC8vVE9ETyBNR0E6IHR5cGUgPz8/IGhvdyB0byByZXRyaWV2ZSBjb250ZW50LXR5cGUgZnJvbSBibG9iXHJcbiAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdpbWFnZS9wbmcnIH0pOyAvL1RPRE8gTUdBOiB0eXBlID8/PyBob3cgdG8gcmV0cmlldmUgY29udGVudC10eXBlIGZyb20gYmxvYlxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuRmlsZVNhdmVyLnNhdmVBcyhibG9iLCBmaWxlQXR0YWNobWVudC5GaWxlTmFtZSB8fCAndW5rbm93bi5iaW4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3ZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLy8vVE9ETyBNR0E6IGRlbGF5IHRvIHRvIGJlIG91dHNpZGUgb2YgY3VycmVudCBkaWdlc3QgY3ljbGUgOiBob3cgdG8gZml4ID9cclxuICAgICAgICAgICAgICAgIC8vdGhpcy4kdGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBhbmNob3JFbGVtZW50XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgLmF0dHIoe1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBcImhyZWZcIjogdXJsLFxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBcImRvd25sb2FkXCI6ICd1bmtub3duLnBuZydcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgLy9cImRvd25sb2FkXCI6IGZpbGVBdHRhY2htZW50TmFtZSB8fCAndW5rbm93bi5iaW4nXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAvLy5odG1sKCQoXCJhXCIpLmF0dHIoXCJkb3dubG9hZFwiKSlcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAuZ2V0KDApLmNsaWNrKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcclxuICAgICAgICAgICAgICAgIC8vICAgIC8vIFRPRE8gTUdBIDogaGFjayB0byB0cmlnZ2VyIGRvd25sb2FkIG9mIGZpbGUgZnJvbSBKUywgdG8gcmVmYWN0b3IgaW4gYSBkaXJlY3RpdmUgKyBzZWUgSnF1ZXJ5IGxpbWl0YXRpb25zIG9mIGNsaWNrIGV2ZW50IDogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNzMxMTY0NS9kb3dubG9hZC1pbWFnZS13aXRoLWphdmFzY3JpcHQgXHJcbiAgICAgICAgICAgICAgICAvLyAgICAvL2FuY2hvckVsZW1lbnQucHJvcCgnaHJlZicsIHVybCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAvL2FuY2hvckVsZW1lbnQucHJvcCgnZG93bmxvYWQnLCBmaWxlQXR0YWNobWVudE5hbWUgfHwgJ3Vua25vd24uYmluJyk7IC8vVE9ETyBNR0EgPz8/XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gICAgLy9hbmNob3JFbGVtZW50LmdldCgwKS5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgLy99LCAwKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy9hbmNob3JFbGVtZW50LmNsaWNrKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIC8vIEFkZGVkIGEgc21hbGwgZGVsYXkgYmVjYXVzZSBmaWxlIHdhcyByZW1vdmVkIHRvIHF1aWNrbHkgaW4gZmlyZWZveCBhbmQgdGhlIGRvd25sb2FkIHdhcyBldmVuIG5vdCBpbml0aWFsaXplZFxyXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRlbXAgZWxlbWVudCBmcm9tIGJyb3dzZXIgY2FjaGUgOiBUT0RPIE1HQSBmaW5kIGEgd2F5IHRvIGRvIHRoaXMgaW4gYSBmaW5hbGx5KCkgY2xhdXNlIGluIHRoZSBzZXJ2aWNlIG1ldGhvZCA/XHJcbiAgICAgICAgICAgICAgICAvL3dpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XHJcbiAgICAgICAgICAgICAgICAvL30sIDEwMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudElkOiBudW1iZXIsIG9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtKTogbmcuSVByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZGVsZXRlPHZvaWQ+KCdmaWxlLWF0dGFjaG1lbnQvZGVsZXRlJywge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdmaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnRJZCwgJ29yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0gfSxcclxuICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXR0YWNoRmlsZShlbGVtZW50SWQ6IG51bWJlciwgb3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIGZpbGVUb1VwbG9hZDogRmlsZSk6IG5nLklQcm9taXNlPGFueT4ge1xyXG4gICAgICAgICAgICBpZiAoIWZpbGVUb1VwbG9hZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kbG9nLndhcm4oJ1tmaWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZV0gZmlsZSBpcyBlbXB0eSwgYWJvcnRpbmcgdXBsb2FkLicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vVE9ETyBNR0E6IHdlIHNob3VsZCByZWx5IG9uIGEgc3Ryb25nZXIgaHR0cC13cmFwcGVyIHRvIGhhbmRsZSB1cGxvYWQgdGhpcyB3YXlcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuVXBsb2FkLmJhc2U2NERhdGFVcmwoZmlsZVRvVXBsb2FkKS50aGVuKChmaWxlQmFzZTY0VXJsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UucG9zdDxhbnk+KCdmaWxlLWF0dGFjaG1lbnQvcHV0JyxcclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY3JlYXRlIG1vZGVsIGZvciBBdHRhY2hGaWxlRHRvICYgRmlsZVVwbG9hZEJhc2VEdG9cclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdFbGVtZW50SWQnOiBlbGVtZW50SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdPcmlnaW4nOiB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtvcmlnaW5dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnRmlsZVVwbG9hZEJhc2VEdG8nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRmlsZU5hbWUnOiBmaWxlVG9VcGxvYWQubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlQmFzZTY0VXJsJzogZmlsZUJhc2U2NFVybC5zbGljZShmaWxlQmFzZTY0VXJsLmluZGV4T2YoJ2Jhc2U2NCwnKSArICdiYXNlNjQsJy5sZW5ndGgpLCAvL3N0cmlwIHRoZSBkYXRhVXJpIHBhcnQgb2YgdGhlIGJhc2U2NCBlbmNvZGluZyB0byBvbmx5IGtlZXAgYmFzZTY0IHJhdyBkYXRhLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnRUeXBlJzogZmlsZVRvVXBsb2FkLnR5cGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZEluQmFzZTY0SnNvbjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVkaXRGaWxlQXR0YWNobWVudENvbW1lbnQoZmlsZUF0dGFjaG1lbnRJZDogbnVtYmVyLCBvcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSwgdXBkYXRlZENvbW1lbnQ6IHN0cmluZyk6IG5nLklQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLnBvc3Q8dm9pZD4oJ2ZpbGUtYXR0YWNobWVudC91cGRhdGUtY29tbWVudCcsXHJcbiAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY3JlYXRlIER0byBjbGllbnQtc2lkZSBvciB1cGRhdGUgZW5kcG9pbnQgc3J2LXNpZGUgdG8gc3VwcG9ydCBwYXJ0LXBhcmFtcyB1cmwgKyBjb21tZW50IGFzIHBheWxvYWQgKGNsZWFuZXIgU09DKS5cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAnRmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgJ09yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0sXHJcbiAgICAgICAgICAgICAgICAgICAgJ0NvbW1lbnQnOiB1cGRhdGVkQ29tbWVudFxyXG4gICAgICAgICAgICAgICAgfSwgeyBhcGlFbmRwb2ludDogdHJ1ZSB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5zZXJ2aWNlcy5maWxlQXR0YWNobWVudCcsIFtcclxuICAgICAgICAnbmcuaHR0cFdyYXBwZXInLFxyXG4gICAgICAgICduZ0ZpbGVVcGxvYWQnLFxyXG4gICAgICAgICduZ0ZpbGVTYXZlcicsXHJcbiAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJ1xyXG4gICAgXSkuc2VydmljZSgnZmlsZUF0dGFjaG1lbnRTZXJ2aWNlJywgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlKTtcclxufSIsInZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBjb21wb25lbnRzO1xuICAgICAgICAoZnVuY3Rpb24gKGNvbXBvbmVudHMpIHtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvblxuICAgICAgICAgICAgICAgIC8vI3JlZ2lvbiBjdG9yXG4gICAgICAgICAgICAgICAgLyogQG5nSW5qZWN0ICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyKCRsb2csIHRvYXN0ZXIsIGZpbGVBdHRhY2htZW50U2VydmljZSwgZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvZyA9ICRsb2c7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9hc3RlciA9IHRvYXN0ZXI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlID0gZmlsZUF0dGFjaG1lbnRTZXJ2aWNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bSA9IGZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZCA9ICdmaWxlLWF0dGFjaG1lbnQtZG93bmxvYWQtbGluayc7IC8vVE9ETyBNR0EgOiB0byBjb25zdCA/XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbGVtZW50SWRCaW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ3BhcmFtZXRlciB7ZWxlbWVudElkQmluZGluZ30gaXMgbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bdGhpcy5vcmlnaW5CaW5kaW5nXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdwYXJhbWV0ZXIge29yaWdpbkJpbmRpbmd9IGlzIG1hbmRhdG9yeS4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcyA9IG5ldyBBcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjYWxsIHNydiB0byBnZXQgbGlzdCBvZiBmaWxlc1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYk9mSXRlbXNQZXJQYWdlID0gMTA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvblxuICAgICAgICAgICAgICAgIC8vI3JlZ2lvbiB2bSBtZXRob2RzXG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5nZXRBdHRhY2hlZEZpbGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5nZXRBdHRhY2hlZEZpbGVzKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nKS50aGVuKGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudExpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dGFjaGVkRmlsZUxpc3QgPSBmaWxlQXR0YWNobWVudExpc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRhY2hlZEZpbGVMaXN0U291cmNlID0gZmlsZUF0dGFjaG1lbnRMaXN0OyAvL1RPRE8gTUdBIDogZHVwbGljYXRlID8gdG8gcHJldmVudCB1cGRhdGUgdG8gc291cmNlIGxpc3QgaWYgY29sbGVjdGlvbiBtb2RpZmllZCA/XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZG93bmxvYWRBdHRhY2hlZEZpbGUgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHZhciBqUXVlcnlBbmNob3JFbGVtZW50ID0gJCgnIycgKyB0aGlzLmZpbGVBdHRhY2htZW50RG93bmxvYWRMaW5rRWxlbWVudElkKTsgLy9hZGQgaWQgc2VsZWN0b3JcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQsIHRoaXMub3JpZ2luQmluZGluZywgalF1ZXJ5QW5jaG9yRWxlbWVudCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBID8gb3IgbGVhdmUgYXMgaXMuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZGVsZXRlQXR0YWNoZWRGaWxlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5kZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQuSWQsIHRoaXMub3JpZ2luQmluZGluZykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2FzdGVyLnN1Y2Nlc3MoXCJGaWxlIChcIiArIGZpbGVBdHRhY2htZW50LkZpbGVOYW1lICsgXCIpIHN1Y2Nlc3NmdWxseSBkZWxldGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVGaWxlQXR0YWNobWVudENvbW1lbnQgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQsIHVwZGF0ZWRDb21tZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkIHx8ICF1cGRhdGVkQ29tbWVudClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5vcmlnaW5CaW5kaW5nLCB1cGRhdGVkQ29tbWVudCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogaGlnaGxpZ2h0IHVwZGF0ZWQgY29tbWVudCA/ICsgZ2V0IG91dCBvZiBlZGl0IG1vZGVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5maWxlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoZmlsZSwgZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5hdHRhY2hGaWxlKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nLCBmaWxlKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnRvYXN0ZXIuc3VjY2VzcyhcIkZpbGUgKFwiICsgZmlsZS5uYW1lICsgXCIpIHN1Y2Nlc3NmdWxseSB1cGxvYWRlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7IC8vVE9ETyBNR0EgOiBoaWdobGlnaHQgbmV3IGVudHJ5ID9cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5vcGVuU2VsZWN0RmlsZURpYWxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IHNpbXVsYXRlIHVzZXIgZGlyZWN0IGNsaWNrIHRvIGlucHV0IGZpbGUgZmllbGQgKGhpZGRlbiBidXQgdXNlZCBmb3IgQVQgdGVzdHMpXG4gICAgICAgICAgICAgICAgICAgICQoJyNpbnB1dC1maWxlLXNlbGVjdC1maWVsZCcpLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAvL1RPRE8gTUdBXG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5pc1NlbGVjdEZpbGVCdG5EaXNhYmxlZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgY29tcG9uZW50cy5GaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIgPSBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgICAgICAgICB2YXIgRmlsZUF0dGFjaG1lbnRDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEZpbGVBdHRhY2htZW50Q29tcG9uZW50KCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRpbmdzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudElkQmluZGluZzogJz0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luQmluZGluZzogJz0nXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlciA9IEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyQXMgPSAndm0nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlVXJsID0gJ2NvbXBvbmVudC9maWxlLWF0dGFjaG1lbnQudHBsLmh0bWwnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRDb21wb25lbnQ7XG4gICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgY29tcG9uZW50cy5GaWxlQXR0YWNobWVudENvbXBvbmVudCA9IEZpbGVBdHRhY2htZW50Q29tcG9uZW50O1xuICAgICAgICAgICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5jb21wb25lbnRzLmZpbGVBdHRhY2htZW50JywgW1xuICAgICAgICAgICAgICAgICdjZ0J1c3knLFxuICAgICAgICAgICAgICAgICdzbWFydC10YWJsZScsXG4gICAgICAgICAgICAgICAgJ3RvYXN0ZXInLFxuICAgICAgICAgICAgICAgICdmaWxlLWF0dGFjaG1lbnQtY29tcG9uZW50LXRwbCcsXG4gICAgICAgICAgICAgICAgJ2JsdWVza3kuY29yZS5zZXJ2aWNlcy5maWxlQXR0YWNobWVudCcsXG4gICAgICAgICAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJ1xuICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAudmFsdWUoJ2NnQnVzeURlZmF1bHRzJywgeyB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9hbmd1bGFyLWJ1c3kvYW5ndWxhci1idXN5LWN1c3RvbS50cGwuaHRtbCcgfSlcbiAgICAgICAgICAgICAgICAuY29tcG9uZW50KCdmaWxlQXR0YWNobWVudENvbXBvbmVudCcsIG5ldyBGaWxlQXR0YWNobWVudENvbXBvbmVudCgpKTtcbiAgICAgICAgfSkoY29tcG9uZW50cyA9IGNvcmUuY29tcG9uZW50cyB8fCAoY29yZS5jb21wb25lbnRzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBtb2RlbHM7XG4gICAgICAgIChmdW5jdGlvbiAobW9kZWxzKSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRPRE8gTUdBIDogZGVjaWRlIG9uIHByYWN0aWNlIHRvIHNoYXJlIGVudW1zIHdpdGggc3J2IGV0Y1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAoZnVuY3Rpb24gKEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSkge1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bXCJRdW90ZVdpemFyZEZpbGVBdHRhY2htZW50XCJdID0gMF0gPSBcIlF1b3RlV2l6YXJkRmlsZUF0dGFjaG1lbnRcIjtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiT3JkZXJFbnRyeUN1c3RvbURldGFpbHNcIl0gPSAxXSA9IFwiT3JkZXJFbnRyeUN1c3RvbURldGFpbHNcIjtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiT3JkZXJFbnRyeUF1ZGlvQ3VzdG9tRGV0YWlsXCJdID0gMl0gPSBcIk9yZGVyRW50cnlBdWRpb0N1c3RvbURldGFpbFwiO1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bXCJPcmRlclRyYWNraW5nRmlsZUF0dGFjaG1lbnRcIl0gPSAzXSA9IFwiT3JkZXJUcmFja2luZ0ZpbGVBdHRhY2htZW50XCI7XG4gICAgICAgICAgICB9KShtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtIHx8IChtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0ge30pKTtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBtb2RlbHMuRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtO1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBkZWNsYXJlZCBhcyBhbmd1bGFyIG1vZHVsZSB0byBiZSBpbmplY3RlZCBhdCBydW50aW1lIGluc2lkZSBjb250cm9sbGVycy9zZXJ2aWNlcyB0byB1c2UgaXQgYXMgYSBkaWN0aW9ubmFyeVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5jb3JlLm1vZGVscy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0nLCBbXSlcbiAgICAgICAgICAgICAgICAuY29uc3RhbnQoJ2ZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSk7XG4gICAgICAgIH0pKG1vZGVscyA9IGNvcmUubW9kZWxzIHx8IChjb3JlLm1vZGVscyA9IHt9KSk7XG4gICAgfSkoY29yZSA9IGJsdWVza3kuY29yZSB8fCAoYmx1ZXNreS5jb3JlID0ge30pKTtcbn0pKGJsdWVza3kgfHwgKGJsdWVza3kgPSB7fSkpO1xuXG52YXIgYmx1ZXNreTtcbihmdW5jdGlvbiAoYmx1ZXNreSkge1xuICAgIHZhciBjb3JlO1xuICAgIChmdW5jdGlvbiAoY29yZSkge1xuICAgICAgICB2YXIgbW9kZWxzO1xuICAgICAgICAoZnVuY3Rpb24gKG1vZGVscykge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUT0RPIE1HQSA6IGV4cG9ydCBhbiBpbnRlcmZhY2UgdG9vID9cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdmFyIEZpbGVBdHRhY2htZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBGaWxlQXR0YWNobWVudChJZCwgRmlsZU5hbWUsIENvbW1lbnQsIFVwbG9hZGVkQnksIENyZWF0aW9uRGF0ZSwgT3JpZ2luKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBJZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5GaWxlTmFtZSA9IEZpbGVOYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkNvbW1lbnQgPSBDb21tZW50O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLlVwbG9hZGVkQnkgPSBVcGxvYWRlZEJ5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkNyZWF0aW9uRGF0ZSA9IENyZWF0aW9uRGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5PcmlnaW4gPSBPcmlnaW47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBGaWxlQXR0YWNobWVudDtcbiAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICBtb2RlbHMuRmlsZUF0dGFjaG1lbnQgPSBGaWxlQXR0YWNobWVudDtcbiAgICAgICAgfSkobW9kZWxzID0gY29yZS5tb2RlbHMgfHwgKGNvcmUubW9kZWxzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlcztcbiAgICAgICAgKGZ1bmN0aW9uIChzZXJ2aWNlcykge1xuICAgICAgICAgICAgdmFyIEZpbGVBdHRhY2htZW50U2VydmljZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLyogQG5nSW5qZWN0ICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnRTZXJ2aWNlKGh0dHBXcmFwcGVyU2VydmljZSwgJGxvZywgJHRpbWVvdXQsIFVwbG9hZCwgQmxvYiwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XG4gICAgICAgICAgICAgICAgICAgIEZpbGVTYXZlciwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBXcmFwcGVyU2VydmljZSA9IGh0dHBXcmFwcGVyU2VydmljZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nID0gJGxvZztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGltZW91dCA9ICR0aW1lb3V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLlVwbG9hZCA9IFVwbG9hZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5CbG9iID0gQmxvYjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5GaWxlU2F2ZXIgPSBGaWxlU2F2ZXI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0gZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmdldEF0dGFjaGVkRmlsZXMgPSBmdW5jdGlvbiAoZWxlbWVudElkLCBvcmlnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNsZWFuZXIgcGFyYW1zIGhhbmRsaW5nIHRvIHBhc3MgdG8gaHR0cCBjYWxsXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQoJ2ZpbGUtYXR0YWNobWVudC9zZWFyY2gnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgJ2VsZW1lbnRJZCc6IGVsZW1lbnRJZCwgJ29yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5kb3dubG9hZEF0dGFjaGVkRmlsZSA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCwgb3JpZ2luLCBhbmNob3JFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkIHx8ICFmaWxlQXR0YWNobWVudC5GaWxlTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdbZmlsZUF0dGFjaG1lbnRdIG1hbmRhdG9yeS4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghYW5jaG9yRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdbYW5jaG9yRWxlbWVudF0gbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L2Rvd25sb2FkJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdmaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnQuSWQsICdvcmlnaW4nOiB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtvcmlnaW5dIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBmaWxld2l0aEJPTSA9ICdcXHVGRUZGJysgZmlsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07dXRmLTgnIH0pOyAvL1RPRE8gTUdBOiB0eXBlID8/PyBob3cgdG8gcmV0cmlldmUgY29udGVudC10eXBlIGZyb20gYmxvYlxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnaW1hZ2UvcG5nO2NoYXJzZXQ9d2luZG93cy0xMjUyJyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PUlTTy04ODU5LTEnIH0pOyAvL1RPRE8gTUdBOiB0eXBlID8/PyBob3cgdG8gcmV0cmlldmUgY29udGVudC10eXBlIGZyb20gYmxvYlxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnaW1hZ2UvcG5nJyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLkZpbGVTYXZlci5zYXZlQXMoYmxvYiwgZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWUgfHwgJ3Vua25vd24uYmluJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vLy9UT0RPIE1HQTogZGVsYXkgdG8gdG8gYmUgb3V0c2lkZSBvZiBjdXJyZW50IGRpZ2VzdCBjeWNsZSA6IGhvdyB0byBmaXggP1xuICAgICAgICAgICAgICAgICAgICAgICAgLy90aGlzLiR0aW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGFuY2hvckVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIFwiaHJlZlwiOiB1cmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIFwiZG93bmxvYWRcIjogJ3Vua25vd24ucG5nJ1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAvL1wiZG93bmxvYWRcIjogZmlsZUF0dGFjaG1lbnROYW1lIHx8ICd1bmtub3duLmJpbidcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIC8vLmh0bWwoJChcImFcIikuYXR0cihcImRvd25sb2FkXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIC5nZXQoMCkuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAvLyBUT0RPIE1HQSA6IGhhY2sgdG8gdHJpZ2dlciBkb3dubG9hZCBvZiBmaWxlIGZyb20gSlMsIHRvIHJlZmFjdG9yIGluIGEgZGlyZWN0aXZlICsgc2VlIEpxdWVyeSBsaW1pdGF0aW9ucyBvZiBjbGljayBldmVudCA6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTczMTE2NDUvZG93bmxvYWQtaW1hZ2Utd2l0aC1qYXZhc2NyaXB0IFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLy9hbmNob3JFbGVtZW50LnByb3AoJ2hyZWYnLCB1cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLy9hbmNob3JFbGVtZW50LnByb3AoJ2Rvd25sb2FkJywgZmlsZUF0dGFjaG1lbnROYW1lIHx8ICd1bmtub3duLmJpbicpOyAvL1RPRE8gTUdBID8/P1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLy9hbmNob3JFbGVtZW50LmdldCgwKS5jbGljaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy99LCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYW5jaG9yRWxlbWVudC5jbGljaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZGVkIGEgc21hbGwgZGVsYXkgYmVjYXVzZSBmaWxlIHdhcyByZW1vdmVkIHRvIHF1aWNrbHkgaW4gZmlyZWZveCBhbmQgdGhlIGRvd25sb2FkIHdhcyBldmVuIG5vdCBpbml0aWFsaXplZFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRlbXAgZWxlbWVudCBmcm9tIGJyb3dzZXIgY2FjaGUgOiBUT0RPIE1HQSBmaW5kIGEgd2F5IHRvIGRvIHRoaXMgaW4gYSBmaW5hbGx5KCkgY2xhdXNlIGluIHRoZSBzZXJ2aWNlIG1ldGhvZCA/XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3dpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL30sIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5kZWxldGVBdHRhY2hlZEZpbGUgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnRJZCwgb3JpZ2luKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5kZWxldGUoJ2ZpbGUtYXR0YWNobWVudC9kZWxldGUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgJ2ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLCAnb3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bb3JpZ2luXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmF0dGFjaEZpbGUgPSBmdW5jdGlvbiAoZWxlbWVudElkLCBvcmlnaW4sIGZpbGVUb1VwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVUb1VwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLndhcm4oJ1tmaWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZV0gZmlsZSBpcyBlbXB0eSwgYWJvcnRpbmcgdXBsb2FkLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQTogd2Ugc2hvdWxkIHJlbHkgb24gYSBzdHJvbmdlciBodHRwLXdyYXBwZXIgdG8gaGFuZGxlIHVwbG9hZCB0aGlzIHdheVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5VcGxvYWQuYmFzZTY0RGF0YVVybChmaWxlVG9VcGxvYWQpLnRoZW4oZnVuY3Rpb24gKGZpbGVCYXNlNjRVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5odHRwV3JhcHBlclNlcnZpY2UucG9zdCgnZmlsZS1hdHRhY2htZW50L3B1dCcsIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBtb2RlbCBmb3IgQXR0YWNoRmlsZUR0byAmIEZpbGVVcGxvYWRCYXNlRHRvXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0VsZW1lbnRJZCc6IGVsZW1lbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnT3JpZ2luJzogX3RoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVVcGxvYWRCYXNlRHRvJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRmlsZU5hbWUnOiBmaWxlVG9VcGxvYWQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVCYXNlNjRVcmwnOiBmaWxlQmFzZTY0VXJsLnNsaWNlKGZpbGVCYXNlNjRVcmwuaW5kZXhPZignYmFzZTY0LCcpICsgJ2Jhc2U2NCwnLmxlbmd0aCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50VHlwZSc6IGZpbGVUb1VwbG9hZC50eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZEluQmFzZTY0SnNvbjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5lZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50ID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50SWQsIG9yaWdpbiwgdXBkYXRlZENvbW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLnBvc3QoJ2ZpbGUtYXR0YWNobWVudC91cGRhdGUtY29tbWVudCcsIFxuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY3JlYXRlIER0byBjbGllbnQtc2lkZSBvciB1cGRhdGUgZW5kcG9pbnQgc3J2LXNpZGUgdG8gc3VwcG9ydCBwYXJ0LXBhcmFtcyB1cmwgKyBjb21tZW50IGFzIHBheWxvYWQgKGNsZWFuZXIgU09DKS5cbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ09yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29tbWVudCc6IHVwZGF0ZWRDb21tZW50XG4gICAgICAgICAgICAgICAgICAgIH0sIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRTZXJ2aWNlO1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIHNlcnZpY2VzLkZpbGVBdHRhY2htZW50U2VydmljZSA9IEZpbGVBdHRhY2htZW50U2VydmljZTtcbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUuc2VydmljZXMuZmlsZUF0dGFjaG1lbnQnLCBbXG4gICAgICAgICAgICAgICAgJ25nLmh0dHBXcmFwcGVyJyxcbiAgICAgICAgICAgICAgICAnbmdGaWxlVXBsb2FkJyxcbiAgICAgICAgICAgICAgICAnbmdGaWxlU2F2ZXInLFxuICAgICAgICAgICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bSdcbiAgICAgICAgICAgIF0pLnNlcnZpY2UoJ2ZpbGVBdHRhY2htZW50U2VydmljZScsIEZpbGVBdHRhY2htZW50U2VydmljZSk7XG4gICAgICAgIH0pKHNlcnZpY2VzID0gY29yZS5zZXJ2aWNlcyB8fCAoY29yZS5zZXJ2aWNlcyA9IHt9KSk7XG4gICAgfSkoY29yZSA9IGJsdWVza3kuY29yZSB8fCAoYmx1ZXNreS5jb3JlID0ge30pKTtcbn0pKGJsdWVza3kgfHwgKGJsdWVza3kgPSB7fSkpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
