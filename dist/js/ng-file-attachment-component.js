var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var components;
        (function (components) {
            var FileAttachmentComponentController = (function () {
                //#endregion
                //#region ctor
                /* @ngInject */
                FileAttachmentComponentController.$inject = ["$log", "toaster", "_", "fileAttachmentService", "fileAttachmentOriginEnum", "applicationOriginEnum"];
                function FileAttachmentComponentController($log, toaster, _, fileAttachmentService, fileAttachmentOriginEnum, applicationOriginEnum) {
                    this.$log = $log;
                    this.toaster = toaster;
                    this._ = _;
                    this.fileAttachmentService = fileAttachmentService;
                    this.fileAttachmentOriginEnum = fileAttachmentOriginEnum;
                    this.applicationOriginEnum = applicationOriginEnum;
                    this.fileAttachmentDownloadLinkElementId = 'file-attachment-download-link'; //TODO MGA : to const ?
                    this.hasCurrentUserUploadRights = false;
                    //#endregion
                    //#region private fields
                    this.maxFileSize = 20000000; //in bytes = 20mb
                    if (!this.elementIdBinding) {
                        this.$log.error('parameter {elementIdBinding} is mandatory.');
                        return;
                    }
                    if (!this.applicationOriginEnum[this.originBinding]) {
                        this.$log.error('parameter {originBinding} is mandatory.');
                        return;
                    }
                    this.httpPromises = new Array();
                    // get list of attached files for current element
                    this.getAttachedFiles();
                    // get flag to know if current user has upload rights for current item
                    this.getCurrentUserUploadRights();
                    // get supported mime types for file upload, based on srv info
                    this.getSupportedMimeTypes();
                    this.nbOfItemsPerPage = 10;
                    this.fileInvalidMessageArray = new Array();
                }
                //#endregion
                //#region vm methods
                FileAttachmentComponentController.prototype.getAttachedFiles = function () {
                    var _this = this;
                    var httpPromise = this.fileAttachmentService.getAttachedFiles(this.elementIdBinding, this.originBinding).then(function (fileAttachmentList) {
                        _this.attachedFileList = fileAttachmentList;
                        _this.attachedFileListSource = fileAttachmentList; //TODO MGA : duplicate ? to prevent update to source list if collection modified ?
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.getSupportedMimeTypes = function () {
                    var _this = this;
                    var httpPromise = this.fileAttachmentService.getSupportedMimeTypes().then(function (supportedMimeTypes) {
                        _this.supportedMimeTypes = _(supportedMimeTypes).uniq();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.downloadAttachedFile = function (fileAttachment) {
                    if (!fileAttachment || !fileAttachment.Id)
                        return;
                    var jQueryAnchorElement = $('#' + this.fileAttachmentDownloadLinkElementId); //add id selector
                    var httpPromise = this.fileAttachmentService.downloadAttachedFile(fileAttachment, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin], jQueryAnchorElement).then(function () {
                        //TODO MGA ? or leave as is.
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.deleteAttachedFile = function (fileAttachment) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id)
                        return;
                    var httpPromise = this.fileAttachmentService.deleteAttachedFile(fileAttachment.Id, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin]).then(function () {
                        _this.toaster.success("File (" + fileAttachment.FileName + ") successfully deleted.");
                        _this.getAttachedFiles();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.updateFileAttachmentComment = function (fileAttachment, updatedComment) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id || !updatedComment)
                        return;
                    var httpPromise = this.fileAttachmentService.editFileAttachmentComment(fileAttachment.Id, this.fileAttachmentOriginEnum[fileAttachment.FileOrigin], updatedComment).then(function () {
                        _this.clearEditCommentMode(fileAttachment); //TODO MGA: useless if we reload all data from srv
                        // retrieve update list of files with updated file comment from srv : TODO MGA improve reload (costly)
                        _this.getAttachedFiles();
                        // TODO MGA : highlight updated comment ?
                    });
                    this.httpPromises.push(httpPromise);
                };
                /**
                 * TODO MGA: improve inlin-form error handling & UI feedback ! not dynamic // fluid to use
                 * @param fileAttachment
                 */
                FileAttachmentComponentController.prototype.onUpdatedComment = function (fileAttachment) {
                    if (!fileAttachment.updatedComment || fileAttachment.updatedComment.length < 1) {
                        fileAttachment.updatedCommentErrorMessage = "comment must be non-empty";
                    }
                    else if (fileAttachment.updatedComment &&
                        (fileAttachment.updatedComment.length < 1 || fileAttachment.updatedComment.length > 255)) {
                        fileAttachment.updatedCommentErrorMessage = "comment must be < 255 characters";
                    }
                    else {
                        fileAttachment.updatedCommentErrorMessage = null; //reset error message to flag comment as valid
                    }
                };
                FileAttachmentComponentController.prototype.cancelEditComment = function (fileAttachment) {
                    fileAttachment.editCommentMode = false;
                    //fileAttachment.updatedComment = ""; // TODO MGA: decide behavior ? better to keep last entry ? but then we must also keep error message
                    //fileAttachment.updatedCommentErrorMessage = null;
                };
                FileAttachmentComponentController.prototype.onFileSelected = function (file, event) {
                    if (!file)
                        return;
                    this.fileInvalidMessageArray = []; //reset error array
                    var fileFormatSupported = file.type &&
                        _(this.supportedMimeTypes).any(function (supportedMimeType) { return file.type === supportedMimeType; });
                    if (!fileFormatSupported)
                        this.fileInvalidMessageArray.push("Unsupported file format: '" + file.type + "'"); //TODO MGA: convert to readable extension from mime type
                    var fileSizeSupported = file.size && file.size < this.maxFileSize;
                    if (!fileSizeSupported)
                        this.fileInvalidMessageArray.push("Selected file is bigger (" + this.convertBytesToMegaBytes(file.size) + "mb) than authorized file size: " + this.convertBytesToMegaBytes(this.maxFileSize) + "mb");
                };
                FileAttachmentComponentController.prototype.importSelectedFile = function () {
                    var _this = this;
                    if (!this.selectedFile || _(this.fileInvalidMessageArray).any())
                        return; //TODO MGA $log
                    var httpPromise = this.fileAttachmentService.attachFile(this.elementIdBinding, this.originBinding, this.selectedFile).then(function () {
                        _this.toaster.success("File (" + _this.selectedFile.name + ") successfully uploaded.");
                        _this.getAttachedFiles(); //TODO MGA : highlight new entry ?
                    }).finally(function () {
                        //clean up selected file
                        _this.clearSelectedFile();
                    });
                    this.httpPromises.push(httpPromise);
                };
                FileAttachmentComponentController.prototype.clearSelectedFile = function () {
                    this.selectedFile = null;
                    this.fileInvalidMessageArray = []; // clear error messages
                    //this.fileSelectedIsValid = true;
                };
                FileAttachmentComponentController.prototype.convertBytesToMegaBytes = function (bytes) {
                    return +(bytes / 1000000).toFixed(2); //converts back to number 2-digits string representation of original conversion.
                };
                //#endregion
                //#region private methods
                FileAttachmentComponentController.prototype.clearEditCommentMode = function (fileAttachment) {
                    fileAttachment.editCommentMode = false;
                    fileAttachment.updatedComment = null;
                    fileAttachment.updatedCommentErrorMessage = null;
                };
                FileAttachmentComponentController.prototype.getCurrentUserUploadRights = function () {
                    var _this = this;
                    this.fileAttachmentService
                        .getCurrentUserUploadRights(this.elementIdBinding, this.originBinding)
                        .then(function (booleanResponse) {
                        _this.hasCurrentUserUploadRights = booleanResponse;
                    });
                };
                return FileAttachmentComponentController;
            }());
            components.FileAttachmentComponentController = FileAttachmentComponentController;
            var FileAttachmentComponent = (function () {
                function FileAttachmentComponent() {
                    this.bindings = {
                        elementIdBinding: '=',
                        originBinding: '='
                    };
                    this.controller = FileAttachmentComponentController;
                    this.controllerAs = 'vm';
                    this.templateUrl = 'component/file-attachment.tpl.html';
                }
                return FileAttachmentComponent;
            }());
            components.FileAttachmentComponent = FileAttachmentComponent;
            angular.module('bluesky.core.components.fileAttachment', [
                'cgBusy',
                'smart-table',
                'toaster',
                'file-attachment-component-tpl',
                'bluesky.core.services.fileAttachment',
                'bluesky.core.models.fileAttachmentOriginEnum',
                'bluesky.core.models.applicationOriginEnum'
            ])
                .value('cgBusyDefaults', { templateUrl: 'templates/angular-busy/angular-busy-custom.tpl.html' })
                .constant('_', window['_'])
                .constant('moment', window['moment'])
                .component('fileAttachmentComponent', new FileAttachmentComponent());
        })(components = core.components || (core.components = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : decide on practice to share enums with srv etc
             */
            (function (ApplicationOriginEnum) {
                ApplicationOriginEnum[ApplicationOriginEnum["QuoteWizard"] = 0] = "QuoteWizard";
                ApplicationOriginEnum[ApplicationOriginEnum["OrderEntry"] = 1] = "OrderEntry";
                ApplicationOriginEnum[ApplicationOriginEnum["OrderTracking"] = 2] = "OrderTracking";
            })(models.ApplicationOriginEnum || (models.ApplicationOriginEnum = {}));
            var ApplicationOriginEnum = models.ApplicationOriginEnum;
            /**
             * declared as angular module to be injected at runtime inside controllers/services to use it as a dictionnary.
             * Otherwise, we are not sure the reference to this object will ve known at runtime due to order of evaluation of imports inside generated js.
             */
            angular.module('bluesky.core.models.applicationOriginEnum', [])
                .constant('applicationOriginEnum', ApplicationOriginEnum);
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : decide on practice to share enums with srv etc
             */
            (function (FileAttachmentOriginEnum) {
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["QuoteWizardFileAttachment"] = 0] = "QuoteWizardFileAttachment";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderEntryCustomDetails"] = 1] = "OrderEntryCustomDetails";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderEntryAudioCustomDetail"] = 2] = "OrderEntryAudioCustomDetail";
                FileAttachmentOriginEnum[FileAttachmentOriginEnum["OrderTrackingFileAttachment"] = 3] = "OrderTrackingFileAttachment";
            })(models.FileAttachmentOriginEnum || (models.FileAttachmentOriginEnum = {}));
            var FileAttachmentOriginEnum = models.FileAttachmentOriginEnum;
            /**
             * declared as angular module to be injected at runtime inside controllers/services to use it as a dictionnary.
             * Otherwise, we are not sure the reference to this object will ve known at runtime due to order of evaluation of imports inside generated js.
             */
            angular.module('bluesky.core.models.fileAttachmentOriginEnum', [])
                .constant('fileAttachmentOriginEnum', FileAttachmentOriginEnum);
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            /**
             * TODO MGA : export an interface too ?
             */
            var FileAttachment = (function () {
                function FileAttachment(
                    //srv-side properties
                    Id, FileName, Comment, UploaderInformation, CreationDate, FileOrigin, CanCurrentUserDownloadFile, CanCurrentUserDeleteFile, CanCurrentUserEditComment, 
                    //client-side properties
                    editCommentMode, updatedComment, updatedCommentErrorMessage) {
                    this.Id = Id;
                    this.FileName = FileName;
                    this.Comment = Comment;
                    this.UploaderInformation = UploaderInformation;
                    this.CreationDate = CreationDate;
                    this.FileOrigin = FileOrigin;
                    this.CanCurrentUserDownloadFile = CanCurrentUserDownloadFile;
                    this.CanCurrentUserDeleteFile = CanCurrentUserDeleteFile;
                    this.CanCurrentUserEditComment = CanCurrentUserEditComment;
                    this.editCommentMode = editCommentMode;
                    this.updatedComment = updatedComment;
                    this.updatedCommentErrorMessage = updatedCommentErrorMessage;
                }
                return FileAttachment;
            }());
            models.FileAttachment = FileAttachment;
            var UserInformation = (function () {
                function UserInformation(FirstName, LastName, DisplayName, userIdentifier, Email, PhoneNumber) {
                    this.FirstName = FirstName;
                    this.LastName = LastName;
                    this.DisplayName = DisplayName;
                    this.userIdentifier = userIdentifier;
                    this.Email = Email;
                    this.PhoneNumber = PhoneNumber;
                }
                return UserInformation;
            }());
            models.UserInformation = UserInformation;
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var models;
        (function (models) {
            var JsonBooleanResponse = (function () {
                function JsonBooleanResponse(booleanResponse) {
                    this.booleanResponse = booleanResponse;
                }
                return JsonBooleanResponse;
            }());
            models.JsonBooleanResponse = JsonBooleanResponse;
        })(models = core.models || (core.models = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

var bluesky;
(function (bluesky) {
    var core;
    (function (core) {
        var services;
        (function (services) {
            var FileAttachmentService = (function () {
                /* @ngInject */
                FileAttachmentService.$inject = ["httpWrapperService", "$log", "$timeout", "Upload", "Blob", "FileSaver", "fileAttachmentOriginEnum", "applicationOriginEnum"];
                function FileAttachmentService(httpWrapperService, $log, $timeout, Upload, Blob, //TODO MGA: typings ?
                    FileSaver, //TODO MGA: typings ?
                    fileAttachmentOriginEnum, applicationOriginEnum) {
                    this.httpWrapperService = httpWrapperService;
                    this.$log = $log;
                    this.$timeout = $timeout;
                    this.Upload = Upload;
                    this.Blob = Blob;
                    this.FileSaver = FileSaver;
                    this.fileAttachmentOriginEnum = fileAttachmentOriginEnum;
                    this.applicationOriginEnum = applicationOriginEnum;
                }
                FileAttachmentService.prototype.getAttachedFiles = function (elementId, applicationOrigin) {
                    //TODO MGA : cleaner params handling to pass to http call
                    return this.httpWrapperService.get('file-attachment/search', {
                        params: { 'elementId': elementId, 'applicationOrigin': this.applicationOriginEnum[applicationOrigin] },
                        apiEndpoint: true
                    });
                };
                FileAttachmentService.prototype.attachFile = function (elementId, applicationOrigin, fileToUpload) {
                    var _this = this;
                    if (!fileToUpload) {
                        this.$log.warn('[fileAttachmentService.attachFile] file is empty, aborting upload.');
                        return null;
                    }
                    //TODO MGA: we should rely on a stronger http-wrapper to handle upload this way
                    return this.Upload.base64DataUrl(fileToUpload).then(function (fileBase64Url) {
                        return _this.httpWrapperService.post('file-attachment/put', 
                        //TODO MGA : create model for AttachFileDto & FileUploadBaseDto
                        {
                            'ElementId': elementId,
                            'ApplicationOrigin': _this.applicationOriginEnum[applicationOrigin],
                            'FileUploadBaseDto': {
                                'FileName': fileToUpload.name,
                                'FileBase64Url': fileBase64Url.slice(fileBase64Url.indexOf('base64,') + 'base64,'.length),
                                'ContentType': fileToUpload.type
                            }
                        }, {
                            apiEndpoint: true,
                            uploadInBase64Json: true
                        });
                    });
                };
                FileAttachmentService.prototype.downloadAttachedFile = function (fileAttachment, fileOrigin, anchorElement) {
                    var _this = this;
                    if (!fileAttachment || !fileAttachment.Id || !fileAttachment.FileName) {
                        this.$log.error('[fileAttachment] mandatory.');
                        return null;
                    }
                    if (!anchorElement) {
                        this.$log.error('[anchorElement] mandatory.');
                        return null;
                    }
                    return this.httpWrapperService.get('file-attachment/download', {
                        params: { 'fileAttachmentId': fileAttachment.Id, 'fileOrigin': this.fileAttachmentOriginEnum[fileOrigin] },
                        apiEndpoint: true
                    }).then(function (file) {
                        //var filewithBOM = '\uFEFF'+ file;
                        var blob = new Blob([file], { type: 'application/octet-stream;utf-8' }); //TODO MGA: type ??? how to retrieve content-type from blob
                        //var blob = new Blob([file], { type: 'image/png;charset=windows-1252' }); //TODO MGA: type ??? how to retrieve content-type from blob
                        //var blob = new Blob([file], { type: 'image/png;charset=ISO-8859-1' }); //TODO MGA: type ??? how to retrieve content-type from blob
                        //var blob = new Blob([file], { type: 'image/png' }); //TODO MGA: type ??? how to retrieve content-type from blob
                        _this.FileSaver.saveAs(blob, fileAttachment.FileName || 'unknown.bin');
                        //var url = window.URL.createObjectURL(blob);
                        ////TODO MGA: delay to to be outside of current digest cycle : how to fix ?
                        //this.$timeout(() => {
                        //    anchorElement
                        //        .attr({
                        //            "href": url,
                        //            "download": 'unknown.png'
                        //            //"download": fileAttachmentName || 'unknown.bin'
                        //        })
                        //        //.html($("a").attr("download"))
                        //        .get(0).click();
                        //    window.URL.revokeObjectURL(url);
                        //    // TODO MGA : hack to trigger download of file from JS, to refactor in a directive + see Jquery limitations of click event : http://stackoverflow.com/questions/17311645/download-image-with-javascript 
                        //    //anchorElement.prop('href', url);
                        //    //anchorElement.prop('download', fileAttachmentName || 'unknown.bin'); //TODO MGA ???
                        //    //anchorElement.get(0).click();
                        //}, 0);
                        //anchorElement.click();
                        //setTimeout(function () {
                        // Added a small delay because file was removed to quickly in firefox and the download was even not initialized
                        // Remove temp element from browser cache : TODO MGA find a way to do this in a finally() clause in the service method ?
                        //window.URL.revokeObjectURL(url);
                        //}, 100);
                        return;
                    });
                };
                FileAttachmentService.prototype.deleteAttachedFile = function (fileAttachmentId, fileOrigin) {
                    return this.httpWrapperService.delete('file-attachment/delete', {
                        params: { 'fileAttachmentId': fileAttachmentId, 'fileOrigin': this.fileAttachmentOriginEnum[fileOrigin] },
                        apiEndpoint: true
                    });
                };
                FileAttachmentService.prototype.editFileAttachmentComment = function (fileAttachmentId, fileOrigin, updatedComment) {
                    return this.httpWrapperService.post('file-attachment/update-comment', 
                    //TODO MGA : create Dto client-side or update endpoint srv-side to support part-params url + comment as payload (cleaner SOC).
                    {
                        'FileAttachmentId': fileAttachmentId,
                        'FileOrigin': this.fileAttachmentOriginEnum[fileOrigin],
                        'Comment': updatedComment
                    }, { apiEndpoint: true });
                };
                FileAttachmentService.prototype.getSupportedMimeTypes = function () {
                    return this.httpWrapperService.get('file-attachment/authorized-mime-types', { apiEndpoint: true });
                };
                FileAttachmentService.prototype.getCurrentUserUploadRights = function (elementId, applicationOrigin) {
                    return this.httpWrapperService.get('file-attachment/get-current-user-upload-rights', {
                        params: { 'elementId': elementId, 'applicationOrigin': this.applicationOriginEnum[applicationOrigin] },
                        apiEndpoint: true
                    })
                        .then(function (response) { return response.booleanResponse; });
                };
                return FileAttachmentService;
            }());
            services.FileAttachmentService = FileAttachmentService;
            angular.module('bluesky.core.services.fileAttachment', [
                'ng.httpWrapper',
                'ngFileUpload',
                'ngFileSaver',
                'bluesky.core.models.fileAttachmentOriginEnum',
                'bluesky.core.models.applicationOriginEnum'
            ]).service('fileAttachmentService', FileAttachmentService);
        })(services = core.services || (core.services = {}));
    })(core = bluesky.core || (bluesky.core = {}));
})(bluesky || (bluesky = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudC9maWxlLWF0dGFjaG1lbnQuY29tcG9uZW50LnRzIiwibW9kZWxzL2FwcGxpY2F0aW9uLW9yaWdpbi5lbnVtLnRzIiwibW9kZWxzL2ZpbGUtYXR0YWNobWVudC1vcmlnaW4uZW51bS50cyIsIm1vZGVscy9maWxlLWF0dGFjaG1lbnQubW9kZWwudHMiLCJtb2RlbHMvanNvbi1ib29sZWFuLXJlc3BvbnNlLnRzIiwic2VydmljZS9maWxlLWF0dGFjaG1lbnQuc2VydmljZS50cyIsIm5nLWZpbGUtYXR0YWNobWVudC1jb21wb25lbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBVTtBQUFWLENBQUEsVUFBVSxTQUFPO0lBQUMsSUFBQTtJQUFBLENBQUEsVUFBQSxNQUFJO1FBQUMsSUFBQTtRQUFBLENBQUEsVUFBQSxZQUFXO1lBMkM5QixJQUFBLHFDQUFBLFlBQUE7Ozs7O2dCQWdDSSxTQUFBLGtDQUNZLE1BQ0EsU0FDQSxHQUNBLHVCQUNBLDBCQUNBLHVCQUE0QztvQkFMNUMsS0FBQSxPQUFBO29CQUNBLEtBQUEsVUFBQTtvQkFDQSxLQUFBLElBQUE7b0JBQ0EsS0FBQSx3QkFBQTtvQkFDQSxLQUFBLDJCQUFBO29CQUNBLEtBQUEsd0JBQUE7b0JBekJaLEtBQUEsc0NBQXNDO29CQUN0QyxLQUFBLDZCQUE2Qjs7O29CQVc3QixLQUFBLGNBQWM7b0JBZVYsSUFBSSxDQUFDLEtBQUssa0JBQWtCO3dCQUN4QixLQUFLLEtBQUssTUFBTTt3QkFDaEI7O29CQUdKLElBQUksQ0FBQyxLQUFLLHNCQUFzQixLQUFLLGdCQUFnQjt3QkFDakQsS0FBSyxLQUFLLE1BQU07d0JBQ2hCOztvQkFHSixLQUFLLGVBQWUsSUFBSTs7b0JBR3hCLEtBQUs7O29CQUdMLEtBQUs7O29CQUdMLEtBQUs7b0JBRUwsS0FBSyxtQkFBbUI7b0JBRXhCLEtBQUssMEJBQTBCLElBQUk7Ozs7Z0JBUXZDLGtDQUFBLFVBQUEsbUJBQUEsWUFBQTtvQkFBQSxJQUFB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OztnQkFHekMsT0FBQTs7WUF4SWEsU0FBQSx3QkFBcUI7WUEwSWxDLFFBQVEsT0FBTyx3Q0FBd0M7Z0JBQ25EO2dCQUNBO2dCQUNBO2dCQUNBO2dCQUNBO2VBQ0QsUUFBUSx5QkFBeUI7V0F4S2pCLFdBQUEsS0FBQSxhQUFBLEtBQUEsV0FBUTtPQUFiLE9BQUEsUUFBQSxTQUFBLFFBQUEsT0FBSTtHQUFaLFlBQUEsVUFBTztBQ3diakIiLCJmaWxlIjoibmctZmlsZS1hdHRhY2htZW50LWNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIm5hbWVzcGFjZSBibHVlc2t5LmNvcmUuY29tcG9uZW50cyB7XHJcblxyXG4gICAgaW1wb3J0IEZpbGVBdHRhY2htZW50ID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudDtcclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcclxuICAgIGltcG9ydCBJRmlsZUF0dGFjaG1lbnRTZXJ2aWNlID0gYmx1ZXNreS5jb3JlLnNlcnZpY2VzLklGaWxlQXR0YWNobWVudFNlcnZpY2U7XHJcbiAgICBpbXBvcnQgQXBwbGljYXRpb25PcmlnaW5FbnVtID0gYmx1ZXNreS5jb3JlLm1vZGVscy5BcHBsaWNhdGlvbk9yaWdpbkVudW07XHJcblxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRmlsZUF0dGFjaG1lbnRDb21wb25lbnRCaW5kaW5ncyB7XHJcbiAgICAgICAgZWxlbWVudElkQmluZGluZz86IG51bWJlcjtcclxuICAgICAgICBvcmlnaW5CaW5kaW5nPzogQXBwbGljYXRpb25PcmlnaW5FbnVtO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciBleHRlbmRzIElGaWxlQXR0YWNobWVudENvbXBvbmVudEJpbmRpbmdzIHtcclxuICAgICAgICBhdHRhY2hlZEZpbGVMaXN0OiBBcnJheTxGaWxlQXR0YWNobWVudD47XHJcbiAgICAgICAgYXR0YWNoZWRGaWxlTGlzdFNvdXJjZTogQXJyYXk8RmlsZUF0dGFjaG1lbnQ+O1xyXG5cclxuICAgICAgICBmaWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZDogc3RyaW5nO1xyXG5cclxuICAgICAgICBnZXRBdHRhY2hlZEZpbGVzKCk6IHZvaWQ7XHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZDtcclxuICAgICAgICBkZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZDtcclxuICAgICAgICBnZXRTdXBwb3J0ZWRNaW1lVHlwZXMoKTogdm9pZDtcclxuXHJcbiAgICAgICAgaGFzQ3VycmVudFVzZXJVcGxvYWRSaWdodHM6IGJvb2xlYW47XHJcblxyXG4gICAgICAgIHNlbGVjdGVkRmlsZTogRmlsZTtcclxuICAgICAgICBmaWxlSW52YWxpZE1lc3NhZ2VBcnJheTogQXJyYXk8c3RyaW5nPjtcclxuICAgICAgICBvbkZpbGVTZWxlY3RlZDogKGZpbGU6IEZpbGUsIGV2ZW50OiBuZy5hbmd1bGFyRmlsZVVwbG9hZC5JRmlsZVByb2dyZXNzRXZlbnQpID0+IHZvaWQ7XHJcbiAgICAgICAgaW1wb3J0U2VsZWN0ZWRGaWxlKCk6IHZvaWQ7XHJcbiAgICAgICAgY2xlYXJTZWxlY3RlZEZpbGUoKTogdm9pZDtcclxuXHJcbiAgICAgICAgb25VcGRhdGVkQ29tbWVudChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkO1xyXG4gICAgICAgIGNhbmNlbEVkaXRDb21tZW50KGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCk6IHZvaWQ7XHJcblxyXG4gICAgICAgIGNvbnZlcnRCeXRlc1RvTWVnYUJ5dGVzKGJ5dGVzOiBudW1iZXIpOiBudW1iZXI7XHJcblxyXG4gICAgICAgIG5iT2ZJdGVtc1BlclBhZ2U6IG51bWJlcjtcclxuXHJcbiAgICAgICAgc3VwcG9ydGVkTWltZVR5cGVzOiBBcnJheTxzdHJpbmc+O1xyXG5cclxuICAgICAgICBodHRwUHJvbWlzZXM6IEFycmF5PG5nLklQcm9taXNlPGFueT4+O1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIgaW1wbGVtZW50cyBJRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyIHtcclxuXHJcbiAgICAgICAgLy8jcmVnaW9uIGJpbmRpbmcgcHJvcFxyXG5cclxuICAgICAgICBlbGVtZW50SWRCaW5kaW5nOiBudW1iZXI7XHJcbiAgICAgICAgb3JpZ2luQmluZGluZzogQXBwbGljYXRpb25PcmlnaW5FbnVtO1xyXG5cclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAgICAgLy8jcmVnaW9uIHZtIHByb3BcclxuXHJcbiAgICAgICAgYXR0YWNoZWRGaWxlTGlzdDogQXJyYXk8RmlsZUF0dGFjaG1lbnQ+O1xyXG4gICAgICAgIGF0dGFjaGVkRmlsZUxpc3RTb3VyY2U6IEFycmF5PEZpbGVBdHRhY2htZW50PjtcclxuICAgICAgICBmaWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZCA9ICdmaWxlLWF0dGFjaG1lbnQtZG93bmxvYWQtbGluayc7IC8vVE9ETyBNR0EgOiB0byBjb25zdCA/XHJcbiAgICAgICAgaGFzQ3VycmVudFVzZXJVcGxvYWRSaWdodHMgPSBmYWxzZTtcclxuICAgICAgICBzZWxlY3RlZEZpbGU6IEZpbGU7XHJcbiAgICAgICAgZmlsZUludmFsaWRNZXNzYWdlQXJyYXk6IEFycmF5PHN0cmluZz47XHJcbiAgICAgICAgbmJPZkl0ZW1zUGVyUGFnZTogbnVtYmVyO1xyXG4gICAgICAgIGh0dHBQcm9taXNlczogQXJyYXk8bmcuSVByb21pc2U8YW55Pj47XHJcbiAgICAgICAgc3VwcG9ydGVkTWltZVR5cGVzOiBBcnJheTxzdHJpbmc+O1xyXG5cclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAgICAgLy8jcmVnaW9uIHByaXZhdGUgZmllbGRzXHJcblxyXG4gICAgICAgIG1heEZpbGVTaXplID0gMjAwMDAwMDA7IC8vaW4gYnl0ZXMgPSAyMG1iXHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gY3RvclxyXG5cclxuICAgICAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgcHJpdmF0ZSAkbG9nOiBuZy5JTG9nU2VydmljZSxcclxuICAgICAgICAgICAgcHJpdmF0ZSB0b2FzdGVyOiBuZ3RvYXN0ZXIuSVRvYXN0ZXJTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIF86IFVuZGVyc2NvcmVTdGF0aWMsXHJcbiAgICAgICAgICAgIHByaXZhdGUgZmlsZUF0dGFjaG1lbnRTZXJ2aWNlOiBJRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bTogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLFxyXG4gICAgICAgICAgICBwcml2YXRlIGFwcGxpY2F0aW9uT3JpZ2luRW51bTogQXBwbGljYXRpb25PcmlnaW5FbnVtXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5lbGVtZW50SWRCaW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ3BhcmFtZXRlciB7ZWxlbWVudElkQmluZGluZ30gaXMgbWFuZGF0b3J5LicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtW3RoaXMub3JpZ2luQmluZGluZ10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcigncGFyYW1ldGVyIHtvcmlnaW5CaW5kaW5nfSBpcyBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzID0gbmV3IEFycmF5PG5nLklQcm9taXNlPGFueT4+KCk7XHJcblxyXG4gICAgICAgICAgICAvLyBnZXQgbGlzdCBvZiBhdHRhY2hlZCBmaWxlcyBmb3IgY3VycmVudCBlbGVtZW50XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xyXG5cclxuICAgICAgICAgICAgLy8gZ2V0IGZsYWcgdG8ga25vdyBpZiBjdXJyZW50IHVzZXIgaGFzIHVwbG9hZCByaWdodHMgZm9yIGN1cnJlbnQgaXRlbVxyXG4gICAgICAgICAgICB0aGlzLmdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBnZXQgc3VwcG9ydGVkIG1pbWUgdHlwZXMgZm9yIGZpbGUgdXBsb2FkLCBiYXNlZCBvbiBzcnYgaW5mb1xyXG4gICAgICAgICAgICB0aGlzLmdldFN1cHBvcnRlZE1pbWVUeXBlcygpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5uYk9mSXRlbXNQZXJQYWdlID0gMTA7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5ID0gbmV3IEFycmF5PHN0cmluZz4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgICAgICAgLy8jcmVnaW9uIHZtIG1ldGhvZHNcclxuXHJcbiAgICAgICAgZ2V0QXR0YWNoZWRGaWxlcygpOiB2b2lkIHtcclxuICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZ2V0QXR0YWNoZWRGaWxlcyh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZykudGhlbigoZmlsZUF0dGFjaG1lbnRMaXN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaGVkRmlsZUxpc3QgPSBmaWxlQXR0YWNobWVudExpc3Q7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaGVkRmlsZUxpc3RTb3VyY2UgPSBmaWxlQXR0YWNobWVudExpc3Q7IC8vVE9ETyBNR0EgOiBkdXBsaWNhdGUgPyB0byBwcmV2ZW50IHVwZGF0ZSB0byBzb3VyY2UgbGlzdCBpZiBjb2xsZWN0aW9uIG1vZGlmaWVkID9cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGdldFN1cHBvcnRlZE1pbWVUeXBlcygpOiB2b2lkIHtcclxuICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZ2V0U3VwcG9ydGVkTWltZVR5cGVzKCkudGhlbigoc3VwcG9ydGVkTWltZVR5cGVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1cHBvcnRlZE1pbWVUeXBlcyA9IF8oc3VwcG9ydGVkTWltZVR5cGVzKS51bmlxKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBqUXVlcnlBbmNob3JFbGVtZW50ID0gJCgnIycgKyB0aGlzLmZpbGVBdHRhY2htZW50RG93bmxvYWRMaW5rRWxlbWVudElkKTsgLy9hZGQgaWQgc2VsZWN0b3JcclxuXHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmRvd25sb2FkQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50LCB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlQXR0YWNobWVudC5GaWxlT3JpZ2luXSwgalF1ZXJ5QW5jaG9yRWxlbWVudCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvL1RPRE8gTUdBID8gb3IgbGVhdmUgYXMgaXMuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5kZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQuSWQsIHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW2ZpbGVBdHRhY2htZW50LkZpbGVPcmlnaW5dKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9hc3Rlci5zdWNjZXNzKGBGaWxlICgke2ZpbGVBdHRhY2htZW50LkZpbGVOYW1lfSkgc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQuYCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHVwZGF0ZUZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQsIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQgfHwgIXVwZGF0ZWRDb21tZW50KSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5lZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50KGZpbGVBdHRhY2htZW50LklkLCB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlQXR0YWNobWVudC5GaWxlT3JpZ2luXSwgdXBkYXRlZENvbW1lbnQpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckVkaXRDb21tZW50TW9kZShmaWxlQXR0YWNobWVudCk7IC8vVE9ETyBNR0E6IHVzZWxlc3MgaWYgd2UgcmVsb2FkIGFsbCBkYXRhIGZyb20gc3J2XHJcbiAgICAgICAgICAgICAgICAvLyByZXRyaWV2ZSB1cGRhdGUgbGlzdCBvZiBmaWxlcyB3aXRoIHVwZGF0ZWQgZmlsZSBjb21tZW50IGZyb20gc3J2IDogVE9ETyBNR0EgaW1wcm92ZSByZWxvYWQgKGNvc3RseSlcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xyXG4gICAgICAgICAgICAgICAgLy8gVE9ETyBNR0EgOiBoaWdobGlnaHQgdXBkYXRlZCBjb21tZW50ID9cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRPRE8gTUdBOiBpbXByb3ZlIGlubGluLWZvcm0gZXJyb3IgaGFuZGxpbmcgJiBVSSBmZWVkYmFjayAhIG5vdCBkeW5hbWljIC8vIGZsdWlkIHRvIHVzZVxyXG4gICAgICAgICAqIEBwYXJhbSBmaWxlQXR0YWNobWVudFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9uVXBkYXRlZENvbW1lbnQoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgfHwgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBcImNvbW1lbnQgbXVzdCBiZSBub24tZW1wdHlcIjtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCAmJlxyXG4gICAgICAgICAgICAgICAgKGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50Lmxlbmd0aCA8IDEgfHwgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQubGVuZ3RoID4gMjU1KSkge1xyXG4gICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBcImNvbW1lbnQgbXVzdCBiZSA8IDI1NSBjaGFyYWN0ZXJzXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSA9IG51bGw7IC8vcmVzZXQgZXJyb3IgbWVzc2FnZSB0byBmbGFnIGNvbW1lbnQgYXMgdmFsaWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2FuY2VsRWRpdENvbW1lbnQoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGZpbGVBdHRhY2htZW50LmVkaXRDb21tZW50TW9kZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvL2ZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50ID0gXCJcIjsgLy8gVE9ETyBNR0E6IGRlY2lkZSBiZWhhdmlvciA/IGJldHRlciB0byBrZWVwIGxhc3QgZW50cnkgPyBidXQgdGhlbiB3ZSBtdXN0IGFsc28ga2VlcCBlcnJvciBtZXNzYWdlXHJcbiAgICAgICAgICAgIC8vZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb25GaWxlU2VsZWN0ZWQoZmlsZTogRmlsZSwgZXZlbnQ6IG5nLmFuZ3VsYXJGaWxlVXBsb2FkLklGaWxlUHJvZ3Jlc3NFdmVudCk6IHZvaWQge1xyXG4gICAgICAgICAgICBpZiAoIWZpbGUpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkgPSBbXTsgLy9yZXNldCBlcnJvciBhcnJheVxyXG5cclxuICAgICAgICAgICAgdmFyIGZpbGVGb3JtYXRTdXBwb3J0ZWQgPSBmaWxlLnR5cGUgJiYgLy9JZiBmaWxlLnR5cGUgaXMgbnVsbCAvIGVtcHR5LCB0aGF0IG1lYW5zIGN1cnJlbnQgT1MgZG9lc24ndCBrbm93IGFib3V0IHRoZSBmaWxlIGZvcm1hdCA9PiBkZWxlZ2F0ZSB0byBzZXJ2ZXIgdG8gdmFsaWRhdGUgaWYgZm9ybWF0IGlzIHZhbGlkLCB3ZSBjYW4ndCBrbm93IGNsaWVudC1zaWRlLlxyXG4gICAgICAgICAgICAgICAgXyh0aGlzLnN1cHBvcnRlZE1pbWVUeXBlcykuYW55KChzdXBwb3J0ZWRNaW1lVHlwZSkgPT4gZmlsZS50eXBlID09PSBzdXBwb3J0ZWRNaW1lVHlwZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWZpbGVGb3JtYXRTdXBwb3J0ZWQpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5LnB1c2goYFVuc3VwcG9ydGVkIGZpbGUgZm9ybWF0OiAnJHtmaWxlLnR5cGV9J2ApOyAvL1RPRE8gTUdBOiBjb252ZXJ0IHRvIHJlYWRhYmxlIGV4dGVuc2lvbiBmcm9tIG1pbWUgdHlwZVxyXG5cclxuICAgICAgICAgICAgdmFyIGZpbGVTaXplU3VwcG9ydGVkID0gZmlsZS5zaXplICYmIGZpbGUuc2l6ZSA8IHRoaXMubWF4RmlsZVNpemU7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWZpbGVTaXplU3VwcG9ydGVkKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheS5wdXNoKGBTZWxlY3RlZCBmaWxlIGlzIGJpZ2dlciAoJHt0aGlzLmNvbnZlcnRCeXRlc1RvTWVnYUJ5dGVzKGZpbGUuc2l6ZSl9bWIpIHRoYW4gYXV0aG9yaXplZCBmaWxlIHNpemU6ICR7dGhpcy5jb252ZXJ0Qnl0ZXNUb01lZ2FCeXRlcyh0aGlzLm1heEZpbGVTaXplKX1tYmApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW1wb3J0U2VsZWN0ZWRGaWxlKCk6IHZvaWQge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWRGaWxlIHx8IF8odGhpcy5maWxlSW52YWxpZE1lc3NhZ2VBcnJheSkuYW55KCkpIHJldHVybjsgLy9UT0RPIE1HQSAkbG9nXHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5hdHRhY2hGaWxlKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nLCB0aGlzLnNlbGVjdGVkRmlsZSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvYXN0ZXIuc3VjY2VzcyhgRmlsZSAoJHt0aGlzLnNlbGVjdGVkRmlsZS5uYW1lfSkgc3VjY2Vzc2Z1bGx5IHVwbG9hZGVkLmApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7IC8vVE9ETyBNR0EgOiBoaWdobGlnaHQgbmV3IGVudHJ5ID9cclxuICAgICAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvL2NsZWFuIHVwIHNlbGVjdGVkIGZpbGVcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWxlY3RlZEZpbGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNsZWFyU2VsZWN0ZWRGaWxlKCk6IHZvaWQge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkgPSBbXTsgLy8gY2xlYXIgZXJyb3IgbWVzc2FnZXNcclxuICAgICAgICAgICAgLy90aGlzLmZpbGVTZWxlY3RlZElzVmFsaWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29udmVydEJ5dGVzVG9NZWdhQnl0ZXMoYnl0ZXM6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICAgICAgICAgIHJldHVybiArKGJ5dGVzIC8gMTAwMDAwMCkudG9GaXhlZCgyKTsgLy9jb252ZXJ0cyBiYWNrIHRvIG51bWJlciAyLWRpZ2l0cyBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2Ygb3JpZ2luYWwgY29udmVyc2lvbi5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gcHJpdmF0ZSBtZXRob2RzXHJcblxyXG4gICAgICAgIGNsZWFyRWRpdENvbW1lbnRNb2RlKGZpbGVBdHRhY2htZW50OiBGaWxlQXR0YWNobWVudCkge1xyXG4gICAgICAgICAgICBmaWxlQXR0YWNobWVudC5lZGl0Q29tbWVudE1vZGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgPSBudWxsO1xyXG4gICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBnZXRDdXJyZW50VXNlclVwbG9hZFJpZ2h0cygpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50VXNlclVwbG9hZFJpZ2h0cyh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZylcclxuICAgICAgICAgICAgICAgIC50aGVuKGJvb2xlYW5SZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNDdXJyZW50VXNlclVwbG9hZFJpZ2h0cyA9IGJvb2xlYW5SZXNwb25zZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8jZW5kcmVnaW9uXHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50Q29tcG9uZW50IGltcGxlbWVudHMgbmcuSUNvbXBvbmVudE9wdGlvbnMge1xyXG5cclxuICAgICAgICBwdWJsaWMgYmluZGluZ3M6IGFueTtcclxuICAgICAgICBwdWJsaWMgY29udHJvbGxlcjogYW55O1xyXG4gICAgICAgIHB1YmxpYyBjb250cm9sbGVyQXM6IHN0cmluZztcclxuICAgICAgICBwdWJsaWMgdGVtcGxhdGVVcmw6IHN0cmluZztcclxuXHJcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmJpbmRpbmdzID0ge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudElkQmluZGluZzogJz0nLFxyXG4gICAgICAgICAgICAgICAgb3JpZ2luQmluZGluZzogJz0nXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlckFzID0gJ3ZtJztcclxuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZVVybCA9ICdjb21wb25lbnQvZmlsZS1hdHRhY2htZW50LnRwbC5odG1sJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5jb21wb25lbnRzLmZpbGVBdHRhY2htZW50JywgW1xyXG4gICAgICAgICdjZ0J1c3knLFxyXG4gICAgICAgICdzbWFydC10YWJsZScsXHJcbiAgICAgICAgJ3RvYXN0ZXInLFxyXG4gICAgICAgICdmaWxlLWF0dGFjaG1lbnQtY29tcG9uZW50LXRwbCcsXHJcbiAgICAgICAgJ2JsdWVza3kuY29yZS5zZXJ2aWNlcy5maWxlQXR0YWNobWVudCcsXHJcbiAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJyxcclxuICAgICAgICAnYmx1ZXNreS5jb3JlLm1vZGVscy5hcHBsaWNhdGlvbk9yaWdpbkVudW0nXHJcbiAgICBdKVxyXG4gICAgLy9UT0RPIE1HQTogbWFrZSB0aGlzIHVuaWZvcm0gZm9yIGVhY2ggZGlyZWN0aXZlcyAvLyBzaGFyZSBiZWhhdmlvclxyXG4gICAgLnZhbHVlKCdjZ0J1c3lEZWZhdWx0cycsIHsgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvYW5ndWxhci1idXN5L2FuZ3VsYXItYnVzeS1jdXN0b20udHBsLmh0bWwnIH0pXHJcbiAgICAuY29uc3RhbnQoJ18nLCB3aW5kb3dbJ18nXSlcclxuICAgIC5jb25zdGFudCgnbW9tZW50Jywgd2luZG93Wydtb21lbnQnXSlcclxuICAgIC5jb21wb25lbnQoJ2ZpbGVBdHRhY2htZW50Q29tcG9uZW50JywgbmV3IEZpbGVBdHRhY2htZW50Q29tcG9uZW50KCkpO1xyXG5cclxufSIsIm5hbWVzcGFjZSBibHVlc2t5LmNvcmUubW9kZWxzIHtcclxuICAgIC8qKlxyXG4gICAgICogVE9ETyBNR0EgOiBkZWNpZGUgb24gcHJhY3RpY2UgdG8gc2hhcmUgZW51bXMgd2l0aCBzcnYgZXRjXHJcbiAgICAgKi9cclxuICAgIGV4cG9ydCBlbnVtIEFwcGxpY2F0aW9uT3JpZ2luRW51bSB7XHJcbiAgICAgICAgUXVvdGVXaXphcmQsXHJcbiAgICAgICAgT3JkZXJFbnRyeSxcclxuICAgICAgICBPcmRlclRyYWNraW5nXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBkZWNsYXJlZCBhcyBhbmd1bGFyIG1vZHVsZSB0byBiZSBpbmplY3RlZCBhdCBydW50aW1lIGluc2lkZSBjb250cm9sbGVycy9zZXJ2aWNlcyB0byB1c2UgaXQgYXMgYSBkaWN0aW9ubmFyeS5cclxuICAgICAqIE90aGVyd2lzZSwgd2UgYXJlIG5vdCBzdXJlIHRoZSByZWZlcmVuY2UgdG8gdGhpcyBvYmplY3Qgd2lsbCB2ZSBrbm93biBhdCBydW50aW1lIGR1ZSB0byBvcmRlciBvZiBldmFsdWF0aW9uIG9mIGltcG9ydHMgaW5zaWRlIGdlbmVyYXRlZCBqcy5cclxuICAgICAqL1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2JsdWVza3kuY29yZS5tb2RlbHMuYXBwbGljYXRpb25PcmlnaW5FbnVtJywgW10pXHJcbiAgICAgICAgLmNvbnN0YW50KCdhcHBsaWNhdGlvbk9yaWdpbkVudW0nLCBBcHBsaWNhdGlvbk9yaWdpbkVudW0pO1xyXG59IiwibmFtZXNwYWNlIGJsdWVza3kuY29yZS5tb2RlbHMge1xyXG4gICAgLyoqXHJcbiAgICAgKiBUT0RPIE1HQSA6IGRlY2lkZSBvbiBwcmFjdGljZSB0byBzaGFyZSBlbnVtcyB3aXRoIHNydiBldGNcclxuICAgICAqL1xyXG4gICAgZXhwb3J0IGVudW0gRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtIHtcclxuICAgICAgICBRdW90ZVdpemFyZEZpbGVBdHRhY2htZW50LFxyXG4gICAgICAgIE9yZGVyRW50cnlDdXN0b21EZXRhaWxzLFxyXG4gICAgICAgIE9yZGVyRW50cnlBdWRpb0N1c3RvbURldGFpbCxcclxuICAgICAgICBPcmRlclRyYWNraW5nRmlsZUF0dGFjaG1lbnRcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGRlY2xhcmVkIGFzIGFuZ3VsYXIgbW9kdWxlIHRvIGJlIGluamVjdGVkIGF0IHJ1bnRpbWUgaW5zaWRlIGNvbnRyb2xsZXJzL3NlcnZpY2VzIHRvIHVzZSBpdCBhcyBhIGRpY3Rpb25uYXJ5LlxyXG4gICAgICogT3RoZXJ3aXNlLCB3ZSBhcmUgbm90IHN1cmUgdGhlIHJlZmVyZW5jZSB0byB0aGlzIG9iamVjdCB3aWxsIHZlIGtub3duIGF0IHJ1bnRpbWUgZHVlIHRvIG9yZGVyIG9mIGV2YWx1YXRpb24gb2YgaW1wb3J0cyBpbnNpZGUgZ2VuZXJhdGVkIGpzLlxyXG4gICAgICovXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5jb3JlLm1vZGVscy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0nLCBbXSlcclxuICAgICAgICAgICAuY29uc3RhbnQoJ2ZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsIEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSk7XHJcbn0iLCJuYW1lc3BhY2UgYmx1ZXNreS5jb3JlLm1vZGVscyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUT0RPIE1HQSA6IGV4cG9ydCBhbiBpbnRlcmZhY2UgdG9vID9cclxuICAgICAqL1xyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50IHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgLy9zcnYtc2lkZSBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICAgIHB1YmxpYyBJZDogbnVtYmVyLFxyXG4gICAgICAgICAgICBwdWJsaWMgRmlsZU5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIENvbW1lbnQ6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIFVwbG9hZGVySW5mb3JtYXRpb246IFVzZXJJbmZvcm1hdGlvbixcclxuICAgICAgICAgICAgcHVibGljIENyZWF0aW9uRGF0ZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgRmlsZU9yaWdpbjogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgQ2FuQ3VycmVudFVzZXJEb3dubG9hZEZpbGU6IGJvb2xlYW4sXHJcbiAgICAgICAgICAgIHB1YmxpYyBDYW5DdXJyZW50VXNlckRlbGV0ZUZpbGU6IGJvb2xlYW4sXHJcbiAgICAgICAgICAgIHB1YmxpYyBDYW5DdXJyZW50VXNlckVkaXRDb21tZW50OiBib29sZWFuLFxyXG4gICAgICAgICAgICAvL2NsaWVudC1zaWRlIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgcHVibGljIGVkaXRDb21tZW50TW9kZTogYm9vbGVhbixcclxuICAgICAgICAgICAgcHVibGljIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpYyB1cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZTogc3RyaW5nXHJcbiAgICAgICAgKSB7IH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgVXNlckluZm9ybWF0aW9uIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgcHVibGljIEZpcnN0TmFtZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgTGFzdE5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIERpc3BsYXlOYW1lOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpYyB1c2VySWRlbnRpZmllcjogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgRW1haWw6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIFBob25lTnVtYmVyOiBzdHJpbmdcclxuICAgICAgICApIHsgfVxyXG4gICAgfVxyXG59IiwibmFtZXNwYWNlIGJsdWVza3kuY29yZS5tb2RlbHMge1xyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBKc29uQm9vbGVhblJlc3BvbnNlIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihwdWJsaWMgYm9vbGVhblJlc3BvbnNlOiBib29sZWFuKSB7IH1cclxuICAgIH1cclxufSIsIm5hbWVzcGFjZSBibHVlc2t5LmNvcmUuc2VydmljZXMge1xyXG5cclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudCA9IGJsdWVza3kuY29yZS5tb2RlbHMuRmlsZUF0dGFjaG1lbnQ7XHJcbiAgICBpbXBvcnQgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudE9yaWdpbkVudW07XHJcbiAgICBpbXBvcnQgQXBwbGljYXRpb25PcmlnaW5FbnVtID0gYmx1ZXNreS5jb3JlLm1vZGVscy5BcHBsaWNhdGlvbk9yaWdpbkVudW07XHJcbiAgICBpbXBvcnQgSnNvbkJvb2xlYW5SZXNwb25zZSA9IGJsdWVza3kuY29yZS5tb2RlbHMuSnNvbkJvb2xlYW5SZXNwb25zZTtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWxlQXR0YWNobWVudFNlcnZpY2Uge1xyXG5cclxuICAgICAgICBnZXRBdHRhY2hlZEZpbGVzKGVsZW1lbnRJZDogbnVtYmVyLCBhcHBsaWNhdGlvbk9yaWdpbjogQXBwbGljYXRpb25PcmlnaW5FbnVtKTogbmcuSVByb21pc2U8QXJyYXk8RmlsZUF0dGFjaG1lbnQ+PjtcclxuXHJcbiAgICAgICAgYXR0YWNoRmlsZShlbGVtZW50SWQ6IG51bWJlciwgYXBwbGljYXRpb25PcmlnaW46IEFwcGxpY2F0aW9uT3JpZ2luRW51bSwgZmlsZVRvVXBsb2FkOiBGaWxlKTogbmcuSVByb21pc2U8YW55PjtcclxuXHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50LCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIGFuY2hvckVsZW1lbnQ6IEpRdWVyeSk6IG5nLklQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAgICAgICBkZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnRJZDogbnVtYmVyLCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgICAgICAgZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudElkOiBudW1iZXIsIGZpbGVPcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSwgdXBkYXRlZENvbW1lbnQ6IHN0cmluZyk6IG5nLklQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAgICAgICBnZXRTdXBwb3J0ZWRNaW1lVHlwZXMoKTogbmcuSVByb21pc2U8QXJyYXk8c3RyaW5nPj47XHJcblxyXG4gICAgICAgIGdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzKGVsZW1lbnRJZDogbnVtYmVyLCBhcHBsaWNhdGlvbk9yaWdpbjogQXBwbGljYXRpb25PcmlnaW5FbnVtKTogbmcuSVByb21pc2U8Ym9vbGVhbj47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50U2VydmljZSBpbXBsZW1lbnRzIElGaWxlQXR0YWNobWVudFNlcnZpY2Uge1xyXG5cclxuICAgICAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgcHJpdmF0ZSBodHRwV3JhcHBlclNlcnZpY2U6IElIdHRwV3JhcHBlclNlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgJGxvZzogbmcuSUxvZ1NlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgJHRpbWVvdXQ6IG5nLklUaW1lb3V0U2VydmljZSxcclxuICAgICAgICAgICAgcHJpdmF0ZSBVcGxvYWQ6IG5nLmFuZ3VsYXJGaWxlVXBsb2FkLklVcGxvYWRTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIEJsb2I6IGFueSwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XHJcbiAgICAgICAgICAgIHByaXZhdGUgRmlsZVNhdmVyOiBhbnksIC8vVE9ETyBNR0E6IHR5cGluZ3MgP1xyXG4gICAgICAgICAgICBwcml2YXRlIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bTogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLFxyXG4gICAgICAgICAgICBwcml2YXRlIGFwcGxpY2F0aW9uT3JpZ2luRW51bTogQXBwbGljYXRpb25PcmlnaW5FbnVtXHJcbiAgICAgICAgKSB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0QXR0YWNoZWRGaWxlcyhlbGVtZW50SWQ6IG51bWJlciwgYXBwbGljYXRpb25PcmlnaW46IEFwcGxpY2F0aW9uT3JpZ2luRW51bSk6IG5nLklQcm9taXNlPEFycmF5PEZpbGVBdHRhY2htZW50Pj4ge1xyXG4gICAgICAgICAgICAvL1RPRE8gTUdBIDogY2xlYW5lciBwYXJhbXMgaGFuZGxpbmcgdG8gcGFzcyB0byBodHRwIGNhbGxcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldDxBcnJheTxGaWxlQXR0YWNobWVudD4+KCdmaWxlLWF0dGFjaG1lbnQvc2VhcmNoJywge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdlbGVtZW50SWQnOiBlbGVtZW50SWQsICdhcHBsaWNhdGlvbk9yaWdpbic6IHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtW2FwcGxpY2F0aW9uT3JpZ2luXSB9LFxyXG4gICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhdHRhY2hGaWxlKGVsZW1lbnRJZDogbnVtYmVyLCBhcHBsaWNhdGlvbk9yaWdpbjogQXBwbGljYXRpb25PcmlnaW5FbnVtLCBmaWxlVG9VcGxvYWQ6IEZpbGUpOiBuZy5JUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlVG9VcGxvYWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy53YXJuKCdbZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmF0dGFjaEZpbGVdIGZpbGUgaXMgZW1wdHksIGFib3J0aW5nIHVwbG9hZC4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL1RPRE8gTUdBOiB3ZSBzaG91bGQgcmVseSBvbiBhIHN0cm9uZ2VyIGh0dHAtd3JhcHBlciB0byBoYW5kbGUgdXBsb2FkIHRoaXMgd2F5XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLlVwbG9hZC5iYXNlNjREYXRhVXJsKGZpbGVUb1VwbG9hZCkudGhlbigoZmlsZUJhc2U2NFVybCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLnBvc3Q8YW55PignZmlsZS1hdHRhY2htZW50L3B1dCcsXHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBtb2RlbCBmb3IgQXR0YWNoRmlsZUR0byAmIEZpbGVVcGxvYWRCYXNlRHRvXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnRWxlbWVudElkJzogZWxlbWVudElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnQXBwbGljYXRpb25PcmlnaW4nOiB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlVXBsb2FkQmFzZUR0byc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlTmFtZSc6IGZpbGVUb1VwbG9hZC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVCYXNlNjRVcmwnOiBmaWxlQmFzZTY0VXJsLnNsaWNlKGZpbGVCYXNlNjRVcmwuaW5kZXhPZignYmFzZTY0LCcpICsgJ2Jhc2U2NCwnLmxlbmd0aCksIC8vc3RyaXAgdGhlIGRhdGFVcmkgcGFydCBvZiB0aGUgYmFzZTY0IGVuY29kaW5nIHRvIG9ubHkga2VlcCBiYXNlNjQgcmF3IGRhdGEuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudFR5cGUnOiBmaWxlVG9VcGxvYWQudHlwZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkSW5CYXNlNjRKc29uOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50LCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIGFuY2hvckVsZW1lbnQ6IEpRdWVyeSk6IG5nLklQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQgfHwgIWZpbGVBdHRhY2htZW50LkZpbGVOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ1tmaWxlQXR0YWNobWVudF0gbWFuZGF0b3J5LicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghYW5jaG9yRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdbYW5jaG9yRWxlbWVudF0gbWFuZGF0b3J5LicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQ8RmlsZT4oJ2ZpbGUtYXR0YWNobWVudC9kb3dubG9hZCcsIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50LklkLCAnZmlsZU9yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW2ZpbGVPcmlnaW5dIH0sXHJcbiAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZVxyXG4gICAgICAgICAgICB9KS50aGVuPHZvaWQ+KChmaWxlOiBGaWxlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBmaWxld2l0aEJPTSA9ICdcXHVGRUZGJysgZmlsZTtcclxuICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07dXRmLTgnIH0pOyAvL1RPRE8gTUdBOiB0eXBlID8/PyBob3cgdG8gcmV0cmlldmUgY29udGVudC10eXBlIGZyb20gYmxvYlxyXG4gICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnaW1hZ2UvcG5nO2NoYXJzZXQ9d2luZG93cy0xMjUyJyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcclxuICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PUlTTy04ODU5LTEnIH0pOyAvL1RPRE8gTUdBOiB0eXBlID8/PyBob3cgdG8gcmV0cmlldmUgY29udGVudC10eXBlIGZyb20gYmxvYlxyXG4gICAgICAgICAgICAgICAgLy92YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnaW1hZ2UvcG5nJyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLkZpbGVTYXZlci5zYXZlQXMoYmxvYiwgZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWUgfHwgJ3Vua25vd24uYmluJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy92YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8vL1RPRE8gTUdBOiBkZWxheSB0byB0byBiZSBvdXRzaWRlIG9mIGN1cnJlbnQgZGlnZXN0IGN5Y2xlIDogaG93IHRvIGZpeCA/XHJcbiAgICAgICAgICAgICAgICAvL3RoaXMuJHRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgYW5jaG9yRWxlbWVudFxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIC5hdHRyKHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgXCJocmVmXCI6IHVybCxcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgXCJkb3dubG9hZFwiOiAndW5rbm93bi5wbmcnXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIC8vXCJkb3dubG9hZFwiOiBmaWxlQXR0YWNobWVudE5hbWUgfHwgJ3Vua25vd24uYmluJ1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgLy8uaHRtbCgkKFwiYVwiKS5hdHRyKFwiZG93bmxvYWRcIikpXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgLmdldCgwKS5jbGljaygpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAvLyBUT0RPIE1HQSA6IGhhY2sgdG8gdHJpZ2dlciBkb3dubG9hZCBvZiBmaWxlIGZyb20gSlMsIHRvIHJlZmFjdG9yIGluIGEgZGlyZWN0aXZlICsgc2VlIEpxdWVyeSBsaW1pdGF0aW9ucyBvZiBjbGljayBldmVudCA6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTczMTE2NDUvZG93bmxvYWQtaW1hZ2Utd2l0aC1qYXZhc2NyaXB0IFxyXG4gICAgICAgICAgICAgICAgLy8gICAgLy9hbmNob3JFbGVtZW50LnByb3AoJ2hyZWYnLCB1cmwpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgLy9hbmNob3JFbGVtZW50LnByb3AoJ2Rvd25sb2FkJywgZmlsZUF0dGFjaG1lbnROYW1lIHx8ICd1bmtub3duLmJpbicpOyAvL1RPRE8gTUdBID8/P1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5nZXQoMCkuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgIC8vfSwgMCk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vYW5jaG9yRWxlbWVudC5jbGljaygpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBBZGRlZCBhIHNtYWxsIGRlbGF5IGJlY2F1c2UgZmlsZSB3YXMgcmVtb3ZlZCB0byBxdWlja2x5IGluIGZpcmVmb3ggYW5kIHRoZSBkb3dubG9hZCB3YXMgZXZlbiBub3QgaW5pdGlhbGl6ZWRcclxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0ZW1wIGVsZW1lbnQgZnJvbSBicm93c2VyIGNhY2hlIDogVE9ETyBNR0EgZmluZCBhIHdheSB0byBkbyB0aGlzIGluIGEgZmluYWxseSgpIGNsYXVzZSBpbiB0aGUgc2VydmljZSBtZXRob2QgP1xyXG4gICAgICAgICAgICAgICAgLy93aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xyXG4gICAgICAgICAgICAgICAgLy99LCAxMDApO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkZWxldGVBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnRJZDogbnVtYmVyLCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5kZWxldGU8dm9pZD4oJ2ZpbGUtYXR0YWNobWVudC9kZWxldGUnLCB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgJ2ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLCAnZmlsZU9yaWdpbic6IHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW2ZpbGVPcmlnaW5dIH0sXHJcbiAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVkaXRGaWxlQXR0YWNobWVudENvbW1lbnQoZmlsZUF0dGFjaG1lbnRJZDogbnVtYmVyLCBmaWxlT3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcpOiBuZy5JUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5wb3N0PHZvaWQ+KCdmaWxlLWF0dGFjaG1lbnQvdXBkYXRlLWNvbW1lbnQnLFxyXG4gICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBEdG8gY2xpZW50LXNpZGUgb3IgdXBkYXRlIGVuZHBvaW50IHNydi1zaWRlIHRvIHN1cHBvcnQgcGFydC1wYXJhbXMgdXJsICsgY29tbWVudCBhcyBwYXlsb2FkIChjbGVhbmVyIFNPQykuXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLFxyXG4gICAgICAgICAgICAgICAgICAgICdGaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0sXHJcbiAgICAgICAgICAgICAgICAgICAgJ0NvbW1lbnQnOiB1cGRhdGVkQ29tbWVudFxyXG4gICAgICAgICAgICAgICAgfSwgeyBhcGlFbmRwb2ludDogdHJ1ZSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGdldFN1cHBvcnRlZE1pbWVUeXBlcygpOiBuZy5JUHJvbWlzZTxBcnJheTxzdHJpbmc+PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQ8QXJyYXk8c3RyaW5nPj4oJ2ZpbGUtYXR0YWNobWVudC9hdXRob3JpemVkLW1pbWUtdHlwZXMnLCB7IGFwaUVuZHBvaW50OiB0cnVlIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHMoZWxlbWVudElkOiBudW1iZXIsIGFwcGxpY2F0aW9uT3JpZ2luOiBBcHBsaWNhdGlvbk9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQ8SnNvbkJvb2xlYW5SZXNwb25zZT4oJ2ZpbGUtYXR0YWNobWVudC9nZXQtY3VycmVudC11c2VyLXVwbG9hZC1yaWdodHMnLFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnYXBwbGljYXRpb25PcmlnaW4nOiB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0gfSxcclxuICAgICAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuYm9vbGVhblJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUuc2VydmljZXMuZmlsZUF0dGFjaG1lbnQnLCBbXHJcbiAgICAgICAgJ25nLmh0dHBXcmFwcGVyJyxcclxuICAgICAgICAnbmdGaWxlVXBsb2FkJyxcclxuICAgICAgICAnbmdGaWxlU2F2ZXInLFxyXG4gICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsXHJcbiAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuYXBwbGljYXRpb25PcmlnaW5FbnVtJ1xyXG4gICAgXSkuc2VydmljZSgnZmlsZUF0dGFjaG1lbnRTZXJ2aWNlJywgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlKTtcclxufSIsInZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBjb21wb25lbnRzO1xuICAgICAgICAoZnVuY3Rpb24gKGNvbXBvbmVudHMpIHtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvblxuICAgICAgICAgICAgICAgIC8vI3JlZ2lvbiBjdG9yXG4gICAgICAgICAgICAgICAgLyogQG5nSW5qZWN0ICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyKCRsb2csIHRvYXN0ZXIsIF8sIGZpbGVBdHRhY2htZW50U2VydmljZSwgZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCBhcHBsaWNhdGlvbk9yaWdpbkVudW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nID0gJGxvZztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b2FzdGVyID0gdG9hc3RlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fID0gXztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UgPSBmaWxlQXR0YWNobWVudFNlcnZpY2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0gZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bSA9IGFwcGxpY2F0aW9uT3JpZ2luRW51bTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZCA9ICdmaWxlLWF0dGFjaG1lbnQtZG93bmxvYWQtbGluayc7IC8vVE9ETyBNR0EgOiB0byBjb25zdCA/XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzQ3VycmVudFVzZXJVcGxvYWRSaWdodHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgLy8jZW5kcmVnaW9uXG4gICAgICAgICAgICAgICAgICAgIC8vI3JlZ2lvbiBwcml2YXRlIGZpZWxkc1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1heEZpbGVTaXplID0gMjAwMDAwMDA7IC8vaW4gYnl0ZXMgPSAyMG1iXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbGVtZW50SWRCaW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ3BhcmFtZXRlciB7ZWxlbWVudElkQmluZGluZ30gaXMgbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5hcHBsaWNhdGlvbk9yaWdpbkVudW1bdGhpcy5vcmlnaW5CaW5kaW5nXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdwYXJhbWV0ZXIge29yaWdpbkJpbmRpbmd9IGlzIG1hbmRhdG9yeS4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcyA9IG5ldyBBcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgbGlzdCBvZiBhdHRhY2hlZCBmaWxlcyBmb3IgY3VycmVudCBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgZmxhZyB0byBrbm93IGlmIGN1cnJlbnQgdXNlciBoYXMgdXBsb2FkIHJpZ2h0cyBmb3IgY3VycmVudCBpdGVtXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q3VycmVudFVzZXJVcGxvYWRSaWdodHMoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHN1cHBvcnRlZCBtaW1lIHR5cGVzIGZvciBmaWxlIHVwbG9hZCwgYmFzZWQgb24gc3J2IGluZm9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRTdXBwb3J0ZWRNaW1lVHlwZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYk9mSXRlbXNQZXJQYWdlID0gMTA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8jZW5kcmVnaW9uXG4gICAgICAgICAgICAgICAgLy8jcmVnaW9uIHZtIG1ldGhvZHNcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmdldEF0dGFjaGVkRmlsZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmdldEF0dGFjaGVkRmlsZXModGhpcy5lbGVtZW50SWRCaW5kaW5nLCB0aGlzLm9yaWdpbkJpbmRpbmcpLnRoZW4oZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50TGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0YWNoZWRGaWxlTGlzdCA9IGZpbGVBdHRhY2htZW50TGlzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dGFjaGVkRmlsZUxpc3RTb3VyY2UgPSBmaWxlQXR0YWNobWVudExpc3Q7IC8vVE9ETyBNR0EgOiBkdXBsaWNhdGUgPyB0byBwcmV2ZW50IHVwZGF0ZSB0byBzb3VyY2UgbGlzdCBpZiBjb2xsZWN0aW9uIG1vZGlmaWVkID9cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5nZXRTdXBwb3J0ZWRNaW1lVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmdldFN1cHBvcnRlZE1pbWVUeXBlcygpLnRoZW4oZnVuY3Rpb24gKHN1cHBvcnRlZE1pbWVUeXBlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3VwcG9ydGVkTWltZVR5cGVzID0gXyhzdXBwb3J0ZWRNaW1lVHlwZXMpLnVuaXEoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5kb3dubG9hZEF0dGFjaGVkRmlsZSA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50IHx8ICFmaWxlQXR0YWNobWVudC5JZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGpRdWVyeUFuY2hvckVsZW1lbnQgPSAkKCcjJyArIHRoaXMuZmlsZUF0dGFjaG1lbnREb3dubG9hZExpbmtFbGVtZW50SWQpOyAvL2FkZCBpZCBzZWxlY3RvclxuICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5kb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0sIGpRdWVyeUFuY2hvckVsZW1lbnQpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA/IG9yIGxlYXZlIGFzIGlzLlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmRlbGV0ZUF0dGFjaGVkRmlsZSA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50IHx8ICFmaWxlQXR0YWNobWVudC5JZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZGVsZXRlQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50LklkLCB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlQXR0YWNobWVudC5GaWxlT3JpZ2luXSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2FzdGVyLnN1Y2Nlc3MoXCJGaWxlIChcIiArIGZpbGVBdHRhY2htZW50LkZpbGVOYW1lICsgXCIpIHN1Y2Nlc3NmdWxseSBkZWxldGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVGaWxlQXR0YWNobWVudENvbW1lbnQgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQsIHVwZGF0ZWRDb21tZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkIHx8ICF1cGRhdGVkQ29tbWVudClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZUF0dGFjaG1lbnQuRmlsZU9yaWdpbl0sIHVwZGF0ZWRDb21tZW50KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNsZWFyRWRpdENvbW1lbnRNb2RlKGZpbGVBdHRhY2htZW50KTsgLy9UT0RPIE1HQTogdXNlbGVzcyBpZiB3ZSByZWxvYWQgYWxsIGRhdGEgZnJvbSBzcnZcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHJpZXZlIHVwZGF0ZSBsaXN0IG9mIGZpbGVzIHdpdGggdXBkYXRlZCBmaWxlIGNvbW1lbnQgZnJvbSBzcnYgOiBUT0RPIE1HQSBpbXByb3ZlIHJlbG9hZCAoY29zdGx5KVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2V0QXR0YWNoZWRGaWxlcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBNR0EgOiBoaWdobGlnaHQgdXBkYXRlZCBjb21tZW50ID9cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVE9ETyBNR0E6IGltcHJvdmUgaW5saW4tZm9ybSBlcnJvciBoYW5kbGluZyAmIFVJIGZlZWRiYWNrICEgbm90IGR5bmFtaWMgLy8gZmx1aWQgdG8gdXNlXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIGZpbGVBdHRhY2htZW50XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5vblVwZGF0ZWRDb21tZW50ID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgfHwgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBcImNvbW1lbnQgbXVzdCBiZSBub24tZW1wdHlcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKGZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50Lmxlbmd0aCA8IDEgfHwgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQubGVuZ3RoID4gMjU1KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UgPSBcImNvbW1lbnQgbXVzdCBiZSA8IDI1NSBjaGFyYWN0ZXJzXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSA9IG51bGw7IC8vcmVzZXQgZXJyb3IgbWVzc2FnZSB0byBmbGFnIGNvbW1lbnQgYXMgdmFsaWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jYW5jZWxFZGl0Q29tbWVudCA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC5lZGl0Q29tbWVudE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgLy9maWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudCA9IFwiXCI7IC8vIFRPRE8gTUdBOiBkZWNpZGUgYmVoYXZpb3IgPyBiZXR0ZXIgdG8ga2VlcCBsYXN0IGVudHJ5ID8gYnV0IHRoZW4gd2UgbXVzdCBhbHNvIGtlZXAgZXJyb3IgbWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICAvL2ZpbGVBdHRhY2htZW50LnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUub25GaWxlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoZmlsZSwgZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5ID0gW107IC8vcmVzZXQgZXJyb3IgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVGb3JtYXRTdXBwb3J0ZWQgPSBmaWxlLnR5cGUgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIF8odGhpcy5zdXBwb3J0ZWRNaW1lVHlwZXMpLmFueShmdW5jdGlvbiAoc3VwcG9ydGVkTWltZVR5cGUpIHsgcmV0dXJuIGZpbGUudHlwZSA9PT0gc3VwcG9ydGVkTWltZVR5cGU7IH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVGb3JtYXRTdXBwb3J0ZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnZhbGlkTWVzc2FnZUFycmF5LnB1c2goXCJVbnN1cHBvcnRlZCBmaWxlIGZvcm1hdDogJ1wiICsgZmlsZS50eXBlICsgXCInXCIpOyAvL1RPRE8gTUdBOiBjb252ZXJ0IHRvIHJlYWRhYmxlIGV4dGVuc2lvbiBmcm9tIG1pbWUgdHlwZVxuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZVNpemVTdXBwb3J0ZWQgPSBmaWxlLnNpemUgJiYgZmlsZS5zaXplIDwgdGhpcy5tYXhGaWxlU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlU2l6ZVN1cHBvcnRlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkucHVzaChcIlNlbGVjdGVkIGZpbGUgaXMgYmlnZ2VyIChcIiArIHRoaXMuY29udmVydEJ5dGVzVG9NZWdhQnl0ZXMoZmlsZS5zaXplKSArIFwibWIpIHRoYW4gYXV0aG9yaXplZCBmaWxlIHNpemU6IFwiICsgdGhpcy5jb252ZXJ0Qnl0ZXNUb01lZ2FCeXRlcyh0aGlzLm1heEZpbGVTaXplKSArIFwibWJcIik7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmltcG9ydFNlbGVjdGVkRmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRmlsZSB8fCBfKHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkpLmFueSgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvL1RPRE8gTUdBICRsb2dcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZSh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZywgdGhpcy5zZWxlY3RlZEZpbGUpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9hc3Rlci5zdWNjZXNzKFwiRmlsZSAoXCIgKyBfdGhpcy5zZWxlY3RlZEZpbGUubmFtZSArIFwiKSBzdWNjZXNzZnVsbHkgdXBsb2FkZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2V0QXR0YWNoZWRGaWxlcygpOyAvL1RPRE8gTUdBIDogaGlnaGxpZ2h0IG5ldyBlbnRyeSA/XG4gICAgICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jbGVhbiB1cCBzZWxlY3RlZCBmaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGVhclNlbGVjdGVkRmlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNsZWFyU2VsZWN0ZWRGaWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRmlsZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUludmFsaWRNZXNzYWdlQXJyYXkgPSBbXTsgLy8gY2xlYXIgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgICAgICAgICAgICAgLy90aGlzLmZpbGVTZWxlY3RlZElzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jb252ZXJ0Qnl0ZXNUb01lZ2FCeXRlcyA9IGZ1bmN0aW9uIChieXRlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKyhieXRlcyAvIDEwMDAwMDApLnRvRml4ZWQoMik7IC8vY29udmVydHMgYmFjayB0byBudW1iZXIgMi1kaWdpdHMgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIG9yaWdpbmFsIGNvbnZlcnNpb24uXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAvLyNlbmRyZWdpb25cbiAgICAgICAgICAgICAgICAvLyNyZWdpb24gcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jbGVhckVkaXRDb21tZW50TW9kZSA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC5lZGl0Q29tbWVudE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUF0dGFjaG1lbnQudXBkYXRlZENvbW1lbnQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBmaWxlQXR0YWNobWVudC51cGRhdGVkQ29tbWVudEVycm9yTWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGJvb2xlYW5SZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGFzQ3VycmVudFVzZXJVcGxvYWRSaWdodHMgPSBib29sZWFuUmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlcjtcbiAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICBjb21wb25lbnRzLkZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciA9IEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlcjtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudENvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnRDb21wb25lbnQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50SWRCaW5kaW5nOiAnPScsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5CaW5kaW5nOiAnPSdcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyID0gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXJBcyA9ICd2bSc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcGxhdGVVcmwgPSAnY29tcG9uZW50L2ZpbGUtYXR0YWNobWVudC50cGwuaHRtbCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBGaWxlQXR0YWNobWVudENvbXBvbmVudDtcbiAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICBjb21wb25lbnRzLkZpbGVBdHRhY2htZW50Q29tcG9uZW50ID0gRmlsZUF0dGFjaG1lbnRDb21wb25lbnQ7XG4gICAgICAgICAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5jb3JlLmNvbXBvbmVudHMuZmlsZUF0dGFjaG1lbnQnLCBbXG4gICAgICAgICAgICAgICAgJ2NnQnVzeScsXG4gICAgICAgICAgICAgICAgJ3NtYXJ0LXRhYmxlJyxcbiAgICAgICAgICAgICAgICAndG9hc3RlcicsXG4gICAgICAgICAgICAgICAgJ2ZpbGUtYXR0YWNobWVudC1jb21wb25lbnQtdHBsJyxcbiAgICAgICAgICAgICAgICAnYmx1ZXNreS5jb3JlLnNlcnZpY2VzLmZpbGVBdHRhY2htZW50JyxcbiAgICAgICAgICAgICAgICAnYmx1ZXNreS5jb3JlLm1vZGVscy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0nLFxuICAgICAgICAgICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmFwcGxpY2F0aW9uT3JpZ2luRW51bSdcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgLnZhbHVlKCdjZ0J1c3lEZWZhdWx0cycsIHsgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvYW5ndWxhci1idXN5L2FuZ3VsYXItYnVzeS1jdXN0b20udHBsLmh0bWwnIH0pXG4gICAgICAgICAgICAgICAgLmNvbnN0YW50KCdfJywgd2luZG93WydfJ10pXG4gICAgICAgICAgICAgICAgLmNvbnN0YW50KCdtb21lbnQnLCB3aW5kb3dbJ21vbWVudCddKVxuICAgICAgICAgICAgICAgIC5jb21wb25lbnQoJ2ZpbGVBdHRhY2htZW50Q29tcG9uZW50JywgbmV3IEZpbGVBdHRhY2htZW50Q29tcG9uZW50KCkpO1xuICAgICAgICB9KShjb21wb25lbnRzID0gY29yZS5jb21wb25lbnRzIHx8IChjb3JlLmNvbXBvbmVudHMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcblxudmFyIGJsdWVza3k7XG4oZnVuY3Rpb24gKGJsdWVza3kpIHtcbiAgICB2YXIgY29yZTtcbiAgICAoZnVuY3Rpb24gKGNvcmUpIHtcbiAgICAgICAgdmFyIG1vZGVscztcbiAgICAgICAgKGZ1bmN0aW9uIChtb2RlbHMpIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVE9ETyBNR0EgOiBkZWNpZGUgb24gcHJhY3RpY2UgdG8gc2hhcmUgZW51bXMgd2l0aCBzcnYgZXRjXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIChmdW5jdGlvbiAoQXBwbGljYXRpb25PcmlnaW5FbnVtKSB7XG4gICAgICAgICAgICAgICAgQXBwbGljYXRpb25PcmlnaW5FbnVtW0FwcGxpY2F0aW9uT3JpZ2luRW51bVtcIlF1b3RlV2l6YXJkXCJdID0gMF0gPSBcIlF1b3RlV2l6YXJkXCI7XG4gICAgICAgICAgICAgICAgQXBwbGljYXRpb25PcmlnaW5FbnVtW0FwcGxpY2F0aW9uT3JpZ2luRW51bVtcIk9yZGVyRW50cnlcIl0gPSAxXSA9IFwiT3JkZXJFbnRyeVwiO1xuICAgICAgICAgICAgICAgIEFwcGxpY2F0aW9uT3JpZ2luRW51bVtBcHBsaWNhdGlvbk9yaWdpbkVudW1bXCJPcmRlclRyYWNraW5nXCJdID0gMl0gPSBcIk9yZGVyVHJhY2tpbmdcIjtcbiAgICAgICAgICAgIH0pKG1vZGVscy5BcHBsaWNhdGlvbk9yaWdpbkVudW0gfHwgKG1vZGVscy5BcHBsaWNhdGlvbk9yaWdpbkVudW0gPSB7fSkpO1xuICAgICAgICAgICAgdmFyIEFwcGxpY2F0aW9uT3JpZ2luRW51bSA9IG1vZGVscy5BcHBsaWNhdGlvbk9yaWdpbkVudW07XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIGRlY2xhcmVkIGFzIGFuZ3VsYXIgbW9kdWxlIHRvIGJlIGluamVjdGVkIGF0IHJ1bnRpbWUgaW5zaWRlIGNvbnRyb2xsZXJzL3NlcnZpY2VzIHRvIHVzZSBpdCBhcyBhIGRpY3Rpb25uYXJ5LlxuICAgICAgICAgICAgICogT3RoZXJ3aXNlLCB3ZSBhcmUgbm90IHN1cmUgdGhlIHJlZmVyZW5jZSB0byB0aGlzIG9iamVjdCB3aWxsIHZlIGtub3duIGF0IHJ1bnRpbWUgZHVlIHRvIG9yZGVyIG9mIGV2YWx1YXRpb24gb2YgaW1wb3J0cyBpbnNpZGUgZ2VuZXJhdGVkIGpzLlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5jb3JlLm1vZGVscy5hcHBsaWNhdGlvbk9yaWdpbkVudW0nLCBbXSlcbiAgICAgICAgICAgICAgICAuY29uc3RhbnQoJ2FwcGxpY2F0aW9uT3JpZ2luRW51bScsIEFwcGxpY2F0aW9uT3JpZ2luRW51bSk7XG4gICAgICAgIH0pKG1vZGVscyA9IGNvcmUubW9kZWxzIHx8IChjb3JlLm1vZGVscyA9IHt9KSk7XG4gICAgfSkoY29yZSA9IGJsdWVza3kuY29yZSB8fCAoYmx1ZXNreS5jb3JlID0ge30pKTtcbn0pKGJsdWVza3kgfHwgKGJsdWVza3kgPSB7fSkpO1xuXG52YXIgYmx1ZXNreTtcbihmdW5jdGlvbiAoYmx1ZXNreSkge1xuICAgIHZhciBjb3JlO1xuICAgIChmdW5jdGlvbiAoY29yZSkge1xuICAgICAgICB2YXIgbW9kZWxzO1xuICAgICAgICAoZnVuY3Rpb24gKG1vZGVscykge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUT0RPIE1HQSA6IGRlY2lkZSBvbiBwcmFjdGljZSB0byBzaGFyZSBlbnVtcyB3aXRoIHNydiBldGNcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgKGZ1bmN0aW9uIChGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pIHtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiUXVvdGVXaXphcmRGaWxlQXR0YWNobWVudFwiXSA9IDBdID0gXCJRdW90ZVdpemFyZEZpbGVBdHRhY2htZW50XCI7XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW0ZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtcIk9yZGVyRW50cnlDdXN0b21EZXRhaWxzXCJdID0gMV0gPSBcIk9yZGVyRW50cnlDdXN0b21EZXRhaWxzXCI7XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW0ZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtcIk9yZGVyRW50cnlBdWRpb0N1c3RvbURldGFpbFwiXSA9IDJdID0gXCJPcmRlckVudHJ5QXVkaW9DdXN0b21EZXRhaWxcIjtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiT3JkZXJUcmFja2luZ0ZpbGVBdHRhY2htZW50XCJdID0gM10gPSBcIk9yZGVyVHJhY2tpbmdGaWxlQXR0YWNobWVudFwiO1xuICAgICAgICAgICAgfSkobW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bSB8fCAobW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bSA9IHt9KSk7XG4gICAgICAgICAgICB2YXIgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0gbW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogZGVjbGFyZWQgYXMgYW5ndWxhciBtb2R1bGUgdG8gYmUgaW5qZWN0ZWQgYXQgcnVudGltZSBpbnNpZGUgY29udHJvbGxlcnMvc2VydmljZXMgdG8gdXNlIGl0IGFzIGEgZGljdGlvbm5hcnkuXG4gICAgICAgICAgICAgKiBPdGhlcndpc2UsIHdlIGFyZSBub3Qgc3VyZSB0aGUgcmVmZXJlbmNlIHRvIHRoaXMgb2JqZWN0IHdpbGwgdmUga25vd24gYXQgcnVudGltZSBkdWUgdG8gb3JkZXIgb2YgZXZhbHVhdGlvbiBvZiBpbXBvcnRzIGluc2lkZSBnZW5lcmF0ZWQganMuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsIFtdKVxuICAgICAgICAgICAgICAgIC5jb25zdGFudCgnZmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtJywgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtKTtcbiAgICAgICAgfSkobW9kZWxzID0gY29yZS5tb2RlbHMgfHwgKGNvcmUubW9kZWxzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBtb2RlbHM7XG4gICAgICAgIChmdW5jdGlvbiAobW9kZWxzKSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRPRE8gTUdBIDogZXhwb3J0IGFuIGludGVyZmFjZSB0b28gP1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB2YXIgRmlsZUF0dGFjaG1lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEZpbGVBdHRhY2htZW50KFxuICAgICAgICAgICAgICAgICAgICAvL3Nydi1zaWRlIHByb3BlcnRpZXNcbiAgICAgICAgICAgICAgICAgICAgSWQsIEZpbGVOYW1lLCBDb21tZW50LCBVcGxvYWRlckluZm9ybWF0aW9uLCBDcmVhdGlvbkRhdGUsIEZpbGVPcmlnaW4sIENhbkN1cnJlbnRVc2VyRG93bmxvYWRGaWxlLCBDYW5DdXJyZW50VXNlckRlbGV0ZUZpbGUsIENhbkN1cnJlbnRVc2VyRWRpdENvbW1lbnQsIFxuICAgICAgICAgICAgICAgICAgICAvL2NsaWVudC1zaWRlIHByb3BlcnRpZXNcbiAgICAgICAgICAgICAgICAgICAgZWRpdENvbW1lbnRNb2RlLCB1cGRhdGVkQ29tbWVudCwgdXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IElkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkZpbGVOYW1lID0gRmlsZU5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ29tbWVudCA9IENvbW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuVXBsb2FkZXJJbmZvcm1hdGlvbiA9IFVwbG9hZGVySW5mb3JtYXRpb247XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ3JlYXRpb25EYXRlID0gQ3JlYXRpb25EYXRlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkZpbGVPcmlnaW4gPSBGaWxlT3JpZ2luO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkNhbkN1cnJlbnRVc2VyRG93bmxvYWRGaWxlID0gQ2FuQ3VycmVudFVzZXJEb3dubG9hZEZpbGU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ2FuQ3VycmVudFVzZXJEZWxldGVGaWxlID0gQ2FuQ3VycmVudFVzZXJEZWxldGVGaWxlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkNhbkN1cnJlbnRVc2VyRWRpdENvbW1lbnQgPSBDYW5DdXJyZW50VXNlckVkaXRDb21tZW50O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRDb21tZW50TW9kZSA9IGVkaXRDb21tZW50TW9kZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVkQ29tbWVudCA9IHVwZGF0ZWRDb21tZW50O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZWRDb21tZW50RXJyb3JNZXNzYWdlID0gdXBkYXRlZENvbW1lbnRFcnJvck1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBGaWxlQXR0YWNobWVudDtcbiAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICBtb2RlbHMuRmlsZUF0dGFjaG1lbnQgPSBGaWxlQXR0YWNobWVudDtcbiAgICAgICAgICAgIHZhciBVc2VySW5mb3JtYXRpb24gPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFVzZXJJbmZvcm1hdGlvbihGaXJzdE5hbWUsIExhc3ROYW1lLCBEaXNwbGF5TmFtZSwgdXNlcklkZW50aWZpZXIsIEVtYWlsLCBQaG9uZU51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkZpcnN0TmFtZSA9IEZpcnN0TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5MYXN0TmFtZSA9IExhc3ROYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkRpc3BsYXlOYW1lID0gRGlzcGxheU5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcklkZW50aWZpZXIgPSB1c2VySWRlbnRpZmllcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5FbWFpbCA9IEVtYWlsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLlBob25lTnVtYmVyID0gUGhvbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBVc2VySW5mb3JtYXRpb247XG4gICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgbW9kZWxzLlVzZXJJbmZvcm1hdGlvbiA9IFVzZXJJbmZvcm1hdGlvbjtcbiAgICAgICAgfSkobW9kZWxzID0gY29yZS5tb2RlbHMgfHwgKGNvcmUubW9kZWxzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBtb2RlbHM7XG4gICAgICAgIChmdW5jdGlvbiAobW9kZWxzKSB7XG4gICAgICAgICAgICB2YXIgSnNvbkJvb2xlYW5SZXNwb25zZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gSnNvbkJvb2xlYW5SZXNwb25zZShib29sZWFuUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib29sZWFuUmVzcG9uc2UgPSBib29sZWFuUmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBKc29uQm9vbGVhblJlc3BvbnNlO1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIG1vZGVscy5Kc29uQm9vbGVhblJlc3BvbnNlID0gSnNvbkJvb2xlYW5SZXNwb25zZTtcbiAgICAgICAgfSkobW9kZWxzID0gY29yZS5tb2RlbHMgfHwgKGNvcmUubW9kZWxzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlcztcbiAgICAgICAgKGZ1bmN0aW9uIChzZXJ2aWNlcykge1xuICAgICAgICAgICAgdmFyIEZpbGVBdHRhY2htZW50U2VydmljZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLyogQG5nSW5qZWN0ICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnRTZXJ2aWNlKGh0dHBXcmFwcGVyU2VydmljZSwgJGxvZywgJHRpbWVvdXQsIFVwbG9hZCwgQmxvYiwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XG4gICAgICAgICAgICAgICAgICAgIEZpbGVTYXZlciwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XG4gICAgICAgICAgICAgICAgICAgIGZpbGVBdHRhY2htZW50T3JpZ2luRW51bSwgYXBwbGljYXRpb25PcmlnaW5FbnVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlID0gaHR0cFdyYXBwZXJTZXJ2aWNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cgPSAkbG9nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0aW1lb3V0ID0gJHRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuVXBsb2FkID0gVXBsb2FkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkJsb2IgPSBCbG9iO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkZpbGVTYXZlciA9IEZpbGVTYXZlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBmaWxlQXR0YWNobWVudE9yaWdpbkVudW07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYXRpb25PcmlnaW5FbnVtID0gYXBwbGljYXRpb25PcmlnaW5FbnVtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmdldEF0dGFjaGVkRmlsZXMgPSBmdW5jdGlvbiAoZWxlbWVudElkLCBhcHBsaWNhdGlvbk9yaWdpbikge1xuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY2xlYW5lciBwYXJhbXMgaGFuZGxpbmcgdG8gcGFzcyB0byBodHRwIGNhbGxcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L3NlYXJjaCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnYXBwbGljYXRpb25PcmlnaW4nOiB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5hdHRhY2hGaWxlID0gZnVuY3Rpb24gKGVsZW1lbnRJZCwgYXBwbGljYXRpb25PcmlnaW4sIGZpbGVUb1VwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVUb1VwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLndhcm4oJ1tmaWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZV0gZmlsZSBpcyBlbXB0eSwgYWJvcnRpbmcgdXBsb2FkLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQTogd2Ugc2hvdWxkIHJlbHkgb24gYSBzdHJvbmdlciBodHRwLXdyYXBwZXIgdG8gaGFuZGxlIHVwbG9hZCB0aGlzIHdheVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5VcGxvYWQuYmFzZTY0RGF0YVVybChmaWxlVG9VcGxvYWQpLnRoZW4oZnVuY3Rpb24gKGZpbGVCYXNlNjRVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5odHRwV3JhcHBlclNlcnZpY2UucG9zdCgnZmlsZS1hdHRhY2htZW50L3B1dCcsIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBtb2RlbCBmb3IgQXR0YWNoRmlsZUR0byAmIEZpbGVVcGxvYWRCYXNlRHRvXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0VsZW1lbnRJZCc6IGVsZW1lbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQXBwbGljYXRpb25PcmlnaW4nOiBfdGhpcy5hcHBsaWNhdGlvbk9yaWdpbkVudW1bYXBwbGljYXRpb25PcmlnaW5dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlVXBsb2FkQmFzZUR0byc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVOYW1lJzogZmlsZVRvVXBsb2FkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlQmFzZTY0VXJsJzogZmlsZUJhc2U2NFVybC5zbGljZShmaWxlQmFzZTY0VXJsLmluZGV4T2YoJ2Jhc2U2NCwnKSArICdiYXNlNjQsJy5sZW5ndGgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudFR5cGUnOiBmaWxlVG9VcGxvYWQudHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbkJhc2U2NEpzb246IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZG93bmxvYWRBdHRhY2hlZEZpbGUgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnQsIGZpbGVPcmlnaW4sIGFuY2hvckVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQgfHwgIWZpbGVBdHRhY2htZW50LkZpbGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ1tmaWxlQXR0YWNobWVudF0gbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhbmNob3JFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ1thbmNob3JFbGVtZW50XSBtYW5kYXRvcnkuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZ2V0KCdmaWxlLWF0dGFjaG1lbnQvZG93bmxvYWQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgJ2ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudC5JZCwgJ2ZpbGVPcmlnaW4nOiB0aGlzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtmaWxlT3JpZ2luXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgZmlsZXdpdGhCT00gPSAnXFx1RkVGRicrIGZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO3V0Zi04JyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PXdpbmRvd3MtMTI1MicgfSk7IC8vVE9ETyBNR0E6IHR5cGUgPz8/IGhvdyB0byByZXRyaWV2ZSBjb250ZW50LXR5cGUgZnJvbSBibG9iXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdpbWFnZS9wbmc7Y2hhcnNldD1JU08tODg1OS0xJyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZycgfSk7IC8vVE9ETyBNR0E6IHR5cGUgPz8/IGhvdyB0byByZXRyaWV2ZSBjb250ZW50LXR5cGUgZnJvbSBibG9iXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5GaWxlU2F2ZXIuc2F2ZUFzKGJsb2IsIGZpbGVBdHRhY2htZW50LkZpbGVOYW1lIHx8ICd1bmtub3duLmJpbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLy8vVE9ETyBNR0E6IGRlbGF5IHRvIHRvIGJlIG91dHNpZGUgb2YgY3VycmVudCBkaWdlc3QgY3ljbGUgOiBob3cgdG8gZml4ID9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcy4kdGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBhbmNob3JFbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBcImhyZWZcIjogdXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBcImRvd25sb2FkXCI6ICd1bmtub3duLnBuZydcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgLy9cImRvd25sb2FkXCI6IGZpbGVBdHRhY2htZW50TmFtZSB8fCAndW5rbm93bi5iaW4nXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAvLy5odG1sKCQoXCJhXCIpLmF0dHIoXCJkb3dubG9hZFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAuZ2V0KDApLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLy8gVE9ETyBNR0EgOiBoYWNrIHRvIHRyaWdnZXIgZG93bmxvYWQgb2YgZmlsZSBmcm9tIEpTLCB0byByZWZhY3RvciBpbiBhIGRpcmVjdGl2ZSArIHNlZSBKcXVlcnkgbGltaXRhdGlvbnMgb2YgY2xpY2sgZXZlbnQgOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE3MzExNjQ1L2Rvd25sb2FkLWltYWdlLXdpdGgtamF2YXNjcmlwdCBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5wcm9wKCdocmVmJywgdXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5wcm9wKCdkb3dubG9hZCcsIGZpbGVBdHRhY2htZW50TmFtZSB8fCAndW5rbm93bi5iaW4nKTsgLy9UT0RPIE1HQSA/Pz9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5nZXQoMCkuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FuY2hvckVsZW1lbnQuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGRlZCBhIHNtYWxsIGRlbGF5IGJlY2F1c2UgZmlsZSB3YXMgcmVtb3ZlZCB0byBxdWlja2x5IGluIGZpcmVmb3ggYW5kIHRoZSBkb3dubG9hZCB3YXMgZXZlbiBub3QgaW5pdGlhbGl6ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0ZW1wIGVsZW1lbnQgZnJvbSBicm93c2VyIGNhY2hlIDogVE9ETyBNR0EgZmluZCBhIHdheSB0byBkbyB0aGlzIGluIGEgZmluYWxseSgpIGNsYXVzZSBpbiB0aGUgc2VydmljZSBtZXRob2QgP1xuICAgICAgICAgICAgICAgICAgICAgICAgLy93aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy99LCAxMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZGVsZXRlQXR0YWNoZWRGaWxlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50SWQsIGZpbGVPcmlnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmRlbGV0ZSgnZmlsZS1hdHRhY2htZW50L2RlbGV0ZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50SWQsICdmaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5lZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50ID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50SWQsIGZpbGVPcmlnaW4sIHVwZGF0ZWRDb21tZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5wb3N0KCdmaWxlLWF0dGFjaG1lbnQvdXBkYXRlLWNvbW1lbnQnLCBcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBEdG8gY2xpZW50LXNpZGUgb3IgdXBkYXRlIGVuZHBvaW50IHNydi1zaWRlIHRvIHN1cHBvcnQgcGFydC1wYXJhbXMgdXJsICsgY29tbWVudCBhcyBwYXlsb2FkIChjbGVhbmVyIFNPQykuXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlT3JpZ2luJzogdGhpcy5maWxlQXR0YWNobWVudE9yaWdpbkVudW1bZmlsZU9yaWdpbl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29tbWVudCc6IHVwZGF0ZWRDb21tZW50XG4gICAgICAgICAgICAgICAgICAgIH0sIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmdldFN1cHBvcnRlZE1pbWVUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L2F1dGhvcml6ZWQtbWltZS10eXBlcycsIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmdldEN1cnJlbnRVc2VyVXBsb2FkUmlnaHRzID0gZnVuY3Rpb24gKGVsZW1lbnRJZCwgYXBwbGljYXRpb25PcmlnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L2dldC1jdXJyZW50LXVzZXItdXBsb2FkLXJpZ2h0cycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnYXBwbGljYXRpb25PcmlnaW4nOiB0aGlzLmFwcGxpY2F0aW9uT3JpZ2luRW51bVthcHBsaWNhdGlvbk9yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsgcmV0dXJuIHJlc3BvbnNlLmJvb2xlYW5SZXNwb25zZTsgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRTZXJ2aWNlO1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIHNlcnZpY2VzLkZpbGVBdHRhY2htZW50U2VydmljZSA9IEZpbGVBdHRhY2htZW50U2VydmljZTtcbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LmNvcmUuc2VydmljZXMuZmlsZUF0dGFjaG1lbnQnLCBbXG4gICAgICAgICAgICAgICAgJ25nLmh0dHBXcmFwcGVyJyxcbiAgICAgICAgICAgICAgICAnbmdGaWxlVXBsb2FkJyxcbiAgICAgICAgICAgICAgICAnbmdGaWxlU2F2ZXInLFxuICAgICAgICAgICAgICAgICdibHVlc2t5LmNvcmUubW9kZWxzLmZpbGVBdHRhY2htZW50T3JpZ2luRW51bScsXG4gICAgICAgICAgICAgICAgJ2JsdWVza3kuY29yZS5tb2RlbHMuYXBwbGljYXRpb25PcmlnaW5FbnVtJ1xuICAgICAgICAgICAgXSkuc2VydmljZSgnZmlsZUF0dGFjaG1lbnRTZXJ2aWNlJywgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlKTtcbiAgICAgICAgfSkoc2VydmljZXMgPSBjb3JlLnNlcnZpY2VzIHx8IChjb3JlLnNlcnZpY2VzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
