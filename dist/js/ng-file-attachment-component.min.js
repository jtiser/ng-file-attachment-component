var bluesky;!function(t){var e;!function(e){var i;!function(e){var i=t.core.models.FileAttachmentOriginEnum,n=function(){function t(t,e,i,n,r,o){this.httpWrapperService=t,this.$log=e,this.$timeout=i,this.Upload=n,this.Blob=r,this.FileSaver=o}return t.$inject=["httpWrapperService","$log","$timeout","Upload","Blob","FileSaver"],t.prototype.getAttachedFiles=function(t,e){return this.httpWrapperService.get("file-attachment/search",{params:{elementId:t,origin:i[e]},apiEndpoint:!0})},t.prototype.downloadAttachedFile=function(t,e,n){var r=this;return t&&t.Id&&t.FileName?n?this.httpWrapperService.get("file-attachment/download",{params:{fileAttachmentId:t.Id,origin:i[e]},apiEndpoint:!0}).then(function(e){var i=new Blob([e],{type:"application/octet-stream;utf-8"});r.FileSaver.saveAs(i,t.FileName||"unknown.bin")}):(this.$log.error("[anchorElement] mandatory."),null):(this.$log.error("[fileAttachment] mandatory."),null)},t.prototype.deleteAttachedFile=function(t,e){return this.httpWrapperService["delete"]("file-attachment/delete",{params:{fileAttachmentId:t,origin:i[e]},apiEndpoint:!0})},t.prototype.attachFile=function(t,e,n){var r=this;return n?this.Upload.base64DataUrl(n).then(function(o){return r.httpWrapperService.post("file-attachment/put",{ElementId:t,Origin:i[e],FileUploadBaseDto:{FileName:n.name,FileBase64Url:o.slice(o.indexOf("base64,")+"base64,".length),ContentType:n.type}},{apiEndpoint:!0,uploadInBase64Json:!0})}):(this.$log.warn("[fileAttachmentService.attachFile] file is empty, aborting upload."),null)},t.prototype.editFileAttachmentComment=function(t,e,n){return this.httpWrapperService.post("file-attachment/update-comment",{FileAttachmentId:t,Origin:i[e],Comment:n},{apiEndpoint:!0})},t}();e.FileAttachmentService=n,angular.module("bluesky.quoteWizard.services.fileAttachment",["ng.httpWrapper","ngFileUpload","ngFileSaver"]).service("fileAttachmentService",n)}(i=e.services||(e.services={}))}(e=t.core||(t.core={}))}(bluesky||(bluesky={}));var bluesky;!function(t){var e;!function(e){var i;!function(e){var i=t.core.models.FileAttachmentOriginEnum,n=function(){function t(t,e,n){return this.$log=t,this.toaster=e,this.fileAttachmentService=n,this.fileAttachmentDownloadLinkElementId="file-attachment-download-link",this.elementIdBinding?i[this.originBinding]?(this.httpPromises=new Array,this.getAttachedFiles(),void(this.nbOfItemsPerPage=10)):void this.$log.error("parameter {originBinding} is mandatory."):void this.$log.error("parameter {elementIdBinding} is mandatory.")}return t.$inject=["$log","toaster","fileAttachmentService"],t.prototype.getAttachedFiles=function(){var t=this,e=this.fileAttachmentService.getAttachedFiles(this.elementIdBinding,this.originBinding).then(function(e){t.attachedFileList=e,t.attachedFileListSource=e});this.httpPromises.push(e)},t.prototype.downloadAttachedFile=function(t){if(t&&t.Id){var e=$("#"+this.fileAttachmentDownloadLinkElementId),i=this.fileAttachmentService.downloadAttachedFile(t,this.originBinding,e).then(function(){});this.httpPromises.push(i)}},t.prototype.deleteAttachedFile=function(t){var e=this;if(t&&t.Id){var i=this.fileAttachmentService.deleteAttachedFile(t.Id,this.originBinding).then(function(){e.toaster.success("File ("+t.FileName+") successfully deleted."),e.getAttachedFiles()});this.httpPromises.push(i)}},t.prototype.updateFileAttachmentComment=function(t,e){if(t&&t.Id&&e){var i=this.fileAttachmentService.editFileAttachmentComment(t.Id,this.originBinding,e).then(function(){});this.httpPromises.push(i)}},t.prototype.fileSelected=function(t,e){var i=this;if(t){var n=this.fileAttachmentService.attachFile(this.elementIdBinding,this.originBinding,t).then(function(){i.toaster.success("File ("+t.name+") successfully uploaded."),i.getAttachedFiles()});this.httpPromises.push(n)}},t.prototype.openSelectFileDialog=function(){$("#input-file-select-field").click()},t.prototype.isSelectFileBtnDisabled=function(){return!1},t}();e.FileAttachmentComponentController=n;var r=function(){function t(){this.bindings={elementIdBinding:"=",originBinding:"="},this.controller=n,this.controllerAs="vm",this.templateUrl="component/file-attachment.tpl.html"}return t}();e.FileAttachmentComponent=r,angular.module("bluesky.quoteWizard.components.fileAttachment",["cgBusy","smart-table","toaster","file-attachment-component-tpl","bluesky.quoteWizard.services.fileAttachment"]).value("cgBusyDefaults",{templateUrl:"templates/angular-busy/angular-busy-custom.tpl.html"}).component("fileAttachmentComponent",new r)}(i=e.components||(e.components={}))}(e=t.core||(t.core={}))}(bluesky||(bluesky={}));var bluesky;!function(t){var e;!function(t){var e;!function(t){!function(t){t[t.QuoteWizardFileAttachment=0]="QuoteWizardFileAttachment",t[t.OrderEntryCustomDetails=1]="OrderEntryCustomDetails",t[t.OrderEntryAudioCustomDetail=2]="OrderEntryAudioCustomDetail",t[t.OrderTrackingFileAttachment=3]="OrderTrackingFileAttachment"}(t.FileAttachmentOriginEnum||(t.FileAttachmentOriginEnum={}));t.FileAttachmentOriginEnum}(e=t.models||(t.models={}))}(e=t.core||(t.core={}))}(bluesky||(bluesky={}));var bluesky;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t,e,i,n,r,o){this.Id=t,this.FileName=e,this.Comment=i,this.UploadedBy=n,this.CreationDate=r,this.Origin=o}return t}();t.FileAttachment=e}(e=t.models||(t.models={}))}(e=t.core||(t.core={}))}(bluesky||(bluesky={}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2UvZmlsZS1hdHRhY2htZW50LnNlcnZpY2UudHMiLCJuZy1maWxlLWF0dGFjaG1lbnQtY29tcG9uZW50LmpzIiwiY29tcG9uZW50L2ZpbGUtYXR0YWNobWVudC5jb21wb25lbnQudHMiLCJtb2RlbHMvZmlsZS1hdHRhY2htZW50LW9yaWdpbi5lbnVtLnRzIiwibW9kZWxzL2ZpbGUtYXR0YWNobWVudC5tb2RlbC50cyJdLCJuYW1lcyI6WyJibHVlc2t5IiwiY29yZSIsInNlcnZpY2VzIiwiRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtIiwibW9kZWxzIiwiRmlsZUF0dGFjaG1lbnRTZXJ2aWNlIiwiaHR0cFdyYXBwZXJTZXJ2aWNlIiwiJGxvZyIsIiR0aW1lb3V0IiwiVXBsb2FkIiwiQmxvYiIsIkZpbGVTYXZlciIsInRoaXMiLCIkaW5qZWN0IiwicHJvdG90eXBlIiwiZ2V0QXR0YWNoZWRGaWxlcyIsImVsZW1lbnRJZCIsIm9yaWdpbiIsImdldCIsInBhcmFtcyIsImFwaUVuZHBvaW50IiwiZG93bmxvYWRBdHRhY2hlZEZpbGUiLCJmaWxlQXR0YWNobWVudCIsImFuY2hvckVsZW1lbnQiLCJfdGhpcyIsIklkIiwiRmlsZU5hbWUiLCJmaWxlQXR0YWNobWVudElkIiwidGhlbiIsImZpbGUiLCJibG9iIiwidHlwZSIsInNhdmVBcyIsImVycm9yIiwiZGVsZXRlQXR0YWNoZWRGaWxlIiwiYXR0YWNoRmlsZSIsImZpbGVUb1VwbG9hZCIsImJhc2U2NERhdGFVcmwiLCJmaWxlQmFzZTY0VXJsIiwicG9zdCIsIkVsZW1lbnRJZCIsIk9yaWdpbiIsIkZpbGVVcGxvYWRCYXNlRHRvIiwibmFtZSIsIkZpbGVCYXNlNjRVcmwiLCJzbGljZSIsImluZGV4T2YiLCJsZW5ndGgiLCJDb250ZW50VHlwZSIsInVwbG9hZEluQmFzZTY0SnNvbiIsIndhcm4iLCJlZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50IiwidXBkYXRlZENvbW1lbnQiLCJGaWxlQXR0YWNobWVudElkIiwiQ29tbWVudCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJzZXJ2aWNlIiwiY29tcG9uZW50cyIsIkZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciIsInRvYXN0ZXIiLCJmaWxlQXR0YWNobWVudFNlcnZpY2UiLCJmaWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZCIsImVsZW1lbnRJZEJpbmRpbmciLCJvcmlnaW5CaW5kaW5nIiwiaHR0cFByb21pc2VzIiwiQXJyYXkiLCJuYk9mSXRlbXNQZXJQYWdlIiwiaHR0cFByb21pc2UiLCJmaWxlQXR0YWNobWVudExpc3QiLCJhdHRhY2hlZEZpbGVMaXN0IiwiYXR0YWNoZWRGaWxlTGlzdFNvdXJjZSIsInB1c2giLCJqUXVlcnlBbmNob3JFbGVtZW50IiwiJCIsInN1Y2Nlc3MiLCJ1cGRhdGVGaWxlQXR0YWNobWVudENvbW1lbnQiLCJmaWxlU2VsZWN0ZWQiLCJldmVudCIsIm9wZW5TZWxlY3RGaWxlRGlhbG9nIiwiY2xpY2siLCJpc1NlbGVjdEZpbGVCdG5EaXNhYmxlZCIsIkZpbGVBdHRhY2htZW50Q29tcG9uZW50IiwiYmluZGluZ3MiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwidGVtcGxhdGVVcmwiLCJ2YWx1ZSIsImNvbXBvbmVudCIsIkZpbGVBdHRhY2htZW50IiwiVXBsb2FkZWRCeSIsIkNyZWF0aW9uRGF0ZSJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBVUEsVUFBVixTQUFVQSxHQUFRLEdBQUFDLElBQUEsU0FBQUEsR0FBSyxHQUFBQyxJQUFBLFNBQUFBLEdBR25CLEdBQU9DLEdBQTJCSCxFQUFRQyxLQUFLRyxPQUFPRCx5QkFldERFLEVBQUEsV0FHSSxRQUFBQSxHQUNZQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxHQUxBQyxLQUFBTixtQkFBQUEsRUFDQU0sS0FBQUwsS0FBQUEsRUFDQUssS0FBQUosU0FBQUEsRUFDQUksS0FBQUgsT0FBQUEsRUFDQUcsS0FBQUYsS0FBQUEsRUFDQUUsS0FBQUQsVUFBQUEs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LEdBQVEsR0FBQUMsSUFBQSxTQUFBQSxHQUFLLEdBQUFHLElBQUEsU0FBQUEsR0FLbkIsR0FBQXFGLEdBQUEsV0FDSSxRQUFBQSxHQUNXaEUsRUFDQUMsRUFDQTRCLEVBQ0FvQyxFQUNBQyxFQUNBbEQsR0FMQTdCLEtBQUFhLEdBQUFBLEVBQ0FiLEtBQUFjLFNBQUFBLEVBQ0FkLEtBQUEwQyxRQUFBQSxFQUNBMUMsS0FBQThFLFdBQUFBLEVBQ0E5RSxLQUFBK0UsYUFBQUEsRUFDQS9FLEtBQUE2QixPQUFBQSxFQUVmLE1BQUFnRCxLQVRhckYsR0FBQXFGLGVBQWNBLEdBTFJyRixFQUFBSCxFQUFBRyxTQUFBSCxFQUFBRyxhQUFMSCxFQUFBRCxFQUFBQyxPQUFBRCxFQUFBQyxXQUFSRCxVQUFBQSIsImZpbGUiOiJuZy1maWxlLWF0dGFjaG1lbnQtY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsibmFtZXNwYWNlIGJsdWVza3kuY29yZS5zZXJ2aWNlcyB7XHJcblxyXG4gICAgaW1wb3J0IEZpbGVBdHRhY2htZW50ID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudDtcclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWxlQXR0YWNobWVudFNlcnZpY2Uge1xyXG5cclxuICAgICAgICBnZXRBdHRhY2hlZEZpbGVzKGVsZW1lbnRJZDogbnVtYmVyLCBvcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSk6IG5nLklQcm9taXNlPEFycmF5PEZpbGVBdHRhY2htZW50Pj47XHJcblxyXG4gICAgICAgIGF0dGFjaEZpbGUoZWxlbWVudElkOiBudW1iZXIsIG9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCBmaWxlVG9VcGxvYWQ6IEZpbGUpOiBuZy5JUHJvbWlzZTxhbnk+O1xyXG5cclxuICAgICAgICBkb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQsIG9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCBhbmNob3JFbGVtZW50OiBKUXVlcnkpOiBuZy5JUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgICAgICAgZGVsZXRlQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50SWQ6IG51bWJlciwgb3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgICAgICAgZWRpdEZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudElkOiBudW1iZXIsIG9yaWdpbjogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtLCB1cGRhdGVkQ29tbWVudDogc3RyaW5nKTogbmcuSVByb21pc2U8dm9pZD47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbGVBdHRhY2htZW50U2VydmljZSBpbXBsZW1lbnRzIElGaWxlQXR0YWNobWVudFNlcnZpY2Uge1xyXG5cclxuICAgICAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgcHJpdmF0ZSBodHRwV3JhcHBlclNlcnZpY2U6IElIdHRwV3JhcHBlclNlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgJGxvZzogbmcuSUxvZ1NlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgJHRpbWVvdXQ6IG5nLklUaW1lb3V0U2VydmljZSxcclxuICAgICAgICAgICAgcHJpdmF0ZSBVcGxvYWQ6IG5nLmFuZ3VsYXJGaWxlVXBsb2FkLklVcGxvYWRTZXJ2aWNlLFxyXG4gICAgICAgICAgICBwcml2YXRlIEJsb2I6IGFueSwgLy9UT0RPIE1HQTogdHlwaW5ncyA/XHJcbiAgICAgICAgICAgIHByaXZhdGUgRmlsZVNhdmVyOiBhbnkgLy9UT0RPIE1HQTogdHlwaW5ncyA/XHJcbiAgICAgICAgKSB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0QXR0YWNoZWRGaWxlcyhlbGVtZW50SWQ6IG51bWJlciwgb3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTxBcnJheTxGaWxlQXR0YWNobWVudD4+IHtcclxuICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNsZWFuZXIgcGFyYW1zIGhhbmRsaW5nIHRvIHBhc3MgdG8gaHR0cCBjYWxsXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5nZXQ8QXJyYXk8RmlsZUF0dGFjaG1lbnQ+PignZmlsZS1hdHRhY2htZW50L3NlYXJjaCcsIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnb3JpZ2luJzogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0gfSxcclxuICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50LCBvcmlnaW46IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bSwgYW5jaG9yRWxlbWVudDogSlF1ZXJ5KTogbmcuSVByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50IHx8ICFmaWxlQXR0YWNobWVudC5JZCB8fCAhZmlsZUF0dGFjaG1lbnQuRmlsZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcignW2ZpbGVBdHRhY2htZW50XSBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFhbmNob3JFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ1thbmNob3JFbGVtZW50XSBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldDxGaWxlPignZmlsZS1hdHRhY2htZW50L2Rvd25sb2FkJywge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdmaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnQuSWQsICdvcmlnaW4nOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bb3JpZ2luXSB9LFxyXG4gICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcclxuICAgICAgICAgICAgfSkudGhlbjx2b2lkPigoZmlsZTogRmlsZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy92YXIgZmlsZXdpdGhCT00gPSAnXFx1RkVGRicrIGZpbGU7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO3V0Zi04JyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcclxuICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PXdpbmRvd3MtMTI1MicgfSk7IC8vVE9ETyBNR0E6IHR5cGUgPz8/IGhvdyB0byByZXRyaWV2ZSBjb250ZW50LXR5cGUgZnJvbSBibG9iXHJcbiAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdpbWFnZS9wbmc7Y2hhcnNldD1JU08tODg1OS0xJyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcclxuICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZycgfSk7IC8vVE9ETyBNR0E6IHR5cGUgPz8/IGhvdyB0byByZXRyaWV2ZSBjb250ZW50LXR5cGUgZnJvbSBibG9iXHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5GaWxlU2F2ZXIuc2F2ZUFzKGJsb2IsIGZpbGVBdHRhY2htZW50LkZpbGVOYW1lIHx8ICd1bmtub3duLmJpbicpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vLy9UT0RPIE1HQTogZGVsYXkgdG8gdG8gYmUgb3V0c2lkZSBvZiBjdXJyZW50IGRpZ2VzdCBjeWNsZSA6IGhvdyB0byBmaXggP1xyXG4gICAgICAgICAgICAgICAgLy90aGlzLiR0aW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vICAgIGFuY2hvckVsZW1lbnRcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAuYXR0cih7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIFwiaHJlZlwiOiB1cmwsXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIFwiZG93bmxvYWRcIjogJ3Vua25vd24ucG5nJ1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAvL1wiZG93bmxvYWRcIjogZmlsZUF0dGFjaG1lbnROYW1lIHx8ICd1bmtub3duLmJpbidcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIC8vLmh0bWwoJChcImFcIikuYXR0cihcImRvd25sb2FkXCIpKVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIC5nZXQoMCkuY2xpY2soKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgLy8gVE9ETyBNR0EgOiBoYWNrIHRvIHRyaWdnZXIgZG93bmxvYWQgb2YgZmlsZSBmcm9tIEpTLCB0byByZWZhY3RvciBpbiBhIGRpcmVjdGl2ZSArIHNlZSBKcXVlcnkgbGltaXRhdGlvbnMgb2YgY2xpY2sgZXZlbnQgOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE3MzExNjQ1L2Rvd25sb2FkLWltYWdlLXdpdGgtamF2YXNjcmlwdCBcclxuICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5wcm9wKCdocmVmJywgdXJsKTtcclxuICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5wcm9wKCdkb3dubG9hZCcsIGZpbGVBdHRhY2htZW50TmFtZSB8fCAndW5rbm93bi5iaW4nKTsgLy9UT0RPIE1HQSA/Pz9cclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAvL2FuY2hvckVsZW1lbnQuZ2V0KDApLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAvL30sIDApO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAvL2FuY2hvckVsZW1lbnQuY2xpY2soKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3NldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gQWRkZWQgYSBzbWFsbCBkZWxheSBiZWNhdXNlIGZpbGUgd2FzIHJlbW92ZWQgdG8gcXVpY2tseSBpbiBmaXJlZm94IGFuZCB0aGUgZG93bmxvYWQgd2FzIGV2ZW4gbm90IGluaXRpYWxpemVkXHJcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGVtcCBlbGVtZW50IGZyb20gYnJvd3NlciBjYWNoZSA6IFRPRE8gTUdBIGZpbmQgYSB3YXkgdG8gZG8gdGhpcyBpbiBhIGZpbmFsbHkoKSBjbGF1c2UgaW4gdGhlIHNlcnZpY2UgbWV0aG9kID9cclxuICAgICAgICAgICAgICAgIC8vd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcclxuICAgICAgICAgICAgICAgIC8vfSwgMTAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGVsZXRlQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50SWQ6IG51bWJlciwgb3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pOiBuZy5JUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5kZWxldGU8dm9pZD4oJ2ZpbGUtYXR0YWNobWVudC9kZWxldGUnLCB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgJ2ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLCAnb3JpZ2luJzogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0gfSxcclxuICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXR0YWNoRmlsZShlbGVtZW50SWQ6IG51bWJlciwgb3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIGZpbGVUb1VwbG9hZDogRmlsZSk6IG5nLklQcm9taXNlPGFueT4ge1xyXG4gICAgICAgICAgICBpZiAoIWZpbGVUb1VwbG9hZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kbG9nLndhcm4oJ1tmaWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZV0gZmlsZSBpcyBlbXB0eSwgYWJvcnRpbmcgdXBsb2FkLicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vVE9ETyBNR0E6IHdlIHNob3VsZCByZWx5IG9uIGEgc3Ryb25nZXIgaHR0cC13cmFwcGVyIHRvIGhhbmRsZSB1cGxvYWQgdGhpcyB3YXlcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuVXBsb2FkLmJhc2U2NERhdGFVcmwoZmlsZVRvVXBsb2FkKS50aGVuKChmaWxlQmFzZTY0VXJsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UucG9zdDxhbnk+KCdmaWxlLWF0dGFjaG1lbnQvcHV0JyxcclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY3JlYXRlIG1vZGVsIGZvciBBdHRhY2hGaWxlRHRvICYgRmlsZVVwbG9hZEJhc2VEdG9cclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdFbGVtZW50SWQnOiBlbGVtZW50SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdPcmlnaW4nOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bb3JpZ2luXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVVcGxvYWRCYXNlRHRvJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbGVOYW1lJzogZmlsZVRvVXBsb2FkLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRmlsZUJhc2U2NFVybCc6IGZpbGVCYXNlNjRVcmwuc2xpY2UoZmlsZUJhc2U2NFVybC5pbmRleE9mKCdiYXNlNjQsJykgKyAnYmFzZTY0LCcubGVuZ3RoKSwgLy9zdHJpcCB0aGUgZGF0YVVyaSBwYXJ0IG9mIHRoZSBiYXNlNjQgZW5jb2RpbmcgdG8gb25seSBrZWVwIGJhc2U2NCByYXcgZGF0YS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50VHlwZSc6IGZpbGVUb1VwbG9hZC50eXBlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRJbkJhc2U2NEpzb246IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBlZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50KGZpbGVBdHRhY2htZW50SWQ6IG51bWJlciwgb3JpZ2luOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0sIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcpOiBuZy5JUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHBXcmFwcGVyU2VydmljZS5wb3N0PHZvaWQ+KCdmaWxlLWF0dGFjaG1lbnQvdXBkYXRlLWNvbW1lbnQnLFxyXG4gICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGNyZWF0ZSBEdG8gY2xpZW50LXNpZGUgb3IgdXBkYXRlIGVuZHBvaW50IHNydi1zaWRlIHRvIHN1cHBvcnQgcGFydC1wYXJhbXMgdXJsICsgY29tbWVudCBhcyBwYXlsb2FkIChjbGVhbmVyIFNPQykuXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0ZpbGVBdHRhY2htZW50SWQnOiBmaWxlQXR0YWNobWVudElkLFxyXG4gICAgICAgICAgICAgICAgICAgICdPcmlnaW4nOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bb3JpZ2luXSxcclxuICAgICAgICAgICAgICAgICAgICAnQ29tbWVudCc6IHVwZGF0ZWRDb21tZW50XHJcbiAgICAgICAgICAgICAgICB9LCB7IGFwaUVuZHBvaW50OiB0cnVlIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5xdW90ZVdpemFyZC5zZXJ2aWNlcy5maWxlQXR0YWNobWVudCcsIFsnbmcuaHR0cFdyYXBwZXInLCAnbmdGaWxlVXBsb2FkJywgJ25nRmlsZVNhdmVyJ10pXHJcbiAgICAgICAgICAgLnNlcnZpY2UoJ2ZpbGVBdHRhY2htZW50U2VydmljZScsIEZpbGVBdHRhY2htZW50U2VydmljZSk7XHJcbn0iLCJ2YXIgYmx1ZXNreTtcbihmdW5jdGlvbiAoYmx1ZXNreSkge1xuICAgIHZhciBjb3JlO1xuICAgIChmdW5jdGlvbiAoY29yZSkge1xuICAgICAgICB2YXIgc2VydmljZXM7XG4gICAgICAgIChmdW5jdGlvbiAoc2VydmljZXMpIHtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudFNlcnZpY2UgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8qIEBuZ0luamVjdCAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEZpbGVBdHRhY2htZW50U2VydmljZShodHRwV3JhcHBlclNlcnZpY2UsICRsb2csICR0aW1lb3V0LCBVcGxvYWQsIEJsb2IsIC8vVE9ETyBNR0E6IHR5cGluZ3MgP1xuICAgICAgICAgICAgICAgICAgICBGaWxlU2F2ZXIgLy9UT0RPIE1HQTogdHlwaW5ncyA/XG4gICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBXcmFwcGVyU2VydmljZSA9IGh0dHBXcmFwcGVyU2VydmljZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nID0gJGxvZztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGltZW91dCA9ICR0aW1lb3V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLlVwbG9hZCA9IFVwbG9hZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5CbG9iID0gQmxvYjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5GaWxlU2F2ZXIgPSBGaWxlU2F2ZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZ2V0QXR0YWNoZWRGaWxlcyA9IGZ1bmN0aW9uIChlbGVtZW50SWQsIG9yaWdpbikge1xuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY2xlYW5lciBwYXJhbXMgaGFuZGxpbmcgdG8gcGFzcyB0byBodHRwIGNhbGxcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L3NlYXJjaCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyAnZWxlbWVudElkJzogZWxlbWVudElkLCAnb3JpZ2luJzogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlLnByb3RvdHlwZS5kb3dubG9hZEF0dGFjaGVkRmlsZSA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCwgb3JpZ2luLCBhbmNob3JFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkIHx8ICFmaWxlQXR0YWNobWVudC5GaWxlTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdbZmlsZUF0dGFjaG1lbnRdIG1hbmRhdG9yeS4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghYW5jaG9yRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmVycm9yKCdbYW5jaG9yRWxlbWVudF0gbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFdyYXBwZXJTZXJ2aWNlLmdldCgnZmlsZS1hdHRhY2htZW50L2Rvd25sb2FkJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdmaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnQuSWQsICdvcmlnaW4nOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bb3JpZ2luXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgZmlsZXdpdGhCT00gPSAnXFx1RkVGRicrIGZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO3V0Zi04JyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZztjaGFyc2V0PXdpbmRvd3MtMTI1MicgfSk7IC8vVE9ETyBNR0E6IHR5cGUgPz8/IGhvdyB0byByZXRyaWV2ZSBjb250ZW50LXR5cGUgZnJvbSBibG9iXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBibG9iID0gbmV3IEJsb2IoW2ZpbGVdLCB7IHR5cGU6ICdpbWFnZS9wbmc7Y2hhcnNldD1JU08tODg1OS0xJyB9KTsgLy9UT0RPIE1HQTogdHlwZSA/Pz8gaG93IHRvIHJldHJpZXZlIGNvbnRlbnQtdHlwZSBmcm9tIGJsb2JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGJsb2IgPSBuZXcgQmxvYihbZmlsZV0sIHsgdHlwZTogJ2ltYWdlL3BuZycgfSk7IC8vVE9ETyBNR0E6IHR5cGUgPz8/IGhvdyB0byByZXRyaWV2ZSBjb250ZW50LXR5cGUgZnJvbSBibG9iXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5GaWxlU2F2ZXIuc2F2ZUFzKGJsb2IsIGZpbGVBdHRhY2htZW50LkZpbGVOYW1lIHx8ICd1bmtub3duLmJpbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLy8vVE9ETyBNR0E6IGRlbGF5IHRvIHRvIGJlIG91dHNpZGUgb2YgY3VycmVudCBkaWdlc3QgY3ljbGUgOiBob3cgdG8gZml4ID9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcy4kdGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBhbmNob3JFbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBcImhyZWZcIjogdXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBcImRvd25sb2FkXCI6ICd1bmtub3duLnBuZydcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgLy9cImRvd25sb2FkXCI6IGZpbGVBdHRhY2htZW50TmFtZSB8fCAndW5rbm93bi5iaW4nXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAvLy5odG1sKCQoXCJhXCIpLmF0dHIoXCJkb3dubG9hZFwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAuZ2V0KDApLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLy8gVE9ETyBNR0EgOiBoYWNrIHRvIHRyaWdnZXIgZG93bmxvYWQgb2YgZmlsZSBmcm9tIEpTLCB0byByZWZhY3RvciBpbiBhIGRpcmVjdGl2ZSArIHNlZSBKcXVlcnkgbGltaXRhdGlvbnMgb2YgY2xpY2sgZXZlbnQgOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE3MzExNjQ1L2Rvd25sb2FkLWltYWdlLXdpdGgtamF2YXNjcmlwdCBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5wcm9wKCdocmVmJywgdXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5wcm9wKCdkb3dubG9hZCcsIGZpbGVBdHRhY2htZW50TmFtZSB8fCAndW5rbm93bi5iaW4nKTsgLy9UT0RPIE1HQSA/Pz9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIC8vYW5jaG9yRWxlbWVudC5nZXQoMCkuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FuY2hvckVsZW1lbnQuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGRlZCBhIHNtYWxsIGRlbGF5IGJlY2F1c2UgZmlsZSB3YXMgcmVtb3ZlZCB0byBxdWlja2x5IGluIGZpcmVmb3ggYW5kIHRoZSBkb3dubG9hZCB3YXMgZXZlbiBub3QgaW5pdGlhbGl6ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0ZW1wIGVsZW1lbnQgZnJvbSBicm93c2VyIGNhY2hlIDogVE9ETyBNR0EgZmluZCBhIHdheSB0byBkbyB0aGlzIGluIGEgZmluYWxseSgpIGNsYXVzZSBpbiB0aGUgc2VydmljZSBtZXRob2QgP1xuICAgICAgICAgICAgICAgICAgICAgICAgLy93aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy99LCAxMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuZGVsZXRlQXR0YWNoZWRGaWxlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50SWQsIG9yaWdpbikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UuZGVsZXRlKCdmaWxlLWF0dGFjaG1lbnQvZGVsZXRlJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7ICdmaWxlQXR0YWNobWVudElkJzogZmlsZUF0dGFjaG1lbnRJZCwgJ29yaWdpbic6IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtvcmlnaW5dIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhcGlFbmRwb2ludDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50U2VydmljZS5wcm90b3R5cGUuYXR0YWNoRmlsZSA9IGZ1bmN0aW9uIChlbGVtZW50SWQsIG9yaWdpbiwgZmlsZVRvVXBsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZVRvVXBsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cud2FybignW2ZpbGVBdHRhY2htZW50U2VydmljZS5hdHRhY2hGaWxlXSBmaWxlIGlzIGVtcHR5LCBhYm9ydGluZyB1cGxvYWQuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBOiB3ZSBzaG91bGQgcmVseSBvbiBhIHN0cm9uZ2VyIGh0dHAtd3JhcHBlciB0byBoYW5kbGUgdXBsb2FkIHRoaXMgd2F5XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlVwbG9hZC5iYXNlNjREYXRhVXJsKGZpbGVUb1VwbG9hZCkudGhlbihmdW5jdGlvbiAoZmlsZUJhc2U2NFVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmh0dHBXcmFwcGVyU2VydmljZS5wb3N0KCdmaWxlLWF0dGFjaG1lbnQvcHV0JywgXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE8gTUdBIDogY3JlYXRlIG1vZGVsIGZvciBBdHRhY2hGaWxlRHRvICYgRmlsZVVwbG9hZEJhc2VEdG9cbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRWxlbWVudElkJzogZWxlbWVudElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdPcmlnaW4nOiBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bb3JpZ2luXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRmlsZVVwbG9hZEJhc2VEdG8nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGaWxlTmFtZSc6IGZpbGVUb1VwbG9hZC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRmlsZUJhc2U2NFVybCc6IGZpbGVCYXNlNjRVcmwuc2xpY2UoZmlsZUJhc2U2NFVybC5pbmRleE9mKCdiYXNlNjQsJykgKyAnYmFzZTY0LCcubGVuZ3RoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnRUeXBlJzogZmlsZVRvVXBsb2FkLnR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpRW5kcG9pbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkSW5CYXNlNjRKc29uOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudFNlcnZpY2UucHJvdG90eXBlLmVkaXRGaWxlQXR0YWNobWVudENvbW1lbnQgPSBmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnRJZCwgb3JpZ2luLCB1cGRhdGVkQ29tbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwV3JhcHBlclNlcnZpY2UucG9zdCgnZmlsZS1hdHRhY2htZW50L3VwZGF0ZS1jb21tZW50JywgXG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgOiBjcmVhdGUgRHRvIGNsaWVudC1zaWRlIG9yIHVwZGF0ZSBlbmRwb2ludCBzcnYtc2lkZSB0byBzdXBwb3J0IHBhcnQtcGFyYW1zIHVybCArIGNvbW1lbnQgYXMgcGF5bG9hZCAoY2xlYW5lciBTT0MpLlxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnRmlsZUF0dGFjaG1lbnRJZCc6IGZpbGVBdHRhY2htZW50SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAnT3JpZ2luJzogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW29yaWdpbl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29tbWVudCc6IHVwZGF0ZWRDb21tZW50XG4gICAgICAgICAgICAgICAgICAgIH0sIHsgYXBpRW5kcG9pbnQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRTZXJ2aWNlO1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIHNlcnZpY2VzLkZpbGVBdHRhY2htZW50U2VydmljZSA9IEZpbGVBdHRhY2htZW50U2VydmljZTtcbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LnF1b3RlV2l6YXJkLnNlcnZpY2VzLmZpbGVBdHRhY2htZW50JywgWyduZy5odHRwV3JhcHBlcicsICduZ0ZpbGVVcGxvYWQnLCAnbmdGaWxlU2F2ZXInXSlcbiAgICAgICAgICAgICAgICAuc2VydmljZSgnZmlsZUF0dGFjaG1lbnRTZXJ2aWNlJywgRmlsZUF0dGFjaG1lbnRTZXJ2aWNlKTtcbiAgICAgICAgfSkoc2VydmljZXMgPSBjb3JlLnNlcnZpY2VzIHx8IChjb3JlLnNlcnZpY2VzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBjb21wb25lbnRzO1xuICAgICAgICAoZnVuY3Rpb24gKGNvbXBvbmVudHMpIHtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcbiAgICAgICAgICAgIHZhciBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvblxuICAgICAgICAgICAgICAgIC8vI3JlZ2lvbiBjdG9yXG4gICAgICAgICAgICAgICAgLyogQG5nSW5qZWN0ICovXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyKCRsb2csIHRvYXN0ZXIsIGZpbGVBdHRhY2htZW50U2VydmljZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cgPSAkbG9nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvYXN0ZXIgPSB0b2FzdGVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZSA9IGZpbGVBdHRhY2htZW50U2VydmljZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZCA9ICdmaWxlLWF0dGFjaG1lbnQtZG93bmxvYWQtbGluayc7IC8vVE9ETyBNR0EgOiB0byBjb25zdCA/XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbGVtZW50SWRCaW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuZXJyb3IoJ3BhcmFtZXRlciB7ZWxlbWVudElkQmluZGluZ30gaXMgbWFuZGF0b3J5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW3RoaXMub3JpZ2luQmluZGluZ10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcigncGFyYW1ldGVyIHtvcmlnaW5CaW5kaW5nfSBpcyBtYW5kYXRvcnkuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2FsbCBzcnYgdG8gZ2V0IGxpc3Qgb2YgZmlsZXNcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmJPZkl0ZW1zUGVyUGFnZSA9IDEwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyNlbmRyZWdpb25cbiAgICAgICAgICAgICAgICAvLyNyZWdpb24gdm0gbWV0aG9kc1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZ2V0QXR0YWNoZWRGaWxlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZ2V0QXR0YWNoZWRGaWxlcyh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZykudGhlbihmdW5jdGlvbiAoZmlsZUF0dGFjaG1lbnRMaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRhY2hlZEZpbGVMaXN0ID0gZmlsZUF0dGFjaG1lbnRMaXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0YWNoZWRGaWxlTGlzdFNvdXJjZSA9IGZpbGVBdHRhY2htZW50TGlzdDsgLy9UT0RPIE1HQSA6IGR1cGxpY2F0ZSA/IHRvIHByZXZlbnQgdXBkYXRlIHRvIHNvdXJjZSBsaXN0IGlmIGNvbGxlY3Rpb24gbW9kaWZpZWQgP1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmRvd25sb2FkQXR0YWNoZWRGaWxlID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB2YXIgalF1ZXJ5QW5jaG9yRWxlbWVudCA9ICQoJyMnICsgdGhpcy5maWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZCk7IC8vYWRkIGlkIHNlbGVjdG9yXG4gICAgICAgICAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmRvd25sb2FkQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50LCB0aGlzLm9yaWdpbkJpbmRpbmcsIGpRdWVyeUFuY2hvckVsZW1lbnQpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA/IG9yIGxlYXZlIGFzIGlzLlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmRlbGV0ZUF0dGFjaGVkRmlsZSA9IGZ1bmN0aW9uIChmaWxlQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50IHx8ICFmaWxlQXR0YWNobWVudC5JZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuZGVsZXRlQXR0YWNoZWRGaWxlKGZpbGVBdHRhY2htZW50LklkLCB0aGlzLm9yaWdpbkJpbmRpbmcpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9hc3Rlci5zdWNjZXNzKFwiRmlsZSAoXCIgKyBmaWxlQXR0YWNobWVudC5GaWxlTmFtZSArIFwiKSBzdWNjZXNzZnVsbHkgZGVsZXRlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5nZXRBdHRhY2hlZEZpbGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlRmlsZUF0dGFjaG1lbnRDb21tZW50ID0gZnVuY3Rpb24gKGZpbGVBdHRhY2htZW50LCB1cGRhdGVkQ29tbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGVBdHRhY2htZW50IHx8ICFmaWxlQXR0YWNobWVudC5JZCB8fCAhdXBkYXRlZENvbW1lbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmVkaXRGaWxlQXR0YWNobWVudENvbW1lbnQoZmlsZUF0dGFjaG1lbnQuSWQsIHRoaXMub3JpZ2luQmluZGluZywgdXBkYXRlZENvbW1lbnQpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIE1HQSA6IGhpZ2hsaWdodCB1cGRhdGVkIGNvbW1lbnQgPyArIGdldCBvdXQgb2YgZWRpdCBtb2RlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZmlsZVNlbGVjdGVkID0gZnVuY3Rpb24gKGZpbGUsIGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBQcm9taXNlID0gdGhpcy5maWxlQXR0YWNobWVudFNlcnZpY2UuYXR0YWNoRmlsZSh0aGlzLmVsZW1lbnRJZEJpbmRpbmcsIHRoaXMub3JpZ2luQmluZGluZywgZmlsZSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2FzdGVyLnN1Y2Nlc3MoXCJGaWxlIChcIiArIGZpbGUubmFtZSArIFwiKSBzdWNjZXNzZnVsbHkgdXBsb2FkZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2V0QXR0YWNoZWRGaWxlcygpOyAvL1RPRE8gTUdBIDogaGlnaGxpZ2h0IG5ldyBlbnRyeSA/XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUub3BlblNlbGVjdEZpbGVEaWFsb2cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgOiBzaW11bGF0ZSB1c2VyIGRpcmVjdCBjbGljayB0byBpbnB1dCBmaWxlIGZpZWxkIChoaWRkZW4gYnV0IHVzZWQgZm9yIEFUIHRlc3RzKVxuICAgICAgICAgICAgICAgICAgICAkKCcjaW5wdXQtZmlsZS1zZWxlY3QtZmllbGQnKS5jbGljaygpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgLy9UT0RPIE1HQVxuICAgICAgICAgICAgICAgIEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuaXNTZWxlY3RGaWxlQnRuRGlzYWJsZWQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyO1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIGNvbXBvbmVudHMuRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyID0gRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyO1xuICAgICAgICAgICAgdmFyIEZpbGVBdHRhY2htZW50Q29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBGaWxlQXR0YWNobWVudENvbXBvbmVudCgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRJZEJpbmRpbmc6ICc9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbkJpbmRpbmc6ICc9J1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBGaWxlQXR0YWNobWVudENvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlckFzID0gJ3ZtJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZVVybCA9ICdjb21wb25lbnQvZmlsZS1hdHRhY2htZW50LnRwbC5odG1sJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIEZpbGVBdHRhY2htZW50Q29tcG9uZW50O1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIGNvbXBvbmVudHMuRmlsZUF0dGFjaG1lbnRDb21wb25lbnQgPSBGaWxlQXR0YWNobWVudENvbXBvbmVudDtcbiAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKCdibHVlc2t5LnF1b3RlV2l6YXJkLmNvbXBvbmVudHMuZmlsZUF0dGFjaG1lbnQnLCBbXG4gICAgICAgICAgICAgICAgJ2NnQnVzeScsXG4gICAgICAgICAgICAgICAgJ3NtYXJ0LXRhYmxlJyxcbiAgICAgICAgICAgICAgICAndG9hc3RlcicsXG4gICAgICAgICAgICAgICAgJ2ZpbGUtYXR0YWNobWVudC1jb21wb25lbnQtdHBsJyxcbiAgICAgICAgICAgICAgICAnYmx1ZXNreS5xdW90ZVdpemFyZC5zZXJ2aWNlcy5maWxlQXR0YWNobWVudCdcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgLnZhbHVlKCdjZ0J1c3lEZWZhdWx0cycsIHsgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvYW5ndWxhci1idXN5L2FuZ3VsYXItYnVzeS1jdXN0b20udHBsLmh0bWwnIH0pXG4gICAgICAgICAgICAgICAgLmNvbXBvbmVudCgnZmlsZUF0dGFjaG1lbnRDb21wb25lbnQnLCBuZXcgRmlsZUF0dGFjaG1lbnRDb21wb25lbnQoKSk7XG4gICAgICAgIH0pKGNvbXBvbmVudHMgPSBjb3JlLmNvbXBvbmVudHMgfHwgKGNvcmUuY29tcG9uZW50cyA9IHt9KSk7XG4gICAgfSkoY29yZSA9IGJsdWVza3kuY29yZSB8fCAoYmx1ZXNreS5jb3JlID0ge30pKTtcbn0pKGJsdWVza3kgfHwgKGJsdWVza3kgPSB7fSkpO1xuXG52YXIgYmx1ZXNreTtcbihmdW5jdGlvbiAoYmx1ZXNreSkge1xuICAgIHZhciBjb3JlO1xuICAgIChmdW5jdGlvbiAoY29yZSkge1xuICAgICAgICB2YXIgbW9kZWxzO1xuICAgICAgICAoZnVuY3Rpb24gKG1vZGVscykge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUT0RPIE1HQSA6IGRlY2lkZSBvbiBwcmFjdGljZSB0byBzaGFyZSBlbnVtcyB3aXRoIHNydiBldGNcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgKGZ1bmN0aW9uIChGaWxlQXR0YWNobWVudE9yaWdpbkVudW0pIHtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiUXVvdGVXaXphcmRGaWxlQXR0YWNobWVudFwiXSA9IDBdID0gXCJRdW90ZVdpemFyZEZpbGVBdHRhY2htZW50XCI7XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW0ZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtcIk9yZGVyRW50cnlDdXN0b21EZXRhaWxzXCJdID0gMV0gPSBcIk9yZGVyRW50cnlDdXN0b21EZXRhaWxzXCI7XG4gICAgICAgICAgICAgICAgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW0ZpbGVBdHRhY2htZW50T3JpZ2luRW51bVtcIk9yZGVyRW50cnlBdWRpb0N1c3RvbURldGFpbFwiXSA9IDJdID0gXCJPcmRlckVudHJ5QXVkaW9DdXN0b21EZXRhaWxcIjtcbiAgICAgICAgICAgICAgICBGaWxlQXR0YWNobWVudE9yaWdpbkVudW1bRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW1wiT3JkZXJUcmFja2luZ0ZpbGVBdHRhY2htZW50XCJdID0gM10gPSBcIk9yZGVyVHJhY2tpbmdGaWxlQXR0YWNobWVudFwiO1xuICAgICAgICAgICAgfSkobW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bSB8fCAobW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bSA9IHt9KSk7XG4gICAgICAgICAgICB2YXIgRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtID0gbW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcbiAgICAgICAgfSkobW9kZWxzID0gY29yZS5tb2RlbHMgfHwgKGNvcmUubW9kZWxzID0ge30pKTtcbiAgICB9KShjb3JlID0gYmx1ZXNreS5jb3JlIHx8IChibHVlc2t5LmNvcmUgPSB7fSkpO1xufSkoYmx1ZXNreSB8fCAoYmx1ZXNreSA9IHt9KSk7XG5cbnZhciBibHVlc2t5O1xuKGZ1bmN0aW9uIChibHVlc2t5KSB7XG4gICAgdmFyIGNvcmU7XG4gICAgKGZ1bmN0aW9uIChjb3JlKSB7XG4gICAgICAgIHZhciBtb2RlbHM7XG4gICAgICAgIChmdW5jdGlvbiAobW9kZWxzKSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRPRE8gTUdBIDogZXhwb3J0IGFuIGludGVyZmFjZSB0b28gP1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB2YXIgRmlsZUF0dGFjaG1lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEZpbGVBdHRhY2htZW50KElkLCBGaWxlTmFtZSwgQ29tbWVudCwgVXBsb2FkZWRCeSwgQ3JlYXRpb25EYXRlLCBPcmlnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IElkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkZpbGVOYW1lID0gRmlsZU5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ29tbWVudCA9IENvbW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuVXBsb2FkZWRCeSA9IFVwbG9hZGVkQnk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ3JlYXRpb25EYXRlID0gQ3JlYXRpb25EYXRlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLk9yaWdpbiA9IE9yaWdpbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIEZpbGVBdHRhY2htZW50O1xuICAgICAgICAgICAgfSgpKTtcbiAgICAgICAgICAgIG1vZGVscy5GaWxlQXR0YWNobWVudCA9IEZpbGVBdHRhY2htZW50O1xuICAgICAgICB9KShtb2RlbHMgPSBjb3JlLm1vZGVscyB8fCAoY29yZS5tb2RlbHMgPSB7fSkpO1xuICAgIH0pKGNvcmUgPSBibHVlc2t5LmNvcmUgfHwgKGJsdWVza3kuY29yZSA9IHt9KSk7XG59KShibHVlc2t5IHx8IChibHVlc2t5ID0ge30pKTtcbiIsIm5hbWVzcGFjZSBibHVlc2t5LmNvcmUuY29tcG9uZW50cyB7XHJcblxyXG4gICAgaW1wb3J0IEZpbGVBdHRhY2htZW50ID0gYmx1ZXNreS5jb3JlLm1vZGVscy5GaWxlQXR0YWNobWVudDtcclxuICAgIGltcG9ydCBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0gPSBibHVlc2t5LmNvcmUubW9kZWxzLkZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcclxuICAgIGltcG9ydCBJRmlsZUF0dGFjaG1lbnRTZXJ2aWNlID0gYmx1ZXNreS5jb3JlLnNlcnZpY2VzLklGaWxlQXR0YWNobWVudFNlcnZpY2U7XHJcblxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRmlsZUF0dGFjaG1lbnRDb21wb25lbnRCaW5kaW5ncyB7XHJcbiAgICAgICAgZWxlbWVudElkQmluZGluZz86IG51bWJlcjtcclxuICAgICAgICBvcmlnaW5CaW5kaW5nPzogRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciBleHRlbmRzIElGaWxlQXR0YWNobWVudENvbXBvbmVudEJpbmRpbmdzIHtcclxuICAgICAgICBhdHRhY2hlZEZpbGVMaXN0OiBBcnJheTxGaWxlQXR0YWNobWVudD47XHJcbiAgICAgICAgYXR0YWNoZWRGaWxlTGlzdFNvdXJjZTogQXJyYXk8RmlsZUF0dGFjaG1lbnQ+O1xyXG5cclxuICAgICAgICBmaWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZDogc3RyaW5nO1xyXG5cclxuICAgICAgICBnZXRBdHRhY2hlZEZpbGVzKCk6IHZvaWQ7XHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGU6IChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpID0+IHZvaWQ7XHJcbiAgICAgICAgZGVsZXRlQXR0YWNoZWRGaWxlOiAoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KSA9PiB2b2lkO1xyXG5cclxuICAgICAgICBmaWxlVG9VcGxvYWQ6IHN0cmluZztcclxuXHJcbiAgICAgICAgZmlsZVNlbGVjdGVkOiAoZmlsZTogRmlsZSwgZXZlbnQ6IG5nLmFuZ3VsYXJGaWxlVXBsb2FkLklGaWxlUHJvZ3Jlc3NFdmVudCkgPT4gdm9pZDtcclxuXHJcbiAgICAgICAgb3BlblNlbGVjdEZpbGVEaWFsb2c6ICgpID0+IHZvaWQ7XHJcbiAgICAgICAgaXNTZWxlY3RGaWxlQnRuRGlzYWJsZWQ6ICgpID0+IGJvb2xlYW47XHJcblxyXG4gICAgICAgIG5iT2ZJdGVtc1BlclBhZ2U6IG51bWJlcjtcclxuXHJcbiAgICAgICAgaHR0cFByb21pc2VzOiBBcnJheTxuZy5JUHJvbWlzZTxhbnk+PjtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgRmlsZUF0dGFjaG1lbnRDb21wb25lbnRDb250cm9sbGVyIGltcGxlbWVudHMgSUZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlciB7XHJcblxyXG4gICAgICAgIC8vI3JlZ2lvbiBiaW5kaW5nIHByb3BcclxuXHJcbiAgICAgICAgZWxlbWVudElkQmluZGluZzogbnVtYmVyO1xyXG4gICAgICAgIG9yaWdpbkJpbmRpbmc6IEZpbGVBdHRhY2htZW50T3JpZ2luRW51bTtcclxuXHJcbiAgICAgICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgICAgIC8vI3JlZ2lvbiB2bSBwcm9wXHJcblxyXG4gICAgICAgIGF0dGFjaGVkRmlsZUxpc3Q6IEFycmF5PEZpbGVBdHRhY2htZW50PjtcclxuICAgICAgICBhdHRhY2hlZEZpbGVMaXN0U291cmNlOiBBcnJheTxGaWxlQXR0YWNobWVudD47XHJcbiAgICAgICAgZmlsZUF0dGFjaG1lbnREb3dubG9hZExpbmtFbGVtZW50SWQgPSAnZmlsZS1hdHRhY2htZW50LWRvd25sb2FkLWxpbmsnOyAvL1RPRE8gTUdBIDogdG8gY29uc3QgP1xyXG4gICAgICAgIGZpbGVUb1VwbG9hZDogc3RyaW5nO1xyXG4gICAgICAgIG5iT2ZJdGVtc1BlclBhZ2U6IG51bWJlcjtcclxuICAgICAgICBodHRwUHJvbWlzZXM6IEFycmF5PG5nLklQcm9taXNlPGFueT4+O1xyXG5cclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAgICAgLy8jcmVnaW9uIGN0b3JcclxuXHJcbiAgICAgICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICAgICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgICAgIHByaXZhdGUgJGxvZzogbmcuSUxvZ1NlcnZpY2UsXHJcbiAgICAgICAgICAgIHByaXZhdGUgdG9hc3Rlcjogbmd0b2FzdGVyLklUb2FzdGVyU2VydmljZSxcclxuICAgICAgICAgICAgcHJpdmF0ZSBmaWxlQXR0YWNobWVudFNlcnZpY2U6IElGaWxlQXR0YWNobWVudFNlcnZpY2VcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmVsZW1lbnRJZEJpbmRpbmcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcigncGFyYW1ldGVyIHtlbGVtZW50SWRCaW5kaW5nfSBpcyBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghRmlsZUF0dGFjaG1lbnRPcmlnaW5FbnVtW3RoaXMub3JpZ2luQmluZGluZ10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5lcnJvcigncGFyYW1ldGVyIHtvcmlnaW5CaW5kaW5nfSBpcyBtYW5kYXRvcnkuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzID0gbmV3IEFycmF5PG5nLklQcm9taXNlPGFueT4+KCk7XHJcblxyXG4gICAgICAgICAgICAvLyBjYWxsIHNydiB0byBnZXQgbGlzdCBvZiBmaWxlc1xyXG4gICAgICAgICAgICB0aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubmJPZkl0ZW1zUGVyUGFnZSA9IDEwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8jZW5kcmVnaW9uXHJcblxyXG5cclxuICAgICAgICAvLyNyZWdpb24gdm0gbWV0aG9kc1xyXG5cclxuICAgICAgICBnZXRBdHRhY2hlZEZpbGVzKCk6IHZvaWQge1xyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5nZXRBdHRhY2hlZEZpbGVzKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nKS50aGVuKChmaWxlQXR0YWNobWVudExpc3QpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNoZWRGaWxlTGlzdCA9IGZpbGVBdHRhY2htZW50TGlzdDtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNoZWRGaWxlTGlzdFNvdXJjZSA9IGZpbGVBdHRhY2htZW50TGlzdDsgLy9UT0RPIE1HQSA6IGR1cGxpY2F0ZSA/IHRvIHByZXZlbnQgdXBkYXRlIHRvIHNvdXJjZSBsaXN0IGlmIGNvbGxlY3Rpb24gbW9kaWZpZWQgP1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZG93bmxvYWRBdHRhY2hlZEZpbGUoZmlsZUF0dGFjaG1lbnQ6IEZpbGVBdHRhY2htZW50KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUF0dGFjaG1lbnQgfHwgIWZpbGVBdHRhY2htZW50LklkKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgalF1ZXJ5QW5jaG9yRWxlbWVudCA9ICQoJyMnICsgdGhpcy5maWxlQXR0YWNobWVudERvd25sb2FkTGlua0VsZW1lbnRJZCk7IC8vYWRkIGlkIHNlbGVjdG9yXHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5kb3dubG9hZEF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudCwgdGhpcy5vcmlnaW5CaW5kaW5nLCBqUXVlcnlBbmNob3JFbGVtZW50KS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgPyBvciBsZWF2ZSBhcyBpcy5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBodHRwUHJvbWlzZSA9IHRoaXMuZmlsZUF0dGFjaG1lbnRTZXJ2aWNlLmRlbGV0ZUF0dGFjaGVkRmlsZShmaWxlQXR0YWNobWVudC5JZCwgdGhpcy5vcmlnaW5CaW5kaW5nKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9hc3Rlci5zdWNjZXNzKGBGaWxlICgke2ZpbGVBdHRhY2htZW50LkZpbGVOYW1lfSkgc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQuYCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEF0dGFjaGVkRmlsZXMoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmh0dHBQcm9taXNlcy5wdXNoKGh0dHBQcm9taXNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHVwZGF0ZUZpbGVBdHRhY2htZW50Q29tbWVudChmaWxlQXR0YWNobWVudDogRmlsZUF0dGFjaG1lbnQsIHVwZGF0ZWRDb21tZW50OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlQXR0YWNobWVudCB8fCAhZmlsZUF0dGFjaG1lbnQuSWQgfHwgIXVwZGF0ZWRDb21tZW50KSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5lZGl0RmlsZUF0dGFjaG1lbnRDb21tZW50KGZpbGVBdHRhY2htZW50LklkLCB0aGlzLm9yaWdpbkJpbmRpbmcsIHVwZGF0ZWRDb21tZW50KS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vVE9ETyBNR0EgOiBoaWdobGlnaHQgdXBkYXRlZCBjb21tZW50ID8gKyBnZXQgb3V0IG9mIGVkaXQgbW9kZVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaHR0cFByb21pc2VzLnB1c2goaHR0cFByb21pc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmlsZVNlbGVjdGVkKGZpbGU6IEZpbGUsIGV2ZW50OiBuZy5hbmd1bGFyRmlsZVVwbG9hZC5JRmlsZVByb2dyZXNzRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKCFmaWxlKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgaHR0cFByb21pc2UgPSB0aGlzLmZpbGVBdHRhY2htZW50U2VydmljZS5hdHRhY2hGaWxlKHRoaXMuZWxlbWVudElkQmluZGluZywgdGhpcy5vcmlnaW5CaW5kaW5nLCBmaWxlKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9hc3Rlci5zdWNjZXNzKGBGaWxlICgke2ZpbGUubmFtZX0pIHN1Y2Nlc3NmdWxseSB1cGxvYWRlZC5gKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXR0YWNoZWRGaWxlcygpOyAvL1RPRE8gTUdBIDogaGlnaGxpZ2h0IG5ldyBlbnRyeSA/XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5odHRwUHJvbWlzZXMucHVzaChodHRwUHJvbWlzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvcGVuU2VsZWN0RmlsZURpYWxvZygpOiB2b2lkIHtcclxuICAgICAgICAgICAgLy9UT0RPIE1HQSA6IHNpbXVsYXRlIHVzZXIgZGlyZWN0IGNsaWNrIHRvIGlucHV0IGZpbGUgZmllbGQgKGhpZGRlbiBidXQgdXNlZCBmb3IgQVQgdGVzdHMpXHJcbiAgICAgICAgICAgICQoJyNpbnB1dC1maWxlLXNlbGVjdC1maWVsZCcpLmNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL1RPRE8gTUdBXHJcbiAgICAgICAgaXNTZWxlY3RGaWxlQnRuRGlzYWJsZWQoKTogYm9vbGVhbiB7IHJldHVybiBmYWxzZTsgfVxyXG5cclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgRmlsZUF0dGFjaG1lbnRDb21wb25lbnQgaW1wbGVtZW50cyBuZy5JQ29tcG9uZW50T3B0aW9ucyB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBiaW5kaW5nczogYW55O1xyXG4gICAgICAgIHB1YmxpYyBjb250cm9sbGVyOiBhbnk7XHJcbiAgICAgICAgcHVibGljIGNvbnRyb2xsZXJBczogc3RyaW5nO1xyXG4gICAgICAgIHB1YmxpYyB0ZW1wbGF0ZVVybDogc3RyaW5nO1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYmluZGluZ3MgPSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50SWRCaW5kaW5nOiAnPScsXHJcbiAgICAgICAgICAgICAgICBvcmlnaW5CaW5kaW5nOiAnPSdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlciA9IEZpbGVBdHRhY2htZW50Q29tcG9uZW50Q29udHJvbGxlcjtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyQXMgPSAndm0nO1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlVXJsID0gJ2NvbXBvbmVudC9maWxlLWF0dGFjaG1lbnQudHBsLmh0bWwnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmx1ZXNreS5xdW90ZVdpemFyZC5jb21wb25lbnRzLmZpbGVBdHRhY2htZW50JywgW1xyXG4gICAgICAgICdjZ0J1c3knLFxyXG4gICAgICAgICdzbWFydC10YWJsZScsXHJcbiAgICAgICAgJ3RvYXN0ZXInLFxyXG4gICAgICAgICdmaWxlLWF0dGFjaG1lbnQtY29tcG9uZW50LXRwbCcsXHJcbiAgICAgICAgJ2JsdWVza3kucXVvdGVXaXphcmQuc2VydmljZXMuZmlsZUF0dGFjaG1lbnQnXHJcbiAgICBdKVxyXG4gICAgLy9UT0RPIE1HQTogbWFrZSB0aGlzIHVuaWZvcm0gZm9yIGVhY2ggZGlyZWN0aXZlcyAvLyBzaGFyZSBiZWhhdmlvclxyXG4gICAgLnZhbHVlKCdjZ0J1c3lEZWZhdWx0cycsIHsgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvYW5ndWxhci1idXN5L2FuZ3VsYXItYnVzeS1jdXN0b20udHBsLmh0bWwnIH0pXHJcbiAgICAuY29tcG9uZW50KCdmaWxlQXR0YWNobWVudENvbXBvbmVudCcsIG5ldyBGaWxlQXR0YWNobWVudENvbXBvbmVudCgpKTtcclxuXHJcbn0iLCJtb2R1bGUgYmx1ZXNreS5jb3JlLm1vZGVscyB7XHJcbiAgICAvKipcclxuICAgICAqIFRPRE8gTUdBIDogZGVjaWRlIG9uIHByYWN0aWNlIHRvIHNoYXJlIGVudW1zIHdpdGggc3J2IGV0Y1xyXG4gICAgICovXHJcbiAgICBleHBvcnQgZW51bSBGaWxlQXR0YWNobWVudE9yaWdpbkVudW0ge1xyXG4gICAgICAgIFF1b3RlV2l6YXJkRmlsZUF0dGFjaG1lbnQsXHJcbiAgICAgICAgT3JkZXJFbnRyeUN1c3RvbURldGFpbHMsXHJcbiAgICAgICAgT3JkZXJFbnRyeUF1ZGlvQ3VzdG9tRGV0YWlsLFxyXG4gICAgICAgIE9yZGVyVHJhY2tpbmdGaWxlQXR0YWNobWVudFxyXG4gICAgfVxyXG59IiwibmFtZXNwYWNlIGJsdWVza3kuY29yZS5tb2RlbHMge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVE9ETyBNR0EgOiBleHBvcnQgYW4gaW50ZXJmYWNlIHRvbyA/XHJcbiAgICAgKi9cclxuICAgIGV4cG9ydCBjbGFzcyBGaWxlQXR0YWNobWVudCB7XHJcbiAgICAgICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgICAgIHB1YmxpYyBJZDogbnVtYmVyLFxyXG4gICAgICAgICAgICBwdWJsaWMgRmlsZU5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIENvbW1lbnQ6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIFVwbG9hZGVkQnk6IHN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljIENyZWF0aW9uRGF0ZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBwdWJsaWMgT3JpZ2luOiBzdHJpbmdcclxuICAgICAgICApIHsgfVxyXG4gICAgfVxyXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
